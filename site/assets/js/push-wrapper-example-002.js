(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var Push=require("push-wrapper"),Mixer=require("./src/Mixer.js"),context=window.AudioContext?new window.AudioContext:new window.webkitAudioContext,Player=require("./src/player.js")(context),Scheduling=require("wac.scheduling")(context),Sequencer=require("./src/Sequencer.js"),Repetae=require("./src/repetae.js"),bpm=Scheduling.BPM(120),Interval=require("./src/interval.js"),intervals={"1/4":Interval["4n"](bpm,"1/4"),"1/4t":Interval["4nt"](bpm,"1/4t"),"1/8":Interval["8n"](bpm,"1/8"),"1/8t":Interval["8nt"](bpm,"1/8t"),"1/16":Interval["16n"](bpm,"1/16"),"1/16t":Interval["16nt"](bpm,"1/16t"),"1/32":Interval["32n"](bpm,"1/32"),"1/32t":Interval["32nt"](bpm,"1/32t")},samples=["Kick","Snare","HandClap","Hat","Tamb","Cloing","Tang","Tom"].map(function(x){return"assets/audio/"+x+".mp3"}),filter_frequencies=[0,100,200,400,800,2e3,6e3,1e4,2e4],oneToEight=[1,2,3,4,5,6,7,8],pushControl=require("./src/pushControl.js");bpm.setMaxListeners(20);window.addEventListener("load",function(){var createPush=Promise.resolve();if(navigator.requestMIDIAccess){createPush=createPush.then(function(){return navigator.requestMIDIAccess({sysex:true})}).then(Push.create_bound_to_web_midi_api)}else{createPush=createPush.then(show_no_midi_warning).then(function(){return new Push({send:function send(bytes){}})})}Promise.all([createPush].concat(samples.map(Player.forResource)).concat(Player.forResource("assets/audio/metronome-accent.mp3")).concat(Player.forResource("assets/audio/metronome-tick.mp3"))).then(function(values){return off_we_go(values[0],values.slice(1,9),values[9],values[10])})});function show_no_midi_warning(){document.getElementById("no-midi-warning").classList.add("pwe-no-midi-warning--show")}function off_we_go(push,players,accent,tick){var metronome=setupMetronome(bpm,push,accent,tick);var sequencer=makeSequencer(players,push,bpm,metronome);push.lcd.clear();var mixer=new Mixer(9,context);players.forEach(mixer.connectInput);mixer.connectInput(accent,8);mixer.connectInput(tick,8);mixer.toMaster();pushModifierButton(push.button["shift"]);pushModifierButton(push.button["delete"]);pushModifierButton(push.button["accent"]);pushModifierButton(push.button["mute"]);pushModifierButton(push.button["tap_tempo"]);Object.keys(intervals).map(function(name){return push.button[name]}).forEach(pushModifierButton);var repetaes=oneToEight.map(function(){return new Repetae(intervals["1/4"],context)});pushControl(push,repetaes,players,mixer,metronome,bpm,sequencer);players.forEach(function(player,i){var column_number=i+1;var repetae=repetaes[i];Object.keys(intervals).forEach(function(buttonName){push.button[buttonName].on("pressed",function(){return repetae.interval(intervals[buttonName])})});turn_off_column(push,column_number);player.on("started",function(gain){return turn_on_column(push,column_number,gain)});player.on("stopped",function(){return turn_off_column(push,column_number)});bind_column_to_player(push,player,column_number,repetae,sequencer)});bind_pitchbend(push,players);bindQwertyButtonsToPlayback(players,sequencer);sequencer.on("play",function(data){players[data.player].cutOff(data.frequency).play(midiGain(data.velocity))});bpm.report();metronome.report()}function setupMetronome(bpm,push,accent,tick){var tap=Scheduling.Tap();tap.on("average",bpm.changeTo);var metronome=Scheduling.Metronome(4,bpm);metronome.setMaxListeners(20);var running=false;function toggleMetronome(){running=!running;if(running){push.button["metronome"].led_on();metronome.start()}else{push.button["metronome"].led_dim();metronome.stop()}}var mute=false;push.button["mute"].on("pressed",function(){mute=true});push.button["mute"].on("released",function(){mute=false});push.button["metronome"].on("pressed",function(){if(mute){toggleMetronomeMute()}else{toggleMetronome()}});push.button["metronome"].led_dim();push.button["tap_tempo"].on("pressed",tap.again);bindKeypress(function(event){if(event.key==="m")toggleMetronome();if(event.key==="n")tap.again();if(event.key===",")toggleMetronomeMute()});push.lcd.x[1].y[3].update("   bpm =");bpm.on("changed",function(bpm){return push.lcd.x[2].y[3].update(bpm.current())});var tapTempoButton=document.getElementsByClassName("tap")[0];var metronomeOnOffButton=document.getElementsByClassName("metronome-on-off")[0];var metronomeMuteButton=document.getElementsByClassName("metronome-mute")[0];var bpmSlider=document.getElementById("bpm-control");var bpmLabel=document.querySelector("label[for='bpm-control']");var accentSlider=document.getElementById("accent-control");var accentLabel=document.querySelector("label[for='accent-control']");metronome.on("started",function(){return turn_button_display_on(metronomeOnOffButton)});metronome.on("stopped",function(){return turn_button_display_off(metronomeOnOffButton)});function flashTapTempo(){turn_button_display_on(tapTempoButton);push.button["tap_tempo"].led_on();setTimeout(function(){turn_button_display_off(tapTempoButton);push.button["tap_tempo"].led_dim()},100)}metronome.on("accent",flashTapTempo);metronome.on("tick",flashTapTempo);metronome.on("bpmChanged",function(bpm){bpmLabel.innerHTML="BPM: "+bpm.current();bpmSlider.value=bpm.current()});metronome.on("numberOfBeats",function(beats){accentLabel.innerHTML="ACCENT: "+beats+" beats";accentSlider.value=beats;push.lcd.x[3].y[3].update(beats+" bts")});bpmSlider.addEventListener("input",function(event){metronome.updateBPM(parseInt(event.target.value))});accentSlider.addEventListener("input",function(event){metronome.updateNumberOfBeats(parseInt(event.target.value))});metronomeOnOffButton.addEventListener("click",toggleMetronome);tapTempoButton.addEventListener("click",tap.again);metronomeMuteButton.addEventListener("click",toggleMetronomeMute);var muted=true;function toggleMetronomeMute(){muted=!muted;if(muted){metronome.removeListener("accent",accent.play);metronome.removeListener("tick",tick.play);push.lcd.x[4].y[3].update("muted");turn_button_display_on(metronomeMuteButton)}else{metronome.on("accent",accent.play);metronome.on("tick",tick.play);push.lcd.x[4].y[3].clear();turn_button_display_off(metronomeMuteButton)}}toggleMetronomeMute();return metronome}function makeSequencer(players,push,bpm,metronome){var selectionButtons=document.getElementsByClassName("sequence-selector");var armButton=document.getElementsByClassName("arm")[0];var playButton=document.getElementsByClassName("play")[0];var deleteButton=document.getElementsByClassName("delete")[0];var sequencer=new Sequencer(selectionButtons.length,Scheduling,bpm,metronome);sequencer.on("sequenceState",function(number,state,isSelected){switch(state){case"idle":if(isSelected){updateSequenceUiButton(selectionButtons[number-1],"selected");push.channel[number].select.orange();push.channel[number].select.led_on()}else{updateSequenceUiButton(selectionButtons[number-1],"");push.channel[number].select.led_off()}updateSequenceUiButton(armButton);updateSequenceUiButton(playButton);push.button["rec"].led_off();push.button["play"].led_off();break;case"armed":updateSequenceUiButton(selectionButtons[number-1],"recording");push.channel[number].select.red();push.channel[number].select.led_on();updateSequenceUiButton(armButton,"recording");updateSequenceUiButton(playButton);push.button["rec"].led_on();push.button["play"].led_off();break;case"recording":updateSequenceUiButton(selectionButtons[number-1],"recording");push.channel[number].select.red();push.channel[number].select.led_on();updateSequenceUiButton(armButton,"recording");updateSequenceUiButton(playButton);push.button["rec"].led_on();push.button["play"].led_off();break;case"overdubbing":updateSequenceUiButton(selectionButtons[number-1],"recording");push.channel[number].select.red();push.channel[number].select.led_on();updateSequenceUiButton(armButton,"recording");updateSequenceUiButton(playButton,"playing");push.button["rec"].led_dim();push.button["play"].led_on();break;case"playback":updateSequenceUiButton(selectionButtons[number-1],"playing");push.channel[number].select.green();push.channel[number].select.led_on();updateSequenceUiButton(armButton);updateSequenceUiButton(playButton,"playing");push.button["rec"].led_off();push.button["play"].led_on();break;case"stopped":if(isSelected){updateSequenceUiButton(selectionButtons[number-1],"selected");push.channel[number].select.orange()}else{updateSequenceUiButton(selectionButtons[number-1],"has-sequence");push.channel[number].select.yellow()}push.channel[number].select.led_on();updateSequenceUiButton(armButton);updateSequenceUiButton(playButton,"has-sequence");push.button["rec"].led_off();push.button["play"].led_dim();break}});bindKeypress(function(event){switch(event.key){case"g":sequencer.playButtonPressed();break;case"z":sequencer.recordButtonPressed();break;case"x":sequencer.deleteSequence();break;case"1":sequencer.selectSequence(1);break;case"2":sequencer.selectSequence(2);break;case"3":sequencer.selectSequence(3);break;case"4":sequencer.selectSequence(4);break;case"5":sequencer.selectSequence(5);break;case"6":sequencer.selectSequence(6);break;case"7":sequencer.selectSequence(7);break;case"8":sequencer.selectSequence(8);break}});Array.prototype.forEach.call(selectionButtons,function(button,i){button.addEventListener("mousedown",function(){sequencer.selectSequence(i+1)})});push.button["rec"].on("pressed",sequencer.recordButtonPressed);push.button["play"].on("pressed",sequencer.playButtonPressed);armButton.addEventListener("mousedown",sequencer.recordButtonPressed);playButton.addEventListener("mousedown",sequencer.playButtonPressed);deleteButton.addEventListener("mousedown",sequencer.deleteSequence);sequencer.reportSelectedSequenceState();return sequencer}function bind_column_to_player(push,player,x,repetae,sequencer){var mutable_velocity=127,mutable_frequency=filter_frequencies[8],pressed_pads_in_col=0;var playback=function playback(){player.cutOff(mutable_frequency).play(midiGain(mutable_velocity))};var padAftertouch=function padAftertouch(pressure){if(pressure>0)mutable_velocity=pressure};oneToEight.forEach(function(y){var grid_button=push.grid.x[x].y[y];grid_button.on("pressed",function(velocity){mutable_velocity=velocity;mutable_frequency=filter_frequencies[y];if(++pressed_pads_in_col==1)repetae.start(playback);sequencer.addEvent("play",{player:x-1,velocity:mutable_velocity,frequency:mutable_frequency})});grid_button.on("aftertouch",padAftertouch);grid_button.on("released",function(){--pressed_pads_in_col;if(pressed_pads_in_col==0)repetae.stop()})})}function bindQwertyButtonsToPlayback(players,sequencer){var buttons=document.getElementsByClassName("sample-playback");var velocity=108;var midiVelocity=midiGain(velocity);var f=filter_frequencies[8];preventDefaultDragAndDropBehaviour();players.forEach(function(player,i){return bindAudioUpload(buttons[i],player)});players.forEach(function(player,i){player.on("started",function(){return turn_button_display_on(buttons[i])});player.on("stopped",function(){return turn_button_display_off(buttons[i])});buttons[i].addEventListener("mousedown",function(){player.cutOff(f).play(midiVelocity);sequencer.addEvent("play",{player:i,velocity:velocity,frequency:f})})});var lookup={q:0,w:1,e:2,r:3,t:4,y:5,u:6,i:7};bindKeypress(function(event){if(event.key in lookup){var index=lookup[event.key];players[index].cutOff(f).play(midiVelocity);sequencer.addEvent("play",{player:index,velocity:velocity,frequency:f})}})}function midiGain(_velocity){return{velocity:function velocity(){return _velocity},toAbsolute:function toAbsolute(){return _velocity/127}}}function turn_on_column(push,x,gain){oneToEight.forEach(function(y){if((gain.velocity()+15)/16>=y){push.grid.x[x].y[y].led_on(gain.velocity())}else{push.grid.x[x].y[y].led_off()}})}function turn_off_column(push,x){[2,3,4,5,6,7,8].forEach(function(y){push.grid.x[x].y[y].led_off()});push.grid.x[x].y[1].led_on()}function bind_pitchbend(push,players){push.touchstrip.on("pitchbend",function(pb){var rate=scale(pb,0,16384,-12,12);players.forEach(function(player){return player.modulatePitch(rate)})})}function turn_button_display_on(ui_btn){ui_btn.classList.add("pwe-button--active")}function turn_button_display_off(ui_btn){ui_btn.classList.remove("pwe-button--active")}function scale(input,minIn,maxIn,minOut,maxOut){return(maxOut-minOut)*((input-minIn)/(maxIn-minIn))+minOut}function updateSequenceUiButton(button,state){["has-sequence","playing","recording","selected"].forEach(function(state){return button.classList.remove("pwe-button--"+state)});if(state){button.classList.add("pwe-button--"+state)}}function pushModifierButton(pushButton){pushButton.led_dim();pushButton.on("pressed",pushButton.led_on);pushButton.on("released",pushButton.led_dim)}function bindKeypress(callback){window.addEventListener("keypress",function(event){if(!event.key)event.key=String.fromCharCode(event.charCode);callback(event)})}function stopBubbledEvent(e){e.stopPropagation();e.preventDefault()}function bindAudioUpload(uploadButton,player){function addUploadStyling(e){stopBubbledEvent(e);e.target.classList.add("pwe-button--upload")}function removeUploadStyling(e){stopBubbledEvent(e);e.target.classList.remove("pwe-button--upload")}function loadNewAudioFile(e){removeUploadStyling(e);player.loadFile(e.dataTransfer.files[0])}uploadButton.addEventListener("dragover",stopBubbledEvent,false);uploadButton.addEventListener("dragenter",addUploadStyling,false);uploadButton.addEventListener("dragleave",removeUploadStyling,false);uploadButton.addEventListener("drop",loadNewAudioFile,false)}function preventDefaultDragAndDropBehaviour(){window.addEventListener("drop",stopBubbledEvent,false);window.addEventListener("dragover",stopBubbledEvent,false)}},{"./src/Mixer.js":19,"./src/Sequencer.js":20,"./src/interval.js":23,"./src/player.js":25,"./src/pushControl.js":26,"./src/repetae.js":27,"push-wrapper":2,"wac.scheduling":11}],2:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),Buttons=require("./src/buttons.js"),Knobs=require("./src/knobs"),Grid=require("./src/grid.js"),Touchstrip=require("./src/touchstrip.js"),ControlButtons=require("./src/control-buttons.js"),LCDs=require("./src/lcds.js"),oneToEight=[1,2,3,4,5,6,7,8];function Push(midi_out_port){var _this=this;EventEmitter.call(this);var midi_out={send_cc:function send_cc(cc,value){midi_out_port.send([176,cc,value])},send_note:function send_note(note,velocity){midi_out_port.send([144,note,velocity])},send_sysex:function send_sysex(data){midi_out_port.send([240,71,127,21].concat(data).concat([247]))}};var buttons=new Buttons(midi_out.send_cc);this.knobs=new Knobs;this.grid=new Grid(midi_out.send_note,midi_out.send_cc,midi_out.send_sysex);this.touchstrip=new Touchstrip;this.control=new ControlButtons(midi_out.send_cc);this.ccMap=[];this.noteMap=[];[this.knobs,this.touchstrip,this.grid].forEach(function(module){return module.handled_notes.forEach(function(note){return _this.noteMap[note]=module})});[this.knobs,this.control,buttons,this.grid].forEach(function(module){return module.handled_ccs.forEach(function(cc){return _this.ccMap[cc]=module})});var api={knob:{tempo:this.knobs.tempo,swing:this.knobs.swing,master:this.knobs.master},grid:{x:{}},touchstrip:this.touchstrip,lcd:new LCDs(midi_out.send_sysex),button:{"1/32t":this.control["1/32t"],"1/32":this.control["1/32"],"1/16t":this.control["1/16t"],"1/16":this.control["1/16"],"1/8t":this.control["1/8t"],"1/8":this.control["1/8"],"1/4t":this.control["1/4t"],"1/4":this.control["1/4"]},channel:{},receive_midi:receive_midi.bind(null,this)};oneToEight.forEach(function(number){return api.channel[number]={knob:_this.knobs[number],select:_this.control[number]}});oneToEight.forEach(function(X){api.grid.x[X]={y:{},select:_this.grid.select[X]};oneToEight.forEach(function(Y){api.grid.x[X].y[Y]=_this.grid.x[X].y[Y]})});buttons.names.forEach(function(name){return api.button[name]=buttons[name]});return api}util.inherits(Push,EventEmitter);function handle_midi_cc(push,index,value){if(index in push.ccMap){push.ccMap[index].receive_midi_cc(index,value)}else{console.log("No known mapping for CC: "+index)}}function handle_midi_note(push,note,velocity){if(note in push.noteMap){push.noteMap[note].receive_midi_note(note,velocity)}else{console.log("No known mapping for note: "+note)}}function handle_midi_pitch_bend(push,lsb_byte,msb_byte){push.touchstrip.receive_midi_pitch_bend((msb_byte<<7)+lsb_byte)}function handle_midi_poly_pressure(push,note,pressure){push.grid.receive_midi_poly_pressure(note,pressure)}var midi_messages={"note-off":128,"note-on":144,"poly-pressure":160,cc:176,"program-change":192,"channel-pressure":208,"pitch-bend":224,sysex:240};function receive_midi(push,bytes){var message_type=bytes[0]&240;var midi_channel=bytes[0]&15;switch(message_type){case midi_messages["cc"]:handle_midi_cc(push,bytes[1],bytes[2]);break;case midi_messages["note-on"]:case midi_messages["note-off"]:handle_midi_note(push,bytes[1],bytes[2]);break;case midi_messages["pitch-bend"]:handle_midi_pitch_bend(push,bytes[1],bytes[2]);break;case midi_messages["poly-pressure"]:handle_midi_poly_pressure(push,bytes[1],bytes[2]);break}}Push.create_bound_to_web_midi_api=function(midiAccess){var inputs=midiAccess.inputs.values(),outputs=midiAccess.outputs.values(),push;for(var output=outputs.next();output&&!output.done;output=outputs.next()){console.log("Found output: "+output.value.name);if("Ableton Push User Port"==output.value.name){console.log("Binding MIDI output to "+output.value.name);push=new Push(output.value);break}}if(push===undefined)push=new Push({send:function send(bytes){}});for(var input=inputs.next();input&&!input.done;input=inputs.next()){console.log("Found input: "+input.value.name);if("Ableton Push User Port"==input.value.name){console.log("Binding MIDI input to "+input.value.name);input.value.onmidimessage=function(event){push.receive_midi(event.data)};break}}return push};module.exports=Push},{"./src/buttons.js":3,"./src/control-buttons.js":4,"./src/grid.js":5,"./src/knobs":6,"./src/lcds.js":7,"./src/touchstrip.js":8,events:29,util:33}],3:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util");var ccToButtonMap={3:"tap_tempo",9:"metronome",119:"undo",118:"delete",117:"double",116:"quantize",90:"fixed_length",89:"automation",88:"duplicate",87:"new",86:"rec",85:"play",28:"master",29:"stop",44:"left",45:"right",46:"up",47:"down",114:"volume",115:"pan_&_send",112:"track",113:"clip",110:"device",111:"browse",62:"step_in",63:"step_out",60:"mute",61:"solo",58:"scales",59:"user",56:"repeat",57:"accent",54:"octave_down",55:"octave_up",52:"add_effect",53:"add_track",50:"note",51:"session",48:"select",49:"shift"};var handled_ccs=Object.keys(ccToButtonMap);function Button(send_cc,cc){EventEmitter.call(this);return{led_on:function led_on(){send_cc(cc,4)},led_dim:function led_dim(){send_cc(cc,1)},led_off:function led_off(){send_cc(cc,0)},red:function red(){},orange:function orange(){},yellow:function yellow(){},green:function green(){},on:this.on,emit:this.emit}}util.inherits(Button,EventEmitter);function Buttons(send_cc){var _this=this;var buttons=this;Object.keys(ccToButtonMap).map(Number).forEach(function(cc){_this[ccToButtonMap[cc]]=new Button(send_cc,cc)});this.names=Object.keys(ccToButtonMap).map(function(key){return ccToButtonMap[key]});this.receive_midi_cc=function(index,value){buttons[ccToButtonMap[index]].emit(pressed_or_released(value))};this.handled_ccs=handled_ccs}function pressed_or_released(velocity){return parseInt(velocity)>0?"pressed":"released"}module.exports=Buttons},{events:29,util:33}],4:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util");var ccToPadMap={20:1,21:2,22:3,23:4,24:5,25:6,26:7,27:8,43:"1/32t",42:"1/32",41:"1/16t",40:"1/16",39:"1/8t",38:"1/8",37:"1/4t",36:"1/4"};var handled_ccs=Object.keys(ccToPadMap);function Pad(send_cc,cc){EventEmitter.call(this);this.output=function(value){send_cc(cc,value)};var colours=[7,10];this.colours=[7,10];return{led_on:function led_on(){send_cc(cc,colours[1])},led_dim:function led_dim(){send_cc(cc,colours[0])},led_off:function led_off(){send_cc(cc,0)},red:function red(){colours=[1,4]},orange:function orange(){colours=[7,10]},yellow:function yellow(){colours=[13,16]},green:function green(){colours=[19,22]},on:this.on,emit:this.emit}}util.inherits(Pad,EventEmitter);function ControlButtons(send_cc){var _this=this;var control_buttons=this;Object.keys(ccToPadMap).map(Number).forEach(function(cc){_this[ccToPadMap[cc]]=new Pad(send_cc,cc)});this.handled_ccs=handled_ccs;this.receive_midi_cc=function(cc,value){var pad_name=ccToPadMap[cc];control_buttons[pad_name].emit(value>0?"pressed":"released")}}module.exports=ControlButtons},{events:29,util:33}],5:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var controlButtons={102:1,103:2,104:3,105:4,106:5,107:6,108:7,109:8};var handledCCs=Object.keys(controlButtons).map(Number);var handledNotes=[];for(var i=36;i<=99;i++){handledNotes.push(i)}function GridButton(send_midi_message,send_sysex,note){EventEmitter.call(this);var index=note<102?note-36:note-38;return{led_on:function led_on(value){send_midi_message(note,value?value:100)},led_off:function led_off(){send_midi_message(note,0)},led_rgb:function led_rgb(r,g,b){var msb=[r,g,b].map(function(x){return(x&240)>>4}),lsb=[r,g,b].map(function(x){return x&15});send_sysex([4,0,8,index,0,msb[0],lsb[0],msb[1],lsb[1],msb[2],lsb[2]])},on:this.on,emit:this.emit}}util.inherits(GridButton,EventEmitter);function Grid(send_note,send_cc,send_sysex){var _this=this;this.x={};this.select={};for(var x=1;x<=8;x++){this.x[x]={y:{}};for(var y=1;y<=8;y++){this.x[x].y[y]=new GridButton(send_note,send_sysex,x-1+(y-1)*8+36)}}handledCCs.forEach(function(cc){_this.select[controlButtons[cc]]=new GridButton(send_cc,send_sysex,cc)});this.handled_ccs=handledCCs;this.handled_notes=handledNotes;this.receive_midi_note=receive_midi_note.bind(null,this);this.receive_midi_cc=receive_midi_cc.bind(null,this);this.receive_midi_poly_pressure=receive_midi_poly_pressure.bind(null,this)}function receive_midi_note(grid,note,velocity){var button=button_from_note(grid,note),vel=parseInt(velocity);vel>0?button.emit("pressed",vel):button.emit("released")}function receive_midi_cc(grid,index,value){grid.select[controlButtons[index]].emit(value>0?"pressed":"released")}function receive_midi_poly_pressure(grid,note,pressure){button_from_note(grid,note).emit("aftertouch",parseInt(pressure))}function button_from_note(grid,note){var indexed_from_zero=note-36,x=indexed_from_zero%8+1,y=parseInt(indexed_from_zero/8)+1;return grid.x[x].y[y]}module.exports=Grid},{events:29,util:33}],6:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var knobMap={tempo:{cc:14,note:10},swing:{cc:15,note:9},1:{cc:71,note:0},2:{cc:72,note:1},3:{cc:73,note:2},4:{cc:74,note:3},5:{cc:75,note:4},6:{cc:76,note:5},7:{cc:77,note:6},8:{cc:78,note:7},master:{cc:79,note:8}};var ccToKnobMap={};var noteToKnobMap={};var knobNames=Object.keys(knobMap);knobNames.forEach(function(name){ccToKnobMap[knobMap[name].cc]=name;noteToKnobMap[knobMap[name].note]=name});var handledCCs=Object.keys(ccToKnobMap);var handledNotes=Object.keys(noteToKnobMap);function Knob(){EventEmitter.call(this)}util.inherits(Knob,EventEmitter);function Knobs(){var _this=this;knobNames.forEach(function(name){_this[name]=new Knob});this.handled_ccs=handledCCs;this.receive_midi_cc=receive_midi_cc.bind(null,this);this.receive_midi_note=receive_midi_note.bind(null,this);this.handled_notes=handledNotes}function receive_midi_cc(knobs,index,value){var knob_name=ccToKnobMap[index];var delta=value<64?value:value-128;knobs[knob_name].emit("turned",delta)}function receive_midi_note(knobs,note,velocity){var knob_name=noteToKnobMap[note];var event_name=velocity>0?"pressed":"released";knobs[knob_name].emit(event_name)}module.exports=Knobs},{events:29,util:33}],7:[function(require,module,exports){"use strict";var oneToEight=[1,2,3,4,5,6,7,8],oneToFour=[1,2,3,4],zeroToSeven=[0,1,2,3,4,5,6,7],blank=32,blank_line=new Array(68).fill(blank),offsets=[0,9,17,26,34,43,51,60];function LCDSegment(update){this.update=function(text){update(lcd_data(text))};this.clear=function(){update(lcd_data(""))}}function lcd_data(text){var text_string=String(text);return zeroToSeven.map(function(index){return text_string.length>index?text_string.charCodeAt(index):blank})}function LCDs(send_sysex){var lcds=this;this.clear=function(){oneToEight.forEach(function(x){lcds.x[x]={y:{}};oneToFour.forEach(function(y){lcds.x[x].y[y]=new LCDSegment(function(display_data){send_sysex([28-y].concat([0,9,offsets[x-1]]).concat(display_data))})})});oneToFour.forEach(function(row){send_sysex([28-row].concat([0,69,0]).concat(blank_line))})};this.x={};this.clear();this.x[8].y[4].update(" powered");this.x[8].y[3].update("      by");this.x[8].y[2].update("   push-");this.x[8].y[1].update(" wrapper")}module.exports=LCDs},{}],8:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),handled_notes=[12];function TouchStrip(){EventEmitter.call(this);this.receive_midi_pitch_bend=receive_midi_pitch_bend.bind(null,this);this.receive_midi_note=receive_midi_note.bind(null,this);this.handled_notes=handled_notes}util.inherits(TouchStrip,EventEmitter);function receive_midi_pitch_bend(touchstrip,fourteen_bit_value){if(fourteen_bit_value==8192)return;touchstrip.emit("pitchbend",fourteen_bit_value)}function receive_midi_note(touchstrip,note,velocity){if(velocity>0){touchstrip.emit("pressed")}else{touchstrip.emit("released");touchstrip.emit("pitchbend",8192)}}module.exports=TouchStrip},{events:29,util:33}],9:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var unityGain={toAbsolute:function toAbsolute(){return 1}};var SampleLoading=require("./src/SampleLoading.js");function SamplePlayer(buffer,sampleFactory,audioContext){EventEmitter.call(this);var player=this;var _voices=[];var _playbackRate=1;var _gainNode=audioContext.createGain();function timeNow(){return audioContext.currentTime}function stoppedAction(){_voices.shift();if(!player.isPlaying())player.emit("stopped")}this.connect=_gainNode.connect.bind(_gainNode);this.disconnect=_gainNode.disconnect.bind(_gainNode);this.toMaster=function(){player.disconnect();player.connect(audioContext.destination);return player};this.isPlaying=function(){return _voices.length>0};this.play=function(gain){var now=timeNow();var startTime=now;var _gain=gain&&typeof gain.toAbsolute==="function"?gain:unityGain;if(player.isPlaying()){anchor(_gainNode.gain,now);startTime=now+.01;_gainNode.gain.linearRampToValueAtTime(0,startTime);player.emit("stopped")}else{_gainNode.gain.setValueAtTime(0,startTime)}var source=audioContext.createBufferSource();source.connect(_gainNode);_gainNode.gain.linearRampToValueAtTime(_gain.toAbsolute(),startTime);source.playbackRate.value=_playbackRate;source.buffer=buffer;source.addEventListener("ended",stoppedAction);_voices.push(source);source.start(startTime);player.emit("started",_gain)};this.updatePlaybackRate=function(rate){_playbackRate=rate;var now=timeNow();_voices.forEach(function(source){source.playbackRate.setValueAtTime(_playbackRate,now)})};function loadNewSample(load,source){return new Promise(function(resolve){return load(source,resolve)}).then(function(newBuffer){buffer=newBuffer;return player})}this.loadFile=function(file){return loadNewSample(sampleFactory.loadSampleFromFile,file)};this.loadResource=function(url){return loadNewSample(sampleFactory.loadRemoteSample,url)}}util.inherits(SamplePlayer,EventEmitter);function anchor(audioParam,now){audioParam.cancelScheduledValues(now);audioParam.setValueAtTime(audioParam.value,now)}function SamplePlayerFactory(audioContext){var sampleFactory=SampleLoading(audioContext);function loadPlayer(load,source){return new Promise(function(resolve){return load(source,resolve)}).then(function(buffer){return new SamplePlayer(buffer,sampleFactory,audioContext)})}this.forResource=function(url){return loadPlayer(sampleFactory.loadRemoteSample,url)};this.forFile=function(file){return loadPlayer(sampleFactory.loadSampleFromFile,file)}}module.exports=function(audioContext){return new SamplePlayerFactory(audioContext)}},{"./src/SampleLoading.js":10,events:29,util:33}],10:[function(require,module,exports){"use strict";function loadSampleFromFile(file,audioContext,done){var fileReader=new FileReader;fileReader.onload=function(e){audioContext.decodeAudioData(e.target.result,done)};fileReader.readAsArrayBuffer(file)}function loadRemoteSample(assetUrl,audioContext,done){var request=new XMLHttpRequest;request.open("GET",assetUrl,true);request.responseType="arraybuffer";request.onload=function(){audioContext.decodeAudioData(request.response,done)};request.send()}function SampleFactory(audioContext){this.loadSampleFromFile=function(file,done){loadSampleFromFile(file,audioContext,done)};this.loadRemoteSample=function(url,done){loadRemoteSample(url,audioContext,done)}}module.exports=function(audioContext){return new SampleFactory(audioContext)}},{}],11:[function(require,module,exports){"use strict";var BPM=require("./src/BPM.js");var createInterval=require("./src/CreateInterval.js");var Metronome=require("./src/Metronome.js");var Repeater=require("./src/Repeater.js");var Sequence=require("./src/Sequence.js");var Tap=require("./src/TapTempo.js");function Scheduling(context){var scheduling=this;function inTheFutureTight(callback,when){var source=context.createBufferSource();var now=context.currentTime;var thousandth=context.sampleRate/1e3;var scheduledAt=now+createInterval(when).toMs()/1e3-.001;var buffer=context.createBuffer(1,thousandth,context.sampleRate);source.addEventListener("ended",callback);source.buffer=buffer;source.connect(context.destination);source.start(scheduledAt);return function cancel(){source.removeEventListener("ended",callback);source.stop()}}function atATimeTight(callback,when){var source=context.createBufferSource();var thousandth=context.sampleRate/1e3;var scheduledAt=createInterval(when).toMs()/1e3-.001;var buffer=context.createBuffer(1,thousandth,context.sampleRate);source.addEventListener("ended",callback);source.buffer=buffer;source.connect(context.destination);source.start(scheduledAt);return function cancel(){source.removeEventListener("ended",callback);source.stop()}}function nowMsFromContext(){return context.currentTime*1e3}this.inTheFuture=context?inTheFutureTight:inTheFutureLoose;this.atATime=context?atATimeTight:atATimeLoose;this.nowMs=context?nowMsFromContext:nowMsFromSystem;this.Repeater=function(initialInterval){return new Repeater(scheduling.atATime,scheduling.nowMs,initialInterval)};this.Sequence=function(){return new Sequence(scheduling.atATime,scheduling.nowMs)};this.Metronome=function(numberOfBeats,bpm){bpm=bpm instanceof BPM?bpm:new BPM(bpm);return new Metronome(scheduling.Repeater,numberOfBeats,bpm)};this.Tap=function(){return new Tap(scheduling.nowMs,scheduling.inTheFuture)};this.BPM=function(initial){return new BPM(initial)};this.BPMForBeatLength=function(beatLength){return BPM.forBeatLength(beatLength)}}function inTheFutureLoose(callback,when){var timer=setTimeout(callback,createInterval(when).toMs());return function cancel(){clearTimeout(timer)}}function atATimeLoose(callback,when){var timer=setTimeout(callback,createInterval(when).toMs()-nowMsFromSystem());return function cancel(){clearTimeout(timer);
}}function nowMsFromSystem(){return(new Date).getTime()}module.exports=function(context){return new Scheduling(context)}},{"./src/BPM.js":12,"./src/CreateInterval.js":13,"./src/Metronome.js":14,"./src/Repeater.js":15,"./src/Sequence.js":16,"./src/TapTempo.js":17}],12:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var defaultTo120=function defaultTo120(amount){return amount||120};var rounded2dp=function rounded2dp(amount){return Math.round(amount*100)/100};var clippedBetween20And300=function clippedBetween20And300(x){return Math.min(Math.max(x,20),300)};var sanitize=function sanitize(x){return rounded2dp(clippedBetween20And300(defaultTo120(x)))};var bpmToBeatLengthMs=function bpmToBeatLengthMs(bpm){return 60/bpm*1e3};var beatLengthMsToBpm=bpmToBeatLengthMs;var toMs=function toMs(candidate){return candidate&&typeof candidate.toMs==="function"?candidate.toMs():candidate};function BPM(initial){EventEmitter.call(this);var bpm=this;var current=initial&&typeof initial.current==="function"?initial.current():sanitize(initial);function updateAndReport(newBpm){current=sanitize(newBpm);bpm.report()}this.current=function(){return current};this.report=function(){return bpm.emit("changed",bpm)};this.changeBy=function(amount){return updateAndReport(current+amount)};this.changeTo=function(amount){return updateAndReport(new BPM(amount).current())};this.beatLength=function(){return{toMs:function toMs(){return bpmToBeatLengthMs(current)}}}}util.inherits(BPM,EventEmitter);BPM.forBeatLength=function(beatLength){return new BPM(beatLengthMsToBpm(toMs(beatLength)))};module.exports=BPM},{events:29,util:33}],13:[function(require,module,exports){"use strict";module.exports=function(x){return x&&typeof x.toMs==="function"?x:{toMs:function toMs(){return x}}}},{}],14:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var between1And16=function between1And16(x){if(x<1)return 1;return Math.min(x,16)};function Metronome(Repeater,initialNumberOfBeats,bpm){EventEmitter.call(this);var metronome=this;var numberOfBeats=between1And16(initialNumberOfBeats);var repeater=Repeater(bpm.beatLength());var count=-1;function tick(){count=++count%numberOfBeats;if(count===0){metronome.emit("accent")}else{metronome.emit("tick")}}this.start=function(){repeater.start(tick)};this.stop=function(){repeater.stop();count=-1};this.updateNumberOfBeats=function(beats){numberOfBeats=beats===between1And16(beats)?beats:numberOfBeats;reportBeats()};this.updateBPM=function(newBPM){bpm.changeTo(newBPM)};this.report=function(){reportBPM();reportBeats()};function updateRepeaterInterval(newBPM){repeater.updateInterval(newBPM.beatLength());reportBPM()}function reportBeats(){metronome.emit("numberOfBeats",numberOfBeats)}function reportBPM(){metronome.emit("bpmChanged",bpm)}repeater.on("started",function(info){metronome.emit("started",{previousTick:info.previousRepeatTime,nextTick:info.nextRepeatTime})});repeater.on("stopped",function(){metronome.emit("stopped")});bpm.on("changed",updateRepeaterInterval)}util.inherits(Metronome,EventEmitter);module.exports=Metronome},{events:29,util:33}],15:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var createInterval=require("./CreateInterval.js");function noAction(){}function Repeater(atATime,nowMs,initialInterval){EventEmitter.call(this);var _lastScheduledTimeMs=void 0;var _callback=noAction;var _isScheduling=false;var _interval=createInterval(initialInterval);var _cancel=noAction;var repeater=this;function nextRepeatTime(){return createInterval(_lastScheduledTimeMs+_interval.toMs())}function recursiveInTheFuture(){var nextScheduledTimeMs=nextRepeatTime().toMs();return atATime(function(){if(_isScheduling){_callback();_lastScheduledTimeMs=nextScheduledTimeMs;_cancel=recursiveInTheFuture()}},nextScheduledTimeMs)}this.updateInterval=function(newInterval){_interval=createInterval(newInterval);if(_isScheduling){_cancel();_cancel=recursiveInTheFuture()}repeater.reportInterval();return repeater};this.start=function(passedCallback){if(_isScheduling)return;_lastScheduledTimeMs=nowMs();_isScheduling=true;_callback=passedCallback;_callback();repeater.emit("started",{previousRepeatTime:{toMs:function toMs(){return _lastScheduledTimeMs}},nextRepeatTime:{toMs:function toMs(){return nextRepeatTime().toMs()}}});_cancel=recursiveInTheFuture()};this.stop=function(){_cancel();_cancel=noAction;_callback=noAction;_isScheduling=false;repeater.emit("stopped")};this.reportInterval=function(){repeater.emit("interval",{toMs:_interval.toMs})}}util.inherits(Repeater,EventEmitter);module.exports=Repeater},{"./CreateInterval.js":13,events:29,util:33}],16:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var createInterval=require("./CreateInterval.js");function noAction(){}function Sequence(atATime,nowMs){EventEmitter.call(this);var sequence=this;var running=false;var absoluteStartTime=void 0;var restartEvent={when:undefined,action:"restart",cancel:noAction};var stopEvent={when:0,action:"stop",cancel:noAction};var scheduleAllEvents=function scheduleAllEvents(startTimeMs){stopEvent.when=0;events.filter(occursBetween.bind(null,startTimeMs,restartEvent.when)).forEach(function(event){stopEvent.when=event.when>stopEvent.when?event.when:stopEvent.when;schedule(event)});stopEvent.when+=10;schedule(restartEvent.when?restartEvent:stopEvent)};function restart(){absoluteStartTime+=restartEvent.when;sequence.emit("loop");scheduleAllEvents(0)}var cancelAllEvents=function cancelAllEvents(){events.forEach(cancel);cancel(restartEvent);cancel(stopEvent)};var schedule=function schedule(event){event.cancel=atATime(function(){switch(event.action){case"restart":restart();break;case"stop":sequence.stop();break;default:sequence.emit(event.name,event.data);break}},absoluteStartTime+event.when)};var currentPositionData=function currentPositionData(){var rightNow=nowMs();return{nowMs:rightNow,currentMs:absoluteStartTime>0?rightNow-absoluteStartTime:0}};var events=[];this.startAt=function(timeMs,offsetMs){timeMs=createInterval(timeMs).toMs();offsetMs=offsetMs>0?offsetMs:0;timeMs=timeMs>0?timeMs:0;timeMs=timeMs<nowMs()?nowMs():timeMs;if(restartEvent.when)offsetMs=offsetMs%restartEvent.when;absoluteStartTime=timeMs-offsetMs;if(running){cancelAllEvents()}running=true;scheduleAllEvents(offsetMs);return sequence};this.start=function(offsetMs){sequence.startAt(nowMs(),offsetMs)};this.stop=function(){var wasRunning=running;running=false;if(wasRunning){cancelAllEvents();sequence.emit("stopped")}};this.loop=function(endTimeMs){var end=endTimeMs>0?endTimeMs:undefined;if(end){restartEvent.when=end;if(running){var offsetMs=sequence.currentPositionMs()%end;sequence.start(offsetMs)}}return sequence};this.addEventAt=function(when,name,data){events.push({when:when,name:name,data:data,cancel:noAction})};this.addEventNow=function(name,data){var positionInfo=currentPositionData();if(absoluteStartTime===undefined){absoluteStartTime=positionInfo.nowMs}events.push({when:positionInfo.currentMs,name:name,data:data,cancel:noAction})};this.currentPositionMs=function(){return currentPositionData().currentMs};this.loopLengthMs=function(){return restartEvent.when};this.reset=function(){sequence.stop();events=[];absoluteStartTime=undefined;restartEvent.when=undefined;stopEvent.when=0;sequence.emit("reset");return sequence};this.scale=function(){var scaleFactor=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;if(scaleFactor<0||scaleFactor===1)return sequence;if(running){cancelAllEvents()}events.forEach(function(event){event.when*=scaleFactor});if(restartEvent.when)restartEvent.when*=scaleFactor;if(running){var positionInfo=currentPositionData();var offsetMs=positionInfo.currentMs*scaleFactor;absoluteStartTime=positionInfo.nowMs-offsetMs;scheduleAllEvents(offsetMs)}return sequence};this.load=function(json){sequence.stop();events=json.events.map(function(event){var newEvent=mapEventForJSONification(event);newEvent.cancel=noAction;return newEvent});restartEvent.when=json.loop.lengthMs>0?json.loop.lengthMs:undefined;restartEvent.cancel=noAction;return sequence};this.toJSON=function(){return{loop:{lengthMs:restartEvent.when},events:events.map(mapEventForJSONification)}}}util.inherits(Sequence,EventEmitter);function mapEventForJSONification(event){return{when:event.when,name:event.name,data:event.data}}function isAfter(timeMs,event){return event.when>=timeMs}function isBefore(event,endMs){return typeof endMs==="undefined"?true:event.when<endMs}function occursBetween(startMs,endMs,event){return isAfter(startMs,event)&&isBefore(event,endMs)}function cancel(event){event.cancel();event.cancel=noAction}module.exports=Sequence},{"./CreateInterval.js":13,events:29,util:33}],17:[function(require,module,exports){"use strict";var BPM=require("./BPM.js");var EventEmitter=require("events");var util=require("util");function noAction(){}function Tap(nowMs,inTheFuture){EventEmitter.call(this);var tap=this;var cancel=noAction;var queue=[];function reset(){queue=[]}this.again=function(){cancel();cancel=noAction;queue.push(nowMs());if(queue.length>4)queue.shift();if(queue.length>1){var averageTime=(queue[queue.length-1]-queue[0])/(queue.length-1);tap.emit("average",BPM.forBeatLength(averageTime));cancel=inTheFuture(reset,averageTime*1.25)}else{cancel=inTheFuture(reset,1500)}}}util.inherits(Tap,EventEmitter);module.exports=Tap},{"./BPM.js":12,events:29,util:33}],18:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var states={armed:"armed",idle:"idle",recording:"recording",playback:"playback",stopped:"stopped",overdubbing:"overdubbing"};var ppq={1:96,"3/4":72,"1/2":48,"1/3":32,"1/4":24,"1/6":16,"1/8":12,"1/12":8,"1/16":6,"1/24":4,"1/32":3};function AppSequence(Scheduling,bpm,metronome){EventEmitter.call(this);var wrapped=Scheduling.Sequence();var state=states.idle;var numberOfBeats=undefined;var sequenceBPM=undefined;var sequence=this;var _now={toMs:Scheduling.nowMs};var nextTick=_now;var previousTick=_now;var metronomeRunning=false;var isQuantised=false;var quantisationFactor=1;if(metronome){metronome.on("started",function(metronomeInterval){nextTick=metronomeInterval.nextTick;previousTick=metronomeInterval.previousTick;metronomeRunning=true});metronome.on("stopped",function(){nextTick=_now;previousTick=_now;metronomeRunning=false})}function isActive(){return[states.playback,states.overdubbing,states.recording].indexOf(state)!=-1}function reportState(){sequence.emit("state",state);if(isActive())sequence.emit("active");if(state===states.stopped)sequence.emit("stopped")}function scaleSequenceLength(bpm){var changeFactor=sequenceBPM/bpm.current();wrapped.scale(changeFactor);sequenceBPM=bpm.current()}var setLoopLengthAndBroadcastBPM=function setLoopLengthAndBroadcastBPM(){var sequenceLengthMs=wrapped.currentPositionMs();if(!isQuantised){wrapped.loop(sequenceLengthMs);wrapped.start();return}sequenceBPM=bpm.current();var beatLengthMs=bpm.beatLength().toMs();numberOfBeats=Math.round(sequenceLengthMs/beatLengthMs);numberOfBeats=numberOfBeats>1?numberOfBeats:1;sequence.emit("numberOfBeats",numberOfBeats);var roundedSequenceLengthMs=numberOfBeats*beatLengthMs;wrapped.loop(roundedSequenceLengthMs);if(roundedSequenceLengthMs<sequenceLengthMs){var timeSinceLastTick=Scheduling.nowMs()-previousTick.toMs();wrapped.start(timeSinceLastTick)}else{wrapped.startAt(nextTick)}metronome.on("bpmChanged",scaleSequenceLength)};function calculateQuantisationFactor(bpm){quantisationFactor=bpm.beatLength().toMs()/96*ppq["1/4"]}function nearestQuantisedTimeInSequence(){return Math.round(wrapped.currentPositionMs()/quantisationFactor)*quantisationFactor}function nextQuantisedPointIntime(){var now=Scheduling.nowMs();if(!metronomeRunning)return now;var startTime=previousTick.toMs()+quantisationFactor;while(startTime<now){startTime+=quantisationFactor}return startTime}metronome.on("bpmChanged",calculateQuantisationFactor);metronome.report();this.addEvent=function(name,data){switch(state){case states.armed:isQuantised=metronomeRunning;case states.recording:case states.overdubbing:var quantisedTime=isQuantised?nearestQuantisedTimeInSequence():0;if(quantisedTime>0){wrapped.addEventAt(quantisedTime,"__app_sequence__",{name:name,data:data})}else{wrapped.addEventNow("__app_sequence__",{name:name,data:data})}}};this.reportState=reportState;this.arm=function(){if(state===states.idle){state=states.armed;reportState();return true}return false};this.disarm=function(){if(state===states.armed){state=states.idle;reportState();return true}return false};this.record=function(){if(state===states.armed){state=states.recording;reportState();return true}return false};this.playLegato=function(){var offset=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(state===states.stopped){wrapped.start(offset);state=states.playback;reportState();return true}return false};this.play=function(){switch(state){case states.stopped:wrapped.startAt(nextQuantisedPointIntime());break;case states.recording:setLoopLengthAndBroadcastBPM();break;case states.overdubbing:break;default:return false}state=states.playback;reportState();return true};this.playAtNextTick=function(){if(state===states.stopped){wrapped.startAt(nextTick);state=states.playback;reportState();return true}return false};this.restart=function(){if(state===states.playback){if(isQuantised&&metronomeRunning){wrapped.startAt(nextQuantisedPointIntime())}else{wrapped.start()}return true}return false};this.overdub=function(){switch(state){case states.stopped:wrapped.startAt(nextTick);break;case states.recording:setLoopLengthAndBroadcastBPM();break;case states.playback:break;default:return false}state=states.overdubbing;reportState();return true};this.stop=function(){if(state===states.playback||state===states.overdubbing){wrapped.stop();return true}return false};this.reset=function(){wrapped.reset();state=states.idle;isQuantised=false;metronome.removeListener("bpmChanged",scaleSequenceLength);reportState();return true};this.currentPositionMs=function(){return wrapped.currentPositionMs()};this.hasEvents=function(){return state!==states.idle&&state!==states.armed};wrapped.on("stopped",function(){if(state!==states.stopped){state=states.stopped;reportState()}});wrapped.on("__app_sequence__",function(wrappedEvent){sequence.emit(wrappedEvent.name,wrappedEvent.data)})}util.inherits(AppSequence,EventEmitter);module.exports=AppSequence},{events:29,util:33}],19:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var midiVelocityToAbsolute=require("./midiVelocityToAbsoluteGain.js");function Mixer(numberOfChannels,audioContext){EventEmitter.call(this);var mixer=this;var masterGainNode=audioContext.createGain();var masterChannel=new Channel(masterGainNode,audioContext,report("masterGain"));var outputGainNodes=new Array(numberOfChannels).fill(0).map(function(x){return audioContext.createGain()});outputGainNodes.forEach(function(node){return node.connect(masterGainNode)});var channels=outputGainNodes.map(function(node,i){return new Channel(node,audioContext,report("channel"+i+"Gain"))});this.connectInput=function(source,channel){source.connect(outputGainNodes[channel])};this.channel=function(number){return channels[number]};this.masterChannel=function(){return masterChannel};this.toMaster=function(){masterGainNode.disconnect();masterGainNode.connect(audioContext.destination);return mixer};function report(channel){return function(gain){return mixer.emit(channel,gain)}}}util.inherits(Mixer,EventEmitter);function Channel(gainNode,audioContext,report){var channel=this;var gain=midiGain(108);this.changeMidiGainTo=function(value){gain=midiGain(value);channel.changeGainTo(gain)};this.changeMidiGainBy=function(delta){gain=midiGain(gain.midiValue()+delta);channel.changeGainTo(gain)};this.changeGainTo=function(newGain){gainNode.gain.linearRampToValueAtTime(newGain.toAbsolute(),audioContext.currentTime+.005);report(newGain)}}function clampBetween0And127(value){return Math.max(0,Math.min(127,value))}function midiGain(value){return{midiValue:function midiValue(){return clampBetween0And127(value)},toAbsolute:function toAbsolute(){return midiVelocityToAbsolute(clampBetween0And127(value))},toDb:function toDb(){return 20*Math.log10(midiVelocityToAbsolute(clampBetween0And127(value)))}}}module.exports=Mixer},{"./midiVelocityToAbsoluteGain.js":24,events:29,util:33}],20:[function(require,module,exports){"use strict";var Sequence=require("./AppSequence.js");var EventEmitter=require("events");var util=require("util");function Sequencer(numberOfSequences,Scheduling,bpm,metronome){EventEmitter.call(this);var sequences=Array(numberOfSequences+1).fill("").map(function(){return new Sequence(Scheduling,bpm,metronome)});sequences.forEach(function(sequence,index){sequence.number=index+1});var selectedSequence=void 0;var activeSequence=void 0;var sequencer=this;function isSelected(sequence){return sequence===selectedSequence}function validSequenceNumber(number){return number>0&&number<=sequences.length}this.selectSequence=function(number){select(number)};this.selectSequenceLegato=function(number){select(number,true)};function select(){var sequenceNumber=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var legato=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!validSequenceNumber(sequenceNumber))return;var index=sequenceNumber-1;if(isSelected(sequences[index])&&sequences[index]===activeSequence){activeSequence.restart()||activeSequence.play();return}var prevSequence=selectedSequence;selectedSequence=sequences[index];if(prevSequence){prevSequence.removeListener("stopped",sequencerStopped);prevSequence.disarm();prevSequence.reportState()}selectedSequence.addListener("stopped",sequencerStopped);if(activeSequence){activeSequence.play()}if(selectedSequence.hasEvents()){if(activeSequence&&legato){var offset=activeSequence.currentPositionMs();activeSequence.stop();selectedSequence.playLegato(offset)}else if(activeSequence){activeSequence.stop();selectedSequence.play()}else{selectedSequence.playAtNextTick()}}else{selectedSequence.arm()}}this.recordButtonPressed=function(){selectedSequence.arm()||selectedSequence.disarm()||selectedSequence.overdub()||selectedSequence.play()};this.playButtonPressed=function(){selectedSequence.stop()||!activeSequence&&selectedSequence.playAtNextTick()||selectedSequence.play()};this.deleteSequence=function(){var number=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var toReset=selectedSequence;if(validSequenceNumber(number)){toReset=sequences[number-1]}toReset.reset();if(activeSequence===toReset)activeSequence=undefined};this.addEvent=function(name,data){selectedSequence.addEvent("__sequenced_event__",{name:name,data:data});selectedSequence.record()};this.reportSelectedSequenceState=function(){selectedSequence.reportState()};function reportSequenceState(state){sequencer.emit("sequenceState",this.number,state,isSelected(this))}function captureActiveSequence(){activeSequence=this}function sequencerStopped(){activeSequence=undefined;sequencer.emit("stopped")}function emitSequencedEvent(wrappedEvent){sequencer.emit(wrappedEvent.name,wrappedEvent.data)}sequences.forEach(function(sequence,index){sequence.addListener("state",reportSequenceState);sequence.addListener("active",captureActiveSequence);sequence.addListener("__sequenced_event__",emitSequencedEvent);sequence.addListener("state",function(state){switch(state){case"recording":sequences.forEach(function(other){if(sequence!==other)other.stop()})}});sequence.reportState()});select(1);sequences[0].disarm()}util.inherits(Sequencer,EventEmitter);module.exports=Sequencer},{"./AppSequence.js":18,events:29,util:33}],21:[function(require,module,exports){"use strict";var oneToEight=[1,2,3,4,5,6,7,8];var modes={DELETE:"deletes selected sequence",LEGATO:"selects playing sequence legato style",NORMAL:"selects/arms sequence"};var mode=modes.NORMAL;function setModeTo(newMode){return function(){mode=newMode}}function revertModeFrom(candidate){return function(){mode=mode===candidate?modes.NORMAL:mode}}module.exports=function bindPushChannelSelectButtons(push,shift,del,sequencer){function action(x){switch(mode){case modes.DELETE:sequencer.deleteSequence(x);break;case modes.LEGATO:sequencer.selectSequenceLegato(x,true);break;case modes.NORMAL:sequencer.selectSequence(x);break}}oneToEight.forEach(function(x){push.channel[x].select.on("pressed",function(){return action(x)})});shift.on("pressed",setModeTo(modes.LEGATO));shift.on("released",revertModeFrom(modes.LEGATO));del.on("pressed",setModeTo(modes.DELETE));del.on("released",revertModeFrom(modes.DELETE))}},{}],22:[function(require,module,exports){"use strict";var modes={ACCENT:"controls number of metronome beats",FINE:"controls bpm in 0.01 beat increments",NORMAL:"controls bpm in whole beat increments"};var mode=modes.NORMAL;var numberOfBeats=4;function setModeTo(newMode){return function(){mode=newMode}}function revertModeFrom(candidate){return function(){mode=mode===candidate?modes.NORMAL:mode}}module.exports=function bindPushTempoKnob(tempo,shift,accent,metronome,bpm){function action(delta){switch(mode){case modes.ACCENT:metronome.updateNumberOfBeats(numberOfBeats+delta);break;case modes.FINE:bpm.changeBy(delta*.01);break;case modes.NORMAL:bpm.changeBy(delta);break}}metronome.on("numberOfBeats",function(beats){numberOfBeats=beats});tempo.on("turned",action);shift.on("pressed",setModeTo(modes.FINE));shift.on("released",revertModeFrom(modes.FINE));accent.on("pressed",setModeTo(modes.ACCENT));accent.on("released",revertModeFrom(modes.ACCENT))}},{}],23:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util");function Interval(bpm,multiplier,value){EventEmitter.call(this);var interval=this;this.value=value;this.report=function(){interval.emit("changed",bpm.beatLength().toMs()*multiplier)};bpm.on("changed",interval.report)}util.inherits(Interval,EventEmitter);module.exports={"4n":function n(bpm,name){return new Interval(bpm,1,name?name:"4n")},"4nt":function nt(bpm,name){return new Interval(bpm,2/3,name?name:"4nt")},"8n":function n(bpm,name){return new Interval(bpm,.5,name?name:"8n")},"8nt":function nt(bpm,name){return new Interval(bpm,1/3,name?name:"8nt")},"16n":function n(bpm,name){return new Interval(bpm,.25,name?name:"16n")},"16nt":function nt(bpm,name){return new Interval(bpm,1/6,name?name:"16nt")},"32n":function n(bpm,name){return new Interval(bpm,.125,name?name:"32n")},"32nt":function nt(bpm,name){return new Interval(bpm,1/12,name?name:"32nt")}}},{events:29,util:33}],24:[function(require,module,exports){"use strict";var velocityToAbsolute={0:0,1:442e-6,2:596e-6,3:759e-6,4:933e-6,5:.001109,6:.001303,7:.001549,8:.00182,9:.002113,10:.002483,11:.002884,12:.00335,13:.00389,14:.004467,15:.005188,16:.005957,17:.006839,18:.007762,19:.00881,20:.010116,21:.011482,22:.012882,23:.014454,24:.016218,25:.018197,26:.020417,27:.022646,28:.025119,29:.027861,30:.030903,31:.033884,32:.037154,33:.040738,34:.044157,35:.048417,36:.052481,37:.056885,38:.060954,39:.066069,40:.070795,41:.075858,42:.080353,43:.086099,44:.091201,45:.096605,46:.101158,47:.107152,48:.112202,49:.11749,50:.121619,51:.12735,52:.131826,53:.136458,54:.141254,55:.146218,56:.151356,57:.158489,58:.164059,59:.169824,60:.175792,61:.18197,62:.188365,63:.194984,64:.204174,65:.211349,66:.218776,67:.226464,68:.234423,69:.242661,70:.251189,71:.263027,72:.27227,73:.281838,74:.291743,75:.301995,76:.312608,77:.327341,78:.338844,79:.350752,80:.363078,81:.375837,82:.389045,83:.402717,84:.421697,85:.436516,86:.451856,87:.467735,88:.484172,89:.501187,90:.5188,91:.54325,92:.562341,93:.582103,94:.60256,95:.623735,96:.645654,97:.676083,98:.699842,99:.724436,100:.749894,101:.776247,102:.803526,103:.831764,104:.870964,105:.901571,106:.933254,107:.966051,108:1,109:1.035142,110:1.071519,111:1.122018,112:1.161449,113:1.202264,114:1.244515,115:1.28825,116:1.333521,117:1.396368,118:1.44544,119:1.496236,120:1.548817,121:1.603245,122:1.659587,123:1.717908,124:1.798871,125:1.862087,126:1.927525,127:1.995262};module.exports=function(velocity){return velocityToAbsolute[velocity]}},{}],25:[function(require,module,exports){"use strict";var SamplePlayer=require("wac.sample-player");function Player(samplePlayer,audioContext,source){var filterNode=audioContext.createBiquadFilter(),pitch=0,pitchMod=0,player=this;var sampleName=source;filterNode.frequency.value=2e4;samplePlayer.connect(filterNode);var updatePitch=function updatePitch(){samplePlayer.updatePlaybackRate(intervalToPlaybackRate(pitch+pitchMod))};this.play=samplePlayer.play.bind(samplePlayer);this.connect=filterNode.connect.bind(filterNode);this.disconnect=filterNode.disconnect.bind(filterNode);this.toMaster=function(){filterNode.disconnect();filterNode.connect(audioContext.destination);return player};this.isPlaying=samplePlayer.isPlaying.bind(samplePlayer);this.changePitchByInterval=function(interval){pitch=clip(pitch+interval,-24,24);player.reportPitch();updatePitch()};this.modulatePitch=function(interval){pitchMod=clip(interval,-24,24);updatePitch()};this.cutOff=function(f){filterNode.frequency.setValueAtTime(clip(f,30,2e4),audioContext.currentTime);return player};this.reportPitch=function(){samplePlayer.emit("pitch",(pitch>=0?"+":"")+pitch+" st")};this.on=samplePlayer.on.bind(samplePlayer);this.loadFile=function(file){sampleName=file.name;var result=samplePlayer.loadFile(file);player.reportSampleName();return result};this.loadResource=function(resource){sampleName=lastInPath(resource);var result=samplePlayer.loadResource(resource);player.reportSampleName();return result};this.reportSampleName=function(){samplePlayer.emit("sampleName",sampleName)}}function clip(value,min,max){if(value<min)return min;return value>max?max:value}function intervalToPlaybackRate(midiNoteNumber){return Math.exp(.057762265*midiNoteNumber)}function lastInPath(s){return s.split("/").slice(-1)[0]}function PlayerFactory(audioContext){var samplePlayerFactory=SamplePlayer(audioContext);function create(load,source){return load(source).then(function(samplePlayer){return new Player(samplePlayer,audioContext,source.name||lastInPath(source))})}this.forResource=function(assetUrl){return create(samplePlayerFactory.forResource,assetUrl)};this.forFile=function(file){return create(samplePlayerFactory.forFile,file)}}module.exports=function(audioContext){return new PlayerFactory(audioContext)}},{"wac.sample-player":9}],26:[function(require,module,exports){"use strict";var oneToEight=[1,2,3,4,5,6,7,8];var nowt=function nowt(){};var bindPushTempoKnob=require("./bindPushTempoKnob.js");var bindPushChannelSelectButtons=require("./bindPushChannelSelectButtons.js");var shortened=require("./sampleNameShortening.js");function pushControl(push,repetaes,players,mixer,metronome,bpm,sequencer){function selectButton(x){return push.grid.x[x].select}function knob(x){return push.channel[x].knob}bindPushTempoKnob(push.knob["tempo"],push.button["shift"],push.button["accent"],metronome,bpm);bindPushChannelSelectButtons(push,push.button["shift"],push.button["delete"],sequencer);bindMasterVolume(mixer,push);oneToEight.map(selectButton).forEach(function(button,i){var repetae=repetaes[i];var column=i+1;button.on("pressed",repetae.press);button.on("released",repetae.release);var executor=new MultiCommand;repetae.on("on",executor.add(ledBlue(button)));repetae.on("off",executor.add(ledOrange(button)));executor.activate();ledOrange(button)();repetae.on("interval",push.lcd.x[column].y[1].update);repetae.report_interval()});var pitchThings=[];pitchThings=pitchThings.concat(oneToEight.map(knob).map(function(knob,i){var control=new MultiCommand;knob.on("turned",control.add(players[i].changePitchByInterval));return control})).concat(oneToEight.map(knob).map(function(knob,i){var feedback=new MultiObserver;players[i].on("pitch",feedback.add(push.lcd.x[i+1].y[4].update));return feedback}));var volumeThings=[];volumeThings=volumeThings.concat(oneToEight.map(knob).map(function(knob,i){var control=new MultiCommand;knob.on("turned",control.add(mixer.channel(i).changeMidiGainBy));return control})).concat(oneToEight.map(knob).map(function(knob,i){var feedback=new MultiObserver;mixer.on("channel"+i+"Gain",feedback.add(function(gain){push.lcd.x[i+1].y[4].update(displayDb(gain))}));mixer.channel(i).changeMidiGainTo(108);return feedback}));var togglePitchOrVolumeControl=toggleBetween(pitchThings,volumeThings);togglePitchOrVolumeControl();push.button["volume"].on("pressed",function(){var on=togglePitchOrVolumeControl();if(on){push.button["volume"].led_on()}else{push.button["volume"].led_dim()}});push.button["volume"].led_dim();players.forEach(function(player,i){player.on("sampleName",function(name){return push.lcd.x[i+1].y[2].update(shortened(name))});player.reportPitch();player.reportSampleName()})}function displayDb(gain){return gain.toDb().toFixed(2)+"dB"}function ledBlue(button){return function(){return button.led_rgb(0,155,155)}}function ledOrange(button){return function(){return button.led_on()}}function bindMasterVolume(mixer,push){push.knob["master"].on("turned",mixer.masterChannel().changeMidiGainBy);mixer.on("masterGain",function(gain){push.lcd.x[8].y[3].update(displayDb(gain))});mixer.masterChannel().changeMidiGainTo(108)}function MultiObserver(){return new Executor(true)}function MultiCommand(){return new Executor(false)}function Executor(replayOnActivate){var command=nowt;var passed=[];var active=false;function execute(){if(active)command.apply(null,passed)}this.add=function(cb){return function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}passed=args;command=cb;execute()}};this.activate=function(){active=true;if(replayOnActivate)execute()};this.disable=function(){active=false}}function toggleBetween(a,b){var on=true;return function(){on=!on;var enabled=on?b:a;var disabled=on?a:b;disabled.forEach(function(x){return x.disable()});enabled.forEach(function(x){return x.activate()});return on}}module.exports=pushControl},{"./bindPushChannelSelectButtons.js":21,"./bindPushTempoKnob.js":22,"./sampleNameShortening.js":28}],27:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),Scheduling=require("wac.scheduling");function Repetae(repeater,initial_interval){EventEmitter.call(this);var repetae=this;this._active=false;this._time_changed=false;this._being_pressed=false;this._current_interval=initial_interval;repeater.on("interval",function(interval){repetae.emit("intervalMs",interval)});repetae._current_interval.on("changed",repeater.updateInterval);repetae._current_interval.report();this.press=function(){repetae._being_pressed=true};this.release=function(){var started_active=repetae._active,time_changed=repetae._time_changed;repetae._time_changed=false;repetae._being_pressed=false;switch(true){case!started_active:repetae._active=true;repetae.emit("on");break;case started_active&&!time_changed:repetae._active=false;repetae.emit("off");break}};this.interval=function(new_interval){if(repetae._being_pressed){repetae._time_changed=true;repetae._current_interval.removeListener("changed",repeater.updateInterval);repetae._current_interval=new_interval;repetae._current_interval.on("changed",repeater.updateInterval);repetae.report_interval();repetae._current_interval.report()}};this.start=function(callback){if(!repetae._active){callback();return}repeater.start(callback)};this.stop=repeater.stop;this.report_interval=function(){repetae.emit("interval",repetae._current_interval.value)}}util.inherits(Repetae,EventEmitter);module.exports=function createRepetae(interval,context){var repeater=Scheduling(context).Repeater(1e3);return new Repetae(repeater,interval)}},{events:29,util:33,"wac.scheduling":11}],28:[function(require,module,exports){"use strict";var shortenToEight=function shortenToEight(s){
return s.slice(0,7)};function sampleNameShortening(filename){var shortened=filename.split(".")[0];while(shortened.length>8){shortened=removeFirst(shortened,"e")||removeFirst(shortened,"a")||removeFirst(shortened,"o")||removeFirst(shortened,"i")||removeFirst(shortened,"u")||shortenToEight(shortened)}return shortened}function removeFirst(s,char){if(!s.includes(char))return;var index=s.indexOf(char);return s.slice(0,index)+s.slice(index+1)}module.exports=sampleNameShortening},{}],29:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],30:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],31:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],32:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],33:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":32,_process:31,inherits:30}]},{},[1]);

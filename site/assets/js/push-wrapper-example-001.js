(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";var Push=require("push-wrapper"),foreach=require("lodash.foreach"),partial=require("lodash.partial"),Player=require("./src/player.js"),context=window.AudioContext?new window.AudioContext:new window.webkitAudioContext,Scheduling=require("wac.scheduling")(context),Sequencer=require("./src/Sequencer.js"),Repetae=require("./src/repetae.js"),bpm=Scheduling.BPM(120),Interval=require("./src/interval.js"),intervals={"1/4":Interval["4n"](bpm,"1/4"),"1/4t":Interval["4nt"](bpm,"1/4t"),"1/8":Interval["8n"](bpm,"1/8"),"1/8t":Interval["8nt"](bpm,"1/8t"),"1/16":Interval["16n"](bpm,"1/16"),"1/16t":Interval["16nt"](bpm,"1/16t"),"1/32":Interval["32n"](bpm,"1/32"),"1/32t":Interval["32nt"](bpm,"1/32t")},samples=[{path:"assets/audio/Bonus_Kick27.mp3",name:"kick"},{path:"assets/audio/snare_turnboot.mp3",name:"snare"},{path:"assets/audio/HandClap.mp3",name:"clap"},{path:"assets/audio/Beat07_Hat.mp3",name:"hat"},{path:"assets/audio/HH_KIT09_100_TMB.mp3",name:"tamb"},{path:"assets/audio/clingfilm.mp3",name:"cloing"},{path:"assets/audio/tang-1.mp3",name:"tang"},{path:"assets/audio/Cassette808_Tom01.mp3",name:"tom"}],filter_frequencies=[0,100,200,400,800,2e3,6e3,1e4,2e4],oneToEight=[1,2,3,4,5,6,7,8];bpm.setMaxListeners(20);window.addEventListener("load",function(){if(navigator.requestMIDIAccess){navigator.requestMIDIAccess({sysex:true}).then(Push.create_bound_to_web_midi_api).then(off_we_go)}else{Promise.resolve(new Push({send:function send(bytes){}})).then(off_we_go).then(show_no_midi_warning)}});function show_no_midi_warning(){document.getElementById("no-midi-warning").classList.add("pwe-no-midi-warning--show")}function off_we_go(bound_push){var players=create_players(),push=bound_push,metronome=setupMetronome(bpm,push),sequencer=makeSequencer(players,push,bpm,metronome);push.lcd.clear();foreach(players,function(player,i){var column_number=i+1,repetae=new Repetae(intervals["1/4"],context);push.grid.x[column_number].select.on("pressed",repetae.press);push.grid.x[column_number].select.on("released",repetae.release);push.grid.x[column_number].select.led_on();repetae.on("on",partial(push.grid.x[column_number].select.led_rgb,0,0,255));repetae.on("off",push.grid.x[column_number].select.led_on);repetae.on("interval",push.lcd.x[column_number].y[1].update);repetae.report_interval();foreach(intervals,function(interval,button_name){push.button[button_name].on("pressed",partial(repetae.interval,interval))});turn_off_column(push,column_number);push.lcd.x[column_number].y[2].update(samples[i].name);player.on("started",partial(turn_on_column,push,column_number));player.on("stopped",partial(turn_off_column,push,column_number));player.on("pitch",push.lcd.x[column_number].y[4].update);push.channel[column_number].knob.on("turned",player.changePitchByInterval);player.reportPitch();bind_column_to_player(push,player,column_number,repetae,sequencer)});foreach(intervals,function(interval,button_name){push.button[button_name].led_dim()});bind_pitchbend(push,players);bindQwertyButtonsToPlayback(players,sequencer);sequencer.on("play",function(data){players[data.player].cutOff(data.frequency).play(midiGain(data.velocity))});bpm.report();metronome.report()}function setupMetronome(bpm,push){var tap=Scheduling.Tap();tap.on("average",bpm.changeTo);var metronome=Scheduling.Metronome(4,bpm);metronome.setMaxListeners(20);var running=false;var accent=new Player("assets/audio/metronome-accent.mp3",context).toMaster();var tick=new Player("assets/audio/metronome-tick.mp3",context).toMaster();function toggleMetronome(){running=!running;if(running){push.button["metronome"].led_on();metronome.start()}else{push.button["metronome"].led_dim();metronome.stop()}}var mute=false;push.button["mute"].on("pressed",function(){mute=true;push.button["mute"].led_on()});push.button["mute"].on("released",function(){mute=false;push.button["mute"].led_dim()});push.button["mute"].led_dim();push.button["metronome"].on("pressed",function(){if(mute){toggleMetronomeMute()}else{toggleMetronome()}});push.button["metronome"].led_dim();push.button["tap_tempo"].on("pressed",tap.again);push.button["tap_tempo"].led_dim();bindKeypress(function(event){if(event.key==="m")toggleMetronome();if(event.key==="n")tap.again();if(event.key===",")toggleMetronomeMute()});var numberOfBeats=4;var shift=false;push.button["shift"].on("pressed",function(){shift=true});push.button["shift"].on("released",function(){shift=false});push.knob["tempo"].on("turned",function(delta){if(shift){metronome.updateNumberOfBeats(numberOfBeats+delta)}else{bpm.changeBy(delta)}});bpm.on("changed",function(bpm){return push.lcd.x[1].y[3].update("   bpm =")});bpm.on("changed",function(bpm){return push.lcd.x[2].y[3].update(bpm.current())});var tapTempoButton=document.getElementsByClassName("tap")[0];var metronomeOnOffButton=document.getElementsByClassName("metronome-on-off")[0];var metronomeMuteButton=document.getElementsByClassName("metronome-mute")[0];var bpmSlider=document.getElementById("bpm-control");var bpmLabel=document.querySelector("label[for='bpm-control']");var accentSlider=document.getElementById("accent-control");var accentLabel=document.querySelector("label[for='accent-control']");metronome.on("started",function(){return turn_button_display_on(metronomeOnOffButton)});metronome.on("stopped",function(){return turn_button_display_off(metronomeOnOffButton)});function flashTapTempo(){turn_button_display_on(tapTempoButton);setTimeout(function(){return turn_button_display_off(tapTempoButton)},100)}metronome.on("accent",flashTapTempo);metronome.on("tick",flashTapTempo);metronome.on("bpmChanged",function(bpm){bpmLabel.innerHTML="BPM: "+bpm.current();bpmSlider.value=bpm.current()});metronome.on("numberOfBeats",function(beats){accentLabel.innerHTML="ACCENT: "+beats+" beats";accentSlider.value=beats;push.lcd.x[3].y[3].update(beats+" bts");numberOfBeats=beats});bpmSlider.addEventListener("input",function(event){metronome.updateBPM(parseInt(event.target.value))});accentSlider.addEventListener("input",function(event){metronome.updateNumberOfBeats(parseInt(event.target.value))});metronomeOnOffButton.addEventListener("click",toggleMetronome);tapTempoButton.addEventListener("click",tap.again);metronomeMuteButton.addEventListener("click",toggleMetronomeMute);var muted=true;function toggleMetronomeMute(){muted=!muted;if(muted){metronome.removeListener("accent",accent.play);metronome.removeListener("tick",tick.play);push.lcd.x[4].y[3].update("muted");turn_button_display_on(metronomeMuteButton)}else{metronome.on("accent",accent.play);metronome.on("tick",tick.play);push.lcd.x[4].y[3].clear();turn_button_display_off(metronomeMuteButton)}}toggleMetronomeMute();return metronome}function makeSequencer(players,push,bpm,metronome){var selectionButtons=document.getElementsByClassName("sequence-selector");var armButton=document.getElementsByClassName("arm")[0];var playButton=document.getElementsByClassName("play")[0];var deleteButton=document.getElementsByClassName("delete")[0];var sequencer=new Sequencer(selectionButtons.length,Scheduling,bpm,metronome);sequencer.on("sequenceState",function(number,state,isSelected){switch(state){case"idle":if(isSelected){updateSequenceUiButton(selectionButtons[number-1],"selected");push.channel[number].select.orange();push.channel[number].select.led_on()}else{updateSequenceUiButton(selectionButtons[number-1],"");push.channel[number].select.led_off()}updateSequenceUiButton(armButton);updateSequenceUiButton(playButton);push.button["rec"].led_off();push.button["play"].led_off();break;case"armed":updateSequenceUiButton(selectionButtons[number-1],"recording");push.channel[number].select.red();push.channel[number].select.led_on();updateSequenceUiButton(armButton,"recording");updateSequenceUiButton(playButton);push.button["rec"].led_on();push.button["play"].led_off();break;case"recording":updateSequenceUiButton(selectionButtons[number-1],"recording");push.channel[number].select.red();push.channel[number].select.led_on();updateSequenceUiButton(armButton,"recording");updateSequenceUiButton(playButton);push.button["rec"].led_on();push.button["play"].led_off();break;case"overdubbing":updateSequenceUiButton(selectionButtons[number-1],"recording");push.channel[number].select.red();push.channel[number].select.led_on();updateSequenceUiButton(armButton,"recording");updateSequenceUiButton(playButton,"playing");push.button["rec"].led_dim();push.button["play"].led_on();break;case"playback":updateSequenceUiButton(selectionButtons[number-1],"playing");push.channel[number].select.green();push.channel[number].select.led_on();updateSequenceUiButton(armButton);updateSequenceUiButton(playButton,"playing");push.button["rec"].led_off();push.button["play"].led_on();break;case"stopped":if(isSelected){updateSequenceUiButton(selectionButtons[number-1],"selected");push.channel[number].select.orange()}else{updateSequenceUiButton(selectionButtons[number-1],"has-sequence");push.channel[number].select.yellow()}push.channel[number].select.led_on();updateSequenceUiButton(armButton);updateSequenceUiButton(playButton,"has-sequence");push.button["rec"].led_off();push.button["play"].led_dim();break}});bindKeypress(function(event){switch(event.key){case"g":sequencer.playButtonPressed();break;case"z":sequencer.recordButtonPressed();break;case"x":sequencer.deleteSequence();break;case"1":sequencer.selectSequence(1);break;case"2":sequencer.selectSequence(2);break;case"3":sequencer.selectSequence(3);break;case"4":sequencer.selectSequence(4);break;case"5":sequencer.selectSequence(5);break;case"6":sequencer.selectSequence(6);break;case"7":sequencer.selectSequence(7);break;case"8":sequencer.selectSequence(8);break}});Array.prototype.forEach.call(selectionButtons,function(button,i){button.addEventListener("mousedown",function(){sequencer.selectSequence(i+1)})});push.button["rec"].on("pressed",sequencer.recordButtonPressed);push.button["play"].on("pressed",sequencer.playButtonPressed);armButton.addEventListener("mousedown",sequencer.recordButtonPressed);playButton.addEventListener("mousedown",sequencer.playButtonPressed);deleteButton.addEventListener("mousedown",sequencer.deleteSequence);var deleteOrShift="off";push.button["delete"].led_dim();push.button["shift"].led_dim();push.button["delete"].on("pressed",function(){deleteOrShift="delete";push.button["delete"].led_on()});push.button["shift"].on("pressed",function(){deleteOrShift="shift";push.button["shift"].led_on()});push.button["delete"].on("released",function(){if(deleteOrShift==="delete")deleteOrShift="off";push.button["delete"].led_dim()});push.button["shift"].on("released",function(){if(deleteOrShift==="shift")deleteOrShift="off";push.button["shift"].led_dim()});oneToEight.forEach(function(x){push.channel[x].select.on("pressed",function(){switch(deleteOrShift){case"off":sequencer.selectSequence(x);break;case"delete":sequencer.deleteSequence(x);break;case"shift":sequencer.selectSequenceLegato(x,true);break}});push.channel[x].select.led_off()});sequencer.reportSelectedSequenceState();return sequencer}function create_players(){var players=[];for(var i=0;i<samples.length;i++){players[i]=new Player(samples[i].path,context).toMaster()}return players}function bind_column_to_player(push,player,x,repetae,sequencer){var mutable_velocity=127,mutable_frequency=filter_frequencies[8],pressed_pads_in_col=0;var playback=function playback(){player.cutOff(mutable_frequency).play(midiGain(mutable_velocity))};var padAftertouch=function padAftertouch(pressure){if(pressure>0)mutable_velocity=pressure};foreach(oneToEight,function(y){var grid_button=push.grid.x[x].y[y];grid_button.on("pressed",function(velocity){mutable_velocity=velocity;mutable_frequency=filter_frequencies[y];if(++pressed_pads_in_col==1)repetae.start(playback);sequencer.addEvent("play",{player:x-1,velocity:mutable_velocity,frequency:mutable_frequency})});grid_button.on("aftertouch",padAftertouch);grid_button.on("released",function(){--pressed_pads_in_col;if(pressed_pads_in_col==0)repetae.stop()})})}function bindQwertyButtonsToPlayback(players,sequencer){var buttons=document.getElementsByClassName("sample-playback");var velocity=110;var midiVelocity=midiGain(velocity);var f=filter_frequencies[8];foreach(players,function(player,i){player.on("started",partial(turn_button_display_on,buttons[i]));player.on("stopped",partial(turn_button_display_off,buttons[i]));buttons[i].addEventListener("mousedown",function(){player.cutOff(f).play(midiVelocity);sequencer.addEvent("play",{player:i,velocity:velocity,frequency:f})})});var lookup={q:0,w:1,e:2,r:3,t:4,y:5,u:6,i:7};bindKeypress(function(event){if(event.key in lookup){var index=lookup[event.key];players[index].cutOff(f).play(midiVelocity);sequencer.addEvent("play",{player:index,velocity:velocity,frequency:f})}})}function midiGain(_velocity){return{velocity:function velocity(){return _velocity},toAbsolute:function toAbsolute(){return _velocity/127}}}function turn_on_column(push,x,gain){foreach(oneToEight,function(y){if((gain.velocity()+15)/16>=y){push.grid.x[x].y[y].led_on(gain.velocity())}else{push.grid.x[x].y[y].led_off()}})}function turn_off_column(push,x){foreach([2,3,4,5,6,7,8],function(y){push.grid.x[x].y[y].led_off()});push.grid.x[x].y[1].led_on()}function bind_pitchbend(push,players){push.touchstrip.on("pitchbend",function(pb){var rate=scale(pb,0,16384,-12,12);foreach(players,function(player){return player.modulatePitch(rate)})})}function turn_button_display_on(ui_btn){ui_btn.classList.add("pwe-button--active")}function turn_button_display_off(ui_btn){ui_btn.classList.remove("pwe-button--active")}function scale(input,minIn,maxIn,minOut,maxOut){return(maxOut-minOut)*((input-minIn)/(maxIn-minIn))+minOut}function updateSequenceUiButton(button,state){["has-sequence","playing","recording","selected"].forEach(function(state){return button.classList.remove("pwe-button--"+state)});if(state){button.classList.add("pwe-button--"+state)}}function bindKeypress(callback){window.addEventListener("keypress",function(event){if(!event.key)event.key=String.fromCharCode(event.charCode);callback(event)})}},{"./src/Sequencer.js":33,"./src/interval.js":34,"./src/player.js":35,"./src/repetae.js":36,"lodash.foreach":9,"lodash.partial":13,"push-wrapper":16,"wac.scheduling":25}],2:[function(require,module,exports){function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}module.exports=arrayEach},{}],3:[function(require,module,exports){var keys=require("lodash.keys");var MAX_SAFE_INTEGER=9007199254740991;var baseEach=createBaseEach(baseForOwn);var baseFor=createBaseFor();function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){var length=collection?getLength(collection):0;if(!isLength(length)){return eachFunc(collection,iteratee)}var index=fromRight?length:-1,iterable=toObject(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;while(fromRight?index--:++index<length){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}var getLength=baseProperty("length");function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function toObject(value){return isObject(value)?value:Object(value)}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=baseEach},{"lodash.keys":12}],4:[function(require,module,exports){function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(thisArg===undefined){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function identity(value){return value}module.exports=bindCallback},{}],5:[function(require,module,exports){var root=require("lodash._root");var BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,FLIP_FLAG=512;var FUNC_ERROR_TEXT="Expected a function";var INFINITY=1/0,MAX_SAFE_INTEGER=9007199254740991,MAX_INTEGER=1.7976931348623157e308,NAN=0/0;var PLACEHOLDER="__lodash_placeholder__";var funcTag="[object Function]",genTag="[object GeneratorFunction]";var reTrim=/^\s+|\s+$/g;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var freeParseInt=parseInt;function apply(func,thisArg,args){var length=args.length;switch(length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function isIndex(value,length){value=typeof value=="number"||reIsUint.test(value)?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){if(array[index]===placeholder){array[index]=PLACEHOLDER;result[++resIndex]=index}}return result}var objectProto=Object.prototype;var objectToString=objectProto.toString;var nativeMax=Math.max,nativeMin=Math.min;var baseCreate=function(){function object(){}return function(prototype){if(isObject(prototype)){object.prototype=prototype;var result=new object;object.prototype=undefined}return result||{}}}();function composeArgs(args,partials,holders){var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(leftLength+argsLength);while(++leftIndex<leftLength){result[leftIndex]=partials[leftIndex]}while(++argsIndex<holdersLength){result[holders[argsIndex]]=args[argsIndex]}while(argsLength--){result[leftIndex++]=args[argsIndex++]}return result}function composeArgsRight(args,partials,holders){var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);while(++argsIndex<argsLength){result[argsIndex]=args[argsIndex]}var offset=argsIndex;while(++rightIndex<rightLength){result[offset+rightIndex]=partials[rightIndex]}while(++holdersIndex<holdersLength){result[offset+holders[holdersIndex]]=args[argsIndex++]}return result}function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}function createBaseWrapper(func,bitmask,thisArg){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,arguments)}return wrapper}function createCtorWrapper(Ctor){return function(){var args=arguments;switch(args.length){case 0:return new Ctor;case 1:return new Ctor(args[0]);case 2:return new Ctor(args[0],args[1]);case 3:return new Ctor(args[0],args[1],args[2]);case 4:return new Ctor(args[0],args[1],args[2],args[3]);case 5:return new Ctor(args[0],args[1],args[2],args[3],args[4]);case 6:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5]);case 7:return new Ctor(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,args);return isObject(result)?result:thisBinding}}function createCurryWrapper(func,bitmask,arity){var Ctor=createCtorWrapper(func);function wrapper(){var length=arguments.length,index=length,args=Array(length),fn=this&&this!==root&&this instanceof wrapper?Ctor:func,placeholder=wrapper.placeholder;while(index--){args[index]=arguments[index]}var holders=length<3&&args[0]!==placeholder&&args[length-1]!==placeholder?[]:replaceHolders(args,placeholder);length-=holders.length;return length<arity?createRecurryWrapper(func,bitmask,createHybridWrapper,placeholder,undefined,args,holders,undefined,undefined,arity-length):apply(fn,this,args)}return wrapper}function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG,isFlip=bitmask&FLIP_FLAG,Ctor=isBindKey?undefined:createCtorWrapper(func);function wrapper(){var length=arguments.length,index=length,args=Array(length);while(index--){args[index]=arguments[index]}if(partials){args=composeArgs(args,partials,holders)}if(partialsRight){args=composeArgsRight(args,partialsRight,holdersRight)}if(isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);length-=argsHolders.length;if(length<arity){return createRecurryWrapper(func,bitmask,createHybridWrapper,placeholder,thisArg,args,argsHolders,argPos,ary,arity-length)}}var thisBinding=isBind?thisArg:this,fn=isBindKey?thisBinding[func]:func;if(argPos){args=reorder(args,argPos)}else if(isFlip&&args.length>1){args.reverse()}if(isAry&&ary<args.length){args.length=ary}if(this&&this!==root&&this instanceof wrapper){fn=Ctor||createCtorWrapper(fn)}return fn.apply(thisBinding,args)}return wrapper}function createPartialWrapper(func,bitmask,thisArg,partials){var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);function wrapper(){var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(leftLength+argsLength),fn=this&&this!==root&&this instanceof wrapper?Ctor:func;while(++leftIndex<leftLength){args[leftIndex]=partials[leftIndex]}while(argsLength--){args[leftIndex++]=arguments[++argsIndex]}return apply(fn,isBind?thisArg:this,args)}return wrapper}function createRecurryWrapper(func,bitmask,wrapFunc,placeholder,thisArg,partials,holders,argPos,ary,arity){var isCurry=bitmask&CURRY_FLAG,newArgPos=argPos?copyArray(argPos):undefined,newsHolders=isCurry?holders:undefined,newHoldersRight=isCurry?undefined:holders,newPartials=isCurry?partials:undefined,newPartialsRight=isCurry?undefined:partials;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG;bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG);if(!(bitmask&CURRY_BOUND_FLAG)){bitmask&=~(BIND_FLAG|BIND_KEY_FLAG)}var result=wrapFunc(func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,arity);result.placeholder=placeholder;return result}function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var length=partials?partials.length:0;if(!length){bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG);partials=holders=undefined}ary=ary===undefined?ary:nativeMax(toInteger(ary),0);arity=arity===undefined?arity:toInteger(arity);length-=holders?holders.length:0;if(bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=undefined}var newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];func=newData[0];bitmask=newData[1];thisArg=newData[2];partials=newData[3];holders=newData[4];arity=newData[9]=newData[9]==null?isBindKey?0:func.length:nativeMax(newData[9]-length,0);if(!arity&&bitmask&(CURRY_FLAG|CURRY_RIGHT_FLAG)){bitmask&=~(CURRY_FLAG|CURRY_RIGHT_FLAG)}if(!bitmask||bitmask==BIND_FLAG){var result=createBaseWrapper(func,bitmask,thisArg)}else if(bitmask==CURRY_FLAG||bitmask==CURRY_RIGHT_FLAG){result=createCurryWrapper(func,bitmask,arity)}else if((bitmask==PARTIAL_FLAG||bitmask==(BIND_FLAG|PARTIAL_FLAG))&&!holders.length){result=createPartialWrapper(func,bitmask,thisArg,partials)}else{result=createHybridWrapper.apply(undefined,newData)}return result}function reorder(array,indexes){var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=copyArray(array);while(length--){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function toInteger(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER}var remainder=value%1;return value===value?remainder?value-remainder:value:0}function toNumber(value){if(isObject(value)){var other=isFunction(value.valueOf)?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}module.exports=createWrapper},{"lodash._root":8}],6:[function(require,module,exports){var funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=getNative},{}],7:[function(require,module,exports){var PLACEHOLDER="__lodash_placeholder__";function replaceHolders(array,placeholder){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){if(array[index]===placeholder){array[index]=PLACEHOLDER;result[++resIndex]=index}}return result}module.exports=replaceHolders},{}],8:[function(require,module,exports){(function(global){var objectTypes={function:true,object:true};var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType?exports:undefined;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType?module:undefined;var freeGlobal=checkGlobal(freeExports&&freeModule&&typeof global=="object"&&global);var freeSelf=checkGlobal(objectTypes[typeof self]&&self);var freeWindow=checkGlobal(objectTypes[typeof window]&&window);var thisGlobal=checkGlobal(objectTypes[typeof this]&&this);var root=freeGlobal||freeWindow!==(thisGlobal&&thisGlobal.window)&&freeWindow||freeSelf||thisGlobal||Function("return this")();function checkGlobal(value){return value&&value.Object===Object?value:null}module.exports=root}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],9:[function(require,module,exports){var arrayEach=require("lodash._arrayeach"),baseEach=require("lodash._baseeach"),bindCallback=require("lodash._bindcallback"),isArray=require("lodash.isarray");function createForEach(arrayFunc,eachFunc){return function(collection,iteratee,thisArg){return typeof iteratee=="function"&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee):eachFunc(collection,bindCallback(iteratee,thisArg,3))}}var forEach=createForEach(arrayEach,baseEach);module.exports=forEach},{"lodash._arrayeach":2,"lodash._baseeach":3,"lodash._bindcallback":4,"lodash.isarray":11}],10:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]";var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var propertyIsEnumerable=objectProto.propertyIsEnumerable;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}function isArrayLike(value){return value!=null&&isLength(getLength(value))&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}module.exports=isArguments},{}],11:[function(require,module,exports){var arrayTag="[object Array]",funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var nativeIsArray=getNative(Array,"isArray");var MAX_SAFE_INTEGER=9007199254740991;function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag};function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=isArray},{}],12:[function(require,module,exports){var getNative=require("lodash._getnative"),isArguments=require("lodash.isarguments"),isArray=require("lodash.isarray");var reIsUint=/^\d+$/;var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var nativeKeys=getNative(Object,"keys");var MAX_SAFE_INTEGER=9007199254740991;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isIndex(value,length){
value=typeof value=="number"||reIsUint.test(value)?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length;var allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}var keys=!nativeKeys?shimKeys:function(object){var Ctor=object==null?undefined:object.constructor;if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&isArrayLike(object)){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}module.exports=keys},{"lodash._getnative":6,"lodash.isarguments":10,"lodash.isarray":11}],13:[function(require,module,exports){var createWrapper=require("lodash._createwrapper"),replaceHolders=require("lodash._replaceholders"),restParam=require("lodash.restparam");var PARTIAL_FLAG=32;function createPartial(flag){var partialFunc=restParam(function(func,partials){var holders=replaceHolders(partials,partialFunc.placeholder);return createWrapper(func,flag,undefined,partials,holders)});return partialFunc}var partial=createPartial(PARTIAL_FLAG);partial.placeholder={};module.exports=partial},{"lodash._createwrapper":5,"lodash._replaceholders":7,"lodash.restparam":15}],14:[function(require,module,exports){var MAX_SAFE_INTEGER=9007199254740991,NAN=0/0;var funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]";var reTrim=/^\s+|\s+$/g;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var reIsUint=/^(?:0|[1-9]\d*)$/;var freeParseInt=parseInt;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var objectProto=Object.prototype;var objectToString=objectProto.toString;var nativeCeil=Math.ceil,nativeMax=Math.max;function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step}return result}function createRange(fromRight){return function(start,end,step){if(step&&typeof step!="number"&&isIterateeCall(start,end,step)){end=step=undefined}start=toNumber(start);start=start===start?start:0;if(end===undefined){end=start;start=0}else{end=toNumber(end)||0}step=step===undefined?start<end?1:-1:toNumber(step)||0;return baseRange(start,end,step,fromRight)}}var getLength=baseProperty("length");function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function eq(value,other){return value===other||value!==value&&other!==other}function isArrayLike(value){return value!=null&&isLength(getLength(value))&&!isFunction(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=isFunction(value.valueOf)?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}var range=createRange();module.exports=range},{}],15:[function(require,module,exports){var FUNC_ERROR_TEXT="Expected a function";var nativeMax=Math.max;function restParam(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=nativeMax(start===undefined?func.length-1:+start||0,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);while(++index<length){rest[index]=args[start+index]}switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest)}var otherArgs=Array(start+1);index=-1;while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=rest;return func.apply(this,otherArgs)}}module.exports=restParam},{}],16:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),Buttons=require("./src/buttons.js"),Knobs=require("./src/knobs"),Grid=require("./src/grid.js"),Touchstrip=require("./src/touchstrip.js"),ControlButtons=require("./src/control-buttons.js"),LCDs=require("./src/lcds.js"),foreach=require("lodash.foreach"),partial=require("lodash.partial"),one_to_eight=[1,2,3,4,5,6,7,8];function Push(midi_out_port){var _this=this;EventEmitter.call(this);var midi_out={send_cc:function send_cc(cc,value){midi_out_port.send([176,cc,value])},send_note:function send_note(note,velocity){midi_out_port.send([144,note,velocity])},send_sysex:function send_sysex(data){midi_out_port.send([240,71,127,21].concat(data).concat([247]))}};var buttons=new Buttons(midi_out.send_cc);this.knobs=new Knobs;this.grid=new Grid(midi_out.send_note,midi_out.send_cc,midi_out.send_sysex);this.touchstrip=new Touchstrip;this.control=new ControlButtons(midi_out.send_cc);this.ccMap=[];this.noteMap=[];foreach([this.knobs,this.touchstrip,this.grid],function(module){return foreach(module.handled_notes,function(value,key){return _this.noteMap[value]=module})});foreach([this.knobs,this.control,buttons,this.grid],function(module){return foreach(module.handled_ccs,function(value,key){return _this.ccMap[value]=module})});var api={knob:{tempo:this.knobs.tempo,swing:this.knobs.swing,master:this.knobs.master},grid:{x:{}},touchstrip:this.touchstrip,lcd:new LCDs(midi_out.send_sysex),button:{"1/32t":this.control["1/32t"],"1/32":this.control["1/32"],"1/16t":this.control["1/16t"],"1/16":this.control["1/16"],"1/8t":this.control["1/8t"],"1/8":this.control["1/8"],"1/4t":this.control["1/4t"],"1/4":this.control["1/4"]},channel:{},receive_midi:partial(receive_midi,this)};foreach(one_to_eight,function(number){return api.channel[number]={knob:_this.knobs[number],select:_this.control[number]}});foreach(one_to_eight,function(X){api.grid.x[X]={y:{},select:_this.grid.select[X]};foreach(one_to_eight,function(Y){api.grid.x[X].y[Y]=_this.grid.x[X].y[Y]})});foreach(buttons.names,function(button_name){return api.button[button_name]=buttons[button_name]});return api}util.inherits(Push,EventEmitter);function handle_midi_cc(push,index,value){if(index in push.ccMap){push.ccMap[index].receive_midi_cc(index,value)}else{console.log("No known mapping for CC: "+index)}}function handle_midi_note(push,note,velocity){if(note in push.noteMap){push.noteMap[note].receive_midi_note(note,velocity)}else{console.log("No known mapping for note: "+note)}}function handle_midi_pitch_bend(push,lsb_byte,msb_byte){push.touchstrip.receive_midi_pitch_bend((msb_byte<<7)+lsb_byte)}function handle_midi_poly_pressure(push,note,pressure){push.grid.receive_midi_poly_pressure(note,pressure)}var midi_messages={"note-off":128,"note-on":144,"poly-pressure":160,cc:176,"program-change":192,"channel-pressure":208,"pitch-bend":224,sysex:240};function receive_midi(push,bytes){var message_type=bytes[0]&240;var midi_channel=bytes[0]&15;switch(message_type){case midi_messages["cc"]:handle_midi_cc(push,bytes[1],bytes[2]);break;case midi_messages["note-on"]:case midi_messages["note-off"]:handle_midi_note(push,bytes[1],bytes[2]);break;case midi_messages["pitch-bend"]:handle_midi_pitch_bend(push,bytes[1],bytes[2]);break;case midi_messages["poly-pressure"]:handle_midi_poly_pressure(push,bytes[1],bytes[2]);break}}Push.create_bound_to_web_midi_api=function(midiAccess){var inputs=midiAccess.inputs.values(),outputs=midiAccess.outputs.values(),push;for(var output=outputs.next();output&&!output.done;output=outputs.next()){console.log("Found output: "+output.value.name);if("Ableton Push User Port"==output.value.name){console.log("Binding MIDI output to "+output.value.name);push=new Push(output.value);break}}if(push===undefined)push=new Push({send:function send(bytes){}});for(var input=inputs.next();input&&!input.done;input=inputs.next()){console.log("Found input: "+input.value.name);if("Ableton Push User Port"==input.value.name){console.log("Binding MIDI input to "+input.value.name);input.value.onmidimessage=function(event){push.receive_midi(event.data)};break}}return push};module.exports=Push},{"./src/buttons.js":17,"./src/control-buttons.js":18,"./src/grid.js":19,"./src/knobs":20,"./src/lcds.js":21,"./src/touchstrip.js":22,events:37,"lodash.foreach":9,"lodash.partial":13,util:41}],17:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),foreach=require("lodash.foreach");var ccToButtonMap={3:"tap_tempo",9:"metronome",119:"undo",118:"delete",117:"double",116:"quantize",90:"fixed_length",89:"automation",88:"duplicate",87:"new",86:"rec",85:"play",28:"master",29:"stop",44:"left",45:"right",46:"up",47:"down",114:"volume",115:"pan_&_send",112:"track",113:"clip",110:"device",111:"browse",62:"step_in",63:"step_out",60:"mute",61:"solo",58:"scales",59:"user",56:"repeat",57:"accent",54:"octave_down",55:"octave_up",52:"add_effect",53:"add_track",50:"note",51:"session",48:"select",49:"shift"};var handled_ccs=Object.keys(ccToButtonMap);function Button(send_cc,cc){EventEmitter.call(this);return{led_on:function led_on(){send_cc(cc,4)},led_dim:function led_dim(){send_cc(cc,1)},led_off:function led_off(){send_cc(cc,0)},red:function red(){},orange:function orange(){},yellow:function yellow(){},green:function green(){},on:this.on,emit:this.emit}}util.inherits(Button,EventEmitter);function Buttons(send_cc){var _this=this;var buttons=this;foreach(ccToButtonMap,function(value,key){return _this[value]=new Button(send_cc,parseInt(key))});this.names=Object.keys(ccToButtonMap).map(function(key){return ccToButtonMap[key]});this.receive_midi_cc=function(index,value){buttons[ccToButtonMap[index]].emit(pressed_or_released(value))};this.handled_ccs=handled_ccs}function pressed_or_released(velocity){return parseInt(velocity)>0?"pressed":"released"}module.exports=Buttons},{events:37,"lodash.foreach":9,util:41}],18:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),foreach=require("lodash.foreach");var ccToPadMap={20:1,21:2,22:3,23:4,24:5,25:6,26:7,27:8,43:"1/32t",42:"1/32",41:"1/16t",40:"1/16",39:"1/8t",38:"1/8",37:"1/4t",36:"1/4"};var handled_ccs=Object.keys(ccToPadMap);function Pad(send_cc,cc){EventEmitter.call(this);this.output=function(value){send_cc(cc,value)};var colours=[7,10];this.colours=[7,10];return{led_on:function led_on(){send_cc(cc,colours[1])},led_dim:function led_dim(){send_cc(cc,colours[0])},led_off:function led_off(){send_cc(cc,0)},red:function red(){colours=[1,4]},orange:function orange(){colours=[7,10]},yellow:function yellow(){colours=[13,16]},green:function green(){colours=[19,22]},on:this.on,emit:this.emit}}util.inherits(Pad,EventEmitter);function ControlButtons(send_cc){var _this=this;var control_buttons=this;foreach(ccToPadMap,function(value,key){return _this[value]=new Pad(send_cc,parseInt(key))});this.handled_ccs=handled_ccs;this.receive_midi_cc=function(cc,value){var pad_name=ccToPadMap[cc];control_buttons[pad_name].emit(value>0?"pressed":"released")}}module.exports=ControlButtons},{events:37,"lodash.foreach":9,util:41}],19:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),foreach=require("lodash.foreach"),partial=require("lodash.partial");var control_buttons={102:1,103:2,104:3,105:4,106:5,107:6,108:7,109:8};var handled_ccs=Object.keys(control_buttons);var handled_notes=[];for(var i=36;i<=99;i++){handled_notes.push(i)}function GridButton(send_midi_message,send_sysex,note){EventEmitter.call(this);this.note_out=function(velocity){send_midi_message(note,velocity)};this.sysex_out=function(data){send_sysex(data)};this.index=note<102?note-36:note-38;return{led_on:partial(led_on,this),led_off:partial(led_off,this),led_rgb:partial(led_rgb,this),on:this.on,emit:this.emit}}util.inherits(GridButton,EventEmitter);function led_on(gridButton,value){gridButton.note_out(value?value:100)}function led_off(gridButton){gridButton.note_out(0)}function led_rgb(gridButton,r,g,b){var msb=[r,g,b].map(function(x){return(x&240)>>4}),lsb=[r,g,b].map(function(x){return x&15});gridButton.sysex_out([4,0,8,gridButton.index,0,msb[0],lsb[0],msb[1],lsb[1],msb[2],lsb[2]])}function Grid(send_note,send_cc,send_sysex){var _this=this;this.x={};this.select={};for(var x=1;x<=8;x++){this.x[x]={y:{}};for(var y=1;y<=8;y++){this.x[x].y[y]=new GridButton(send_note,send_sysex,x-1+(y-1)*8+36)}}foreach(control_buttons,function(value,key){return _this.select[value]=new GridButton(send_cc,send_sysex,parseInt(key))});this.handled_ccs=handled_ccs;this.handled_notes=handled_notes;this.receive_midi_note=partial(receive_midi_note,this);this.receive_midi_cc=partial(receive_midi_cc,this);this.receive_midi_poly_pressure=partial(receive_midi_poly_pressure,this)}function receive_midi_note(grid,note,velocity){var button=button_from_note(grid,note),vel=parseInt(velocity);vel>0?button.emit("pressed",vel):button.emit("released")}function receive_midi_cc(grid,index,value){grid.select[control_buttons[index]].emit(value>0?"pressed":"released")}function receive_midi_poly_pressure(grid,note,pressure){button_from_note(grid,note).emit("aftertouch",parseInt(pressure))}function button_from_note(grid,note){var indexed_from_zero=note-36,x=indexed_from_zero%8+1,y=parseInt(indexed_from_zero/8)+1;return grid.x[x].y[y]}module.exports=Grid},{events:37,"lodash.foreach":9,"lodash.partial":13,util:41}],20:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),foreach=require("lodash.foreach"),partial=require("lodash.partial");var knobMap={tempo:{cc:14,note:10},swing:{cc:15,note:9},1:{cc:71,note:0},2:{cc:72,note:1},3:{cc:73,note:2},4:{cc:74,note:3},5:{cc:75,note:4},6:{cc:76,note:5},7:{cc:77,note:6},8:{cc:78,note:7},master:{cc:79,note:8}};var ccToKnobMap={};var noteToKnobMap={};foreach(knobMap,function(value,key){ccToKnobMap[value.cc]=key;noteToKnobMap[value.note]=key});var handled_ccs=Object.keys(ccToKnobMap),handled_notes=Object.keys(noteToKnobMap);function Knob(){EventEmitter.call(this)}util.inherits(Knob,EventEmitter);function Knobs(){var _this=this;foreach(knobMap,function(value,key){return _this[key]=new Knob});this.handled_ccs=handled_ccs;this.receive_midi_cc=partial(receive_midi_cc,this);this.receive_midi_note=partial(receive_midi_note,this);this.handled_notes=handled_notes}function receive_midi_cc(knobs,index,value){var knob_name=ccToKnobMap[index];var delta=value<64?value:value-128;knobs[knob_name].emit("turned",delta)}function receive_midi_note(knobs,note,velocity){var knob_name=noteToKnobMap[note];var event_name=velocity>0?"pressed":"released";knobs[knob_name].emit(event_name)}module.exports=Knobs},{events:37,"lodash.foreach":9,"lodash.partial":13,util:41}],21:[function(require,module,exports){"use strict";var foreach=require("lodash.foreach"),range=require("lodash.range"),one_to_eight=[1,2,3,4,5,6,7,8],one_to_four=[1,2,3,4],zero_to_seven=[0,1,2,3,4,5,6,7],blank=32,blank_line=range(blank,100,0),offsets=[0,9,17,26,34,43,51,60];function LCDSegment(update){this.update=function(text){update(lcd_data(text))};this.clear=function(){update(lcd_data(""))}}function lcd_data(text){var text_string=String(text);return zero_to_seven.map(function(index){return text_string.length>index?text_string.charCodeAt(index):blank})}function LCDs(send_sysex){var lcds=this;this.clear=function(){foreach(one_to_eight,function(x){lcds.x[x]={y:{}};foreach(one_to_four,function(y){lcds.x[x].y[y]=new LCDSegment(function(display_data){send_sysex([28-y].concat([0,9,offsets[x-1]]).concat(display_data))})})});foreach(one_to_four,function(row){return send_sysex([28-row].concat([0,69,0]).concat(blank_line))})};this.x={};this.clear();this.x[8].y[4].update(" powered");this.x[8].y[3].update("      by");this.x[8].y[2].update("   push-");this.x[8].y[1].update(" wrapper")}module.exports=LCDs},{"lodash.foreach":9,"lodash.range":14}],22:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),partial=require("lodash.partial"),handled_notes=[12];function TouchStrip(){EventEmitter.call(this);this.receive_midi_pitch_bend=partial(receive_midi_pitch_bend,this);this.receive_midi_note=partial(receive_midi_note,this);this.handled_notes=handled_notes}util.inherits(TouchStrip,EventEmitter);function receive_midi_pitch_bend(touchstrip,fourteen_bit_value){if(fourteen_bit_value==8192)return;touchstrip.emit("pitchbend",fourteen_bit_value)}function receive_midi_note(touchstrip,note,velocity){if(velocity>0){touchstrip.emit("pressed")}else{touchstrip.emit("released");touchstrip.emit("pitchbend",8192)}}module.exports=TouchStrip},{events:37,"lodash.partial":13,util:41}],23:[function(require,module,exports){(function(){"use strict";var __={"@@functional/placeholder":true};var _arity=function _arity(n,fn){switch(n){case 0:return function(){return fn.apply(this,arguments)};case 1:return function(a0){return fn.apply(this,arguments)};case 2:return function(a0,a1){return fn.apply(this,arguments)};case 3:return function(a0,a1,a2){return fn.apply(this,arguments)};case 4:return function(a0,a1,a2,a3){return fn.apply(this,arguments)};case 5:return function(a0,a1,a2,a3,a4){return fn.apply(this,arguments)};case 6:return function(a0,a1,a2,a3,a4,a5){return fn.apply(this,arguments)};case 7:return function(a0,a1,a2,a3,a4,a5,a6){return fn.apply(this,arguments)};case 8:return function(a0,a1,a2,a3,a4,a5,a6,a7){return fn.apply(this,arguments)};case 9:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8){return fn.apply(this,arguments)};case 10:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9){return fn.apply(this,arguments)};default:throw new Error("First argument to _arity must be a non-negative integer no greater than ten")}};var _arrayFromIterator=function _arrayFromIterator(iter){var list=[];var next;while(!(next=iter.next()).done){list.push(next.value)}return list};var _arrayOf=function _arrayOf(){return Array.prototype.slice.call(arguments)};var _cloneRegExp=function _cloneRegExp(pattern){return new RegExp(pattern.source,(pattern.global?"g":"")+(pattern.ignoreCase?"i":"")+(pattern.multiline?"m":"")+(pattern.sticky?"y":"")+(pattern.unicode?"u":""))};var _complement=function _complement(f){return function(){return!f.apply(this,arguments)}};var _concat=function _concat(set1,set2){set1=set1||[];set2=set2||[];var idx;var len1=set1.length;var len2=set2.length;var result=[];idx=0;while(idx<len1){result[result.length]=set1[idx];idx+=1}idx=0;while(idx<len2){result[result.length]=set2[idx];idx+=1}return result};var _containsWith=function _containsWith(pred,x,list){var idx=0;var len=list.length;while(idx<len){if(pred(x,list[idx])){return true}idx+=1}return false};var _filter=function _filter(fn,list){var idx=0;var len=list.length;var result=[];while(idx<len){if(fn(list[idx])){result[result.length]=list[idx]}idx+=1}return result};var _forceReduced=function _forceReduced(x){return{"@@transducer/value":x,"@@transducer/reduced":true}};var _functionName=function _functionName(f){var match=String(f).match(/^function (\w*)/);return match==null?"":match[1]};var _has=function _has(prop,obj){return Object.prototype.hasOwnProperty.call(obj,prop)};var _identity=function _identity(x){return x};var _isArguments=function(){var toString=Object.prototype.toString;return toString.call(arguments)==="[object Arguments]"?function _isArguments(x){return toString.call(x)==="[object Arguments]"}:function _isArguments(x){return _has("callee",x)}}();var _isArray=Array.isArray||function _isArray(val){return val!=null&&val.length>=0&&Object.prototype.toString.call(val)==="[object Array]"};var _isFunction=function _isFunction(x){return Object.prototype.toString.call(x)==="[object Function]"};var _isInteger=Number.isInteger||function _isInteger(n){return n<<0===n};var _isNumber=function _isNumber(x){return Object.prototype.toString.call(x)==="[object Number]"};var _isObject=function _isObject(x){return Object.prototype.toString.call(x)==="[object Object]"};var _isPlaceholder=function _isPlaceholder(a){return a!=null&&typeof a==="object"&&a["@@functional/placeholder"]===true};var _isRegExp=function _isRegExp(x){return Object.prototype.toString.call(x)==="[object RegExp]"};var _isString=function _isString(x){return Object.prototype.toString.call(x)==="[object String]"};var _isTransformer=function _isTransformer(obj){return typeof obj["@@transducer/step"]==="function"};var _map=function _map(fn,functor){var idx=0;var len=functor.length;var result=Array(len);while(idx<len){result[idx]=fn(functor[idx]);idx+=1}return result};var _objectAssign=function _objectAssign(target){if(target==null){throw new TypeError("Cannot convert undefined or null to object")}var output=Object(target);var idx=1;var length=arguments.length;while(idx<length){var source=arguments[idx];if(source!=null){for(var nextKey in source){if(_has(nextKey,source)){output[nextKey]=source[nextKey]}}}idx+=1}return output};var _of=function _of(x){return[x]};var _pipe=function _pipe(f,g){return function(){return g.call(this,f.apply(this,arguments))}};var _pipeP=function _pipeP(f,g){return function(){var ctx=this;return f.apply(ctx,arguments).then(function(x){return g.call(ctx,x)})}};var _quote=function _quote(s){var escaped=s.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\f/g,"\\f").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\v/g,"\\v").replace(/\0/g,"\\0");return'"'+escaped.replace(/"/g,'\\"')+'"'};var _reduced=function _reduced(x){return x&&x["@@transducer/reduced"]?x:{"@@transducer/value":x,"@@transducer/reduced":true}};var _slice=function _slice(args,from,to){switch(arguments.length){case 1:return _slice(args,0,args.length);case 2:return _slice(args,from,args.length);default:var list=[];var idx=0;var len=Math.max(0,Math.min(args.length,to)-from);while(idx<len){list[idx]=args[from+idx];idx+=1}return list}};var _toISOString=function(){var pad=function pad(n){return(n<10?"0":"")+n};return typeof Date.prototype.toISOString==="function"?function _toISOString(d){return d.toISOString()}:function _toISOString(d){return d.getUTCFullYear()+"-"+pad(d.getUTCMonth()+1)+"-"+pad(d.getUTCDate())+"T"+pad(d.getUTCHours())+":"+pad(d.getUTCMinutes())+":"+pad(d.getUTCSeconds())+"."+(d.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}}();var _xfBase={init:function(){return this.xf["@@transducer/init"]()},result:function(result){return this.xf["@@transducer/result"](result)}};var _xwrap=function(){function XWrap(fn){this.f=fn}XWrap.prototype["@@transducer/init"]=function(){throw new Error("init not implemented on XWrap")};XWrap.prototype["@@transducer/result"]=function(acc){return acc};XWrap.prototype["@@transducer/step"]=function(acc,x){return this.f(acc,x)};return function _xwrap(fn){return new XWrap(fn)}}();var _aperture=function _aperture(n,list){var idx=0;var limit=list.length-(n-1);var acc=new Array(limit>=0?limit:0);while(idx<limit){acc[idx]=_slice(list,idx,idx+n);idx+=1}return acc};var _assign=typeof Object.assign==="function"?Object.assign:_objectAssign;var _checkForMethod=function _checkForMethod(methodname,fn){return function(){var length=arguments.length;if(length===0){return fn()}var obj=arguments[length-1];return _isArray(obj)||typeof obj[methodname]!=="function"?fn.apply(this,arguments):obj[methodname].apply(obj,_slice(arguments,0,length-1))}};var _curry1=function _curry1(fn){return function f1(a){if(arguments.length===0||_isPlaceholder(a)){return f1}else{return fn.apply(this,arguments)}}};var _curry2=function _curry2(fn){return function f2(a,b){switch(arguments.length){case 0:return f2;case 1:return _isPlaceholder(a)?f2:_curry1(function(_b){return fn(a,_b)});default:return _isPlaceholder(a)&&_isPlaceholder(b)?f2:_isPlaceholder(a)?_curry1(function(_a){return fn(_a,b)}):_isPlaceholder(b)?_curry1(function(_b){return fn(a,_b)}):fn(a,b)}}};var _curry3=function _curry3(fn){return function f3(a,b,c){switch(arguments.length){case 0:return f3;case 1:return _isPlaceholder(a)?f3:_curry2(function(_b,_c){return fn(a,_b,_c)});case 2:return _isPlaceholder(a)&&_isPlaceholder(b)?f3:_isPlaceholder(a)?_curry2(function(_a,_c){return fn(_a,b,_c)}):_isPlaceholder(b)?_curry2(function(_b,_c){return fn(a,_b,_c)}):_curry1(function(_c){return fn(a,b,_c)});default:return _isPlaceholder(a)&&_isPlaceholder(b)&&_isPlaceholder(c)?f3:_isPlaceholder(a)&&_isPlaceholder(b)?_curry2(function(_a,_b){return fn(_a,_b,c)}):_isPlaceholder(a)&&_isPlaceholder(c)?_curry2(function(_a,_c){return fn(_a,b,_c)}):_isPlaceholder(b)&&_isPlaceholder(c)?_curry2(function(_b,_c){return fn(a,_b,_c)}):_isPlaceholder(a)?_curry1(function(_a){return fn(_a,b,c)}):_isPlaceholder(b)?_curry1(function(_b){return fn(a,_b,c)}):_isPlaceholder(c)?_curry1(function(_c){return fn(a,b,_c)}):fn(a,b,c)}}};var _curryN=function _curryN(length,received,fn){return function(){var combined=[];var argsIdx=0;var left=length;var combinedIdx=0;while(combinedIdx<received.length||argsIdx<arguments.length){var result;if(combinedIdx<received.length&&(!_isPlaceholder(received[combinedIdx])||argsIdx>=arguments.length)){result=received[combinedIdx]}else{result=arguments[argsIdx];argsIdx+=1}combined[combinedIdx]=result;if(!_isPlaceholder(result)){left-=1}combinedIdx+=1}return left<=0?fn.apply(this,combined):_arity(left,_curryN(length,combined,fn))}};var _dispatchable=function _dispatchable(methodname,xf,fn){return function(){var length=arguments.length;if(length===0){return fn()}var obj=arguments[length-1];if(!_isArray(obj)){var args=_slice(arguments,0,length-1);if(typeof obj[methodname]==="function"){return obj[methodname].apply(obj,args)}if(_isTransformer(obj)){var transducer=xf.apply(null,args);return transducer(obj)}}return fn.apply(this,arguments)}};var _dropLastWhile=function dropLastWhile(pred,list){var idx=list.length-1;while(idx>=0&&pred(list[idx])){idx-=1}return _slice(list,0,idx+1)};var _xall=function(){function XAll(f,xf){this.xf=xf;this.f=f;this.all=true}XAll.prototype["@@transducer/init"]=_xfBase.init;XAll.prototype["@@transducer/result"]=function(result){if(this.all){result=this.xf["@@transducer/step"](result,true)}return this.xf["@@transducer/result"](result)};XAll.prototype["@@transducer/step"]=function(result,input){if(!this.f(input)){this.all=false;result=_reduced(this.xf["@@transducer/step"](result,false))}return result};return _curry2(function _xall(f,xf){return new XAll(f,xf)})}();var _xany=function(){function XAny(f,xf){this.xf=xf;this.f=f;this.any=false}XAny.prototype["@@transducer/init"]=_xfBase.init;XAny.prototype["@@transducer/result"]=function(result){if(!this.any){result=this.xf["@@transducer/step"](result,false)}return this.xf["@@transducer/result"](result)};XAny.prototype["@@transducer/step"]=function(result,input){if(this.f(input)){this.any=true;result=_reduced(this.xf["@@transducer/step"](result,true))}return result};return _curry2(function _xany(f,xf){return new XAny(f,xf)})}();var _xaperture=function(){function XAperture(n,xf){this.xf=xf;this.pos=0;this.full=false;this.acc=new Array(n)}XAperture.prototype["@@transducer/init"]=_xfBase.init;XAperture.prototype["@@transducer/result"]=function(result){this.acc=null;return this.xf["@@transducer/result"](result)};XAperture.prototype["@@transducer/step"]=function(result,input){this.store(input);return this.full?this.xf["@@transducer/step"](result,this.getCopy()):result};XAperture.prototype.store=function(input){this.acc[this.pos]=input;this.pos+=1;if(this.pos===this.acc.length){this.pos=0;this.full=true}};XAperture.prototype.getCopy=function(){return _concat(_slice(this.acc,this.pos),_slice(this.acc,0,this.pos))};return _curry2(function _xaperture(n,xf){return new XAperture(n,xf)})}();var _xdrop=function(){function XDrop(n,xf){this.xf=xf;this.n=n}XDrop.prototype["@@transducer/init"]=_xfBase.init;XDrop.prototype["@@transducer/result"]=_xfBase.result;XDrop.prototype["@@transducer/step"]=function(result,input){if(this.n>0){this.n-=1;return result}return this.xf["@@transducer/step"](result,input)};return _curry2(function _xdrop(n,xf){return new XDrop(n,xf)})}();var _xdropLast=function(){function XDropLast(n,xf){this.xf=xf;this.pos=0;this.full=false;this.acc=new Array(n)}XDropLast.prototype["@@transducer/init"]=_xfBase.init;XDropLast.prototype["@@transducer/result"]=function(result){this.acc=null;return this.xf["@@transducer/result"](result)};XDropLast.prototype["@@transducer/step"]=function(result,input){if(this.full){result=this.xf["@@transducer/step"](result,this.acc[this.pos])}this.store(input);return result};XDropLast.prototype.store=function(input){this.acc[this.pos]=input;this.pos+=1;if(this.pos===this.acc.length){this.pos=0;this.full=true}};return _curry2(function _xdropLast(n,xf){return new XDropLast(n,xf)})}();var _xdropRepeatsWith=function(){function XDropRepeatsWith(pred,xf){this.xf=xf;this.pred=pred;this.lastValue=undefined;this.seenFirstValue=false}XDropRepeatsWith.prototype["@@transducer/init"]=function(){return this.xf["@@transducer/init"]()};XDropRepeatsWith.prototype["@@transducer/result"]=function(result){return this.xf["@@transducer/result"](result)};XDropRepeatsWith.prototype["@@transducer/step"]=function(result,input){var sameAsLast=false;if(!this.seenFirstValue){this.seenFirstValue=true}else if(this.pred(this.lastValue,input)){sameAsLast=true}this.lastValue=input;return sameAsLast?result:this.xf["@@transducer/step"](result,input)};return _curry2(function _xdropRepeatsWith(pred,xf){return new XDropRepeatsWith(pred,xf)})}();var _xdropWhile=function(){function XDropWhile(f,xf){this.xf=xf;this.f=f}XDropWhile.prototype["@@transducer/init"]=_xfBase.init;XDropWhile.prototype["@@transducer/result"]=_xfBase.result;XDropWhile.prototype["@@transducer/step"]=function(result,input){if(this.f){if(this.f(input)){return result}this.f=null}return this.xf["@@transducer/step"](result,input)};return _curry2(function _xdropWhile(f,xf){return new XDropWhile(f,xf)})}();var _xfilter=function(){function XFilter(f,xf){this.xf=xf;this.f=f}XFilter.prototype["@@transducer/init"]=_xfBase.init;XFilter.prototype["@@transducer/result"]=_xfBase.result;XFilter.prototype["@@transducer/step"]=function(result,input){return this.f(input)?this.xf["@@transducer/step"](result,input):result};return _curry2(function _xfilter(f,xf){return new XFilter(f,xf)})}();var _xfind=function(){function XFind(f,xf){this.xf=xf;
this.f=f;this.found=false}XFind.prototype["@@transducer/init"]=_xfBase.init;XFind.prototype["@@transducer/result"]=function(result){if(!this.found){result=this.xf["@@transducer/step"](result,void 0)}return this.xf["@@transducer/result"](result)};XFind.prototype["@@transducer/step"]=function(result,input){if(this.f(input)){this.found=true;result=_reduced(this.xf["@@transducer/step"](result,input))}return result};return _curry2(function _xfind(f,xf){return new XFind(f,xf)})}();var _xfindIndex=function(){function XFindIndex(f,xf){this.xf=xf;this.f=f;this.idx=-1;this.found=false}XFindIndex.prototype["@@transducer/init"]=_xfBase.init;XFindIndex.prototype["@@transducer/result"]=function(result){if(!this.found){result=this.xf["@@transducer/step"](result,-1)}return this.xf["@@transducer/result"](result)};XFindIndex.prototype["@@transducer/step"]=function(result,input){this.idx+=1;if(this.f(input)){this.found=true;result=_reduced(this.xf["@@transducer/step"](result,this.idx))}return result};return _curry2(function _xfindIndex(f,xf){return new XFindIndex(f,xf)})}();var _xfindLast=function(){function XFindLast(f,xf){this.xf=xf;this.f=f}XFindLast.prototype["@@transducer/init"]=_xfBase.init;XFindLast.prototype["@@transducer/result"]=function(result){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](result,this.last))};XFindLast.prototype["@@transducer/step"]=function(result,input){if(this.f(input)){this.last=input}return result};return _curry2(function _xfindLast(f,xf){return new XFindLast(f,xf)})}();var _xfindLastIndex=function(){function XFindLastIndex(f,xf){this.xf=xf;this.f=f;this.idx=-1;this.lastIdx=-1}XFindLastIndex.prototype["@@transducer/init"]=_xfBase.init;XFindLastIndex.prototype["@@transducer/result"]=function(result){return this.xf["@@transducer/result"](this.xf["@@transducer/step"](result,this.lastIdx))};XFindLastIndex.prototype["@@transducer/step"]=function(result,input){this.idx+=1;if(this.f(input)){this.lastIdx=this.idx}return result};return _curry2(function _xfindLastIndex(f,xf){return new XFindLastIndex(f,xf)})}();var _xmap=function(){function XMap(f,xf){this.xf=xf;this.f=f}XMap.prototype["@@transducer/init"]=_xfBase.init;XMap.prototype["@@transducer/result"]=_xfBase.result;XMap.prototype["@@transducer/step"]=function(result,input){return this.xf["@@transducer/step"](result,this.f(input))};return _curry2(function _xmap(f,xf){return new XMap(f,xf)})}();var _xreduceBy=function(){function XReduceBy(valueFn,valueAcc,keyFn,xf){this.valueFn=valueFn;this.valueAcc=valueAcc;this.keyFn=keyFn;this.xf=xf;this.inputs={}}XReduceBy.prototype["@@transducer/init"]=_xfBase.init;XReduceBy.prototype["@@transducer/result"]=function(result){var key;for(key in this.inputs){if(_has(key,this.inputs)){result=this.xf["@@transducer/step"](result,this.inputs[key]);if(result["@@transducer/reduced"]){result=result["@@transducer/value"];break}}}this.inputs=null;return this.xf["@@transducer/result"](result)};XReduceBy.prototype["@@transducer/step"]=function(result,input){var key=this.keyFn(input);this.inputs[key]=this.inputs[key]||[key,this.valueAcc];this.inputs[key][1]=this.valueFn(this.inputs[key][1],input);return result};return _curryN(4,[],function _xreduceBy(valueFn,valueAcc,keyFn,xf){return new XReduceBy(valueFn,valueAcc,keyFn,xf)})}();var _xtake=function(){function XTake(n,xf){this.xf=xf;this.n=n;this.i=0}XTake.prototype["@@transducer/init"]=_xfBase.init;XTake.prototype["@@transducer/result"]=_xfBase.result;XTake.prototype["@@transducer/step"]=function(result,input){this.i+=1;var ret=this.n===0?result:this.xf["@@transducer/step"](result,input);return this.i>=this.n?_reduced(ret):ret};return _curry2(function _xtake(n,xf){return new XTake(n,xf)})}();var _xtakeWhile=function(){function XTakeWhile(f,xf){this.xf=xf;this.f=f}XTakeWhile.prototype["@@transducer/init"]=_xfBase.init;XTakeWhile.prototype["@@transducer/result"]=_xfBase.result;XTakeWhile.prototype["@@transducer/step"]=function(result,input){return this.f(input)?this.xf["@@transducer/step"](result,input):_reduced(result)};return _curry2(function _xtakeWhile(f,xf){return new XTakeWhile(f,xf)})}();var add=_curry2(function add(a,b){return Number(a)+Number(b)});var adjust=_curry3(function adjust(fn,idx,list){if(idx>=list.length||idx<-list.length){return list}var start=idx<0?list.length:0;var _idx=start+idx;var _list=_concat(list);_list[_idx]=fn(list[_idx]);return _list});var all=_curry2(_dispatchable("all",_xall,function all(fn,list){var idx=0;while(idx<list.length){if(!fn(list[idx])){return false}idx+=1}return true}));var always=_curry1(function always(val){return function(){return val}});var and=_curry2(function and(a,b){return a&&b});var any=_curry2(_dispatchable("any",_xany,function any(fn,list){var idx=0;while(idx<list.length){if(fn(list[idx])){return true}idx+=1}return false}));var aperture=_curry2(_dispatchable("aperture",_xaperture,_aperture));var append=_curry2(function append(el,list){return _concat(list,[el])});var apply=_curry2(function apply(fn,args){return fn.apply(this,args)});var assoc=_curry3(function assoc(prop,val,obj){var result={};for(var p in obj){result[p]=obj[p]}result[prop]=val;return result});var assocPath=_curry3(function assocPath(path,val,obj){switch(path.length){case 0:return val;case 1:return assoc(path[0],val,obj);default:return assoc(path[0],assocPath(_slice(path,1),val,Object(obj[path[0]])),obj)}});var bind=_curry2(function bind(fn,thisObj){return _arity(fn.length,function(){return fn.apply(thisObj,arguments)})});var clamp=_curry3(function clamp(min,max,value){if(min>max){throw new Error("min must not be greater than max in clamp(min, max, value)")}return value<min?min:value>max?max:value});var comparator=_curry1(function comparator(pred){return function(a,b){return pred(a,b)?-1:pred(b,a)?1:0}});var curryN=_curry2(function curryN(length,fn){if(length===1){return _curry1(fn)}return _arity(length,_curryN(length,[],fn))});var dec=add(-1);var defaultTo=_curry2(function defaultTo(d,v){return v==null||v!==v?d:v});var differenceWith=_curry3(function differenceWith(pred,first,second){var out=[];var idx=0;var firstLen=first.length;while(idx<firstLen){if(!_containsWith(pred,first[idx],second)&&!_containsWith(pred,first[idx],out)){out.push(first[idx])}idx+=1}return out});var dissoc=_curry2(function dissoc(prop,obj){var result={};for(var p in obj){if(p!==prop){result[p]=obj[p]}}return result});var dissocPath=_curry2(function dissocPath(path,obj){switch(path.length){case 0:return obj;case 1:return dissoc(path[0],obj);default:var head=path[0];var tail=_slice(path,1);return obj[head]==null?obj:assoc(head,dissocPath(tail,obj[head]),obj)}});var divide=_curry2(function divide(a,b){return a/b});var dropWhile=_curry2(_dispatchable("dropWhile",_xdropWhile,function dropWhile(pred,list){var idx=0;var len=list.length;while(idx<len&&pred(list[idx])){idx+=1}return _slice(list,idx)}));var empty=_curry1(function empty(x){return x!=null&&typeof x.empty==="function"?x.empty():x!=null&&x.constructor!=null&&typeof x.constructor.empty==="function"?x.constructor.empty():_isArray(x)?[]:_isString(x)?"":_isObject(x)?{}:_isArguments(x)?function(){return arguments}():void 0});var evolve=_curry2(function evolve(transformations,object){var result={};var transformation,key,type;for(key in object){transformation=transformations[key];type=typeof transformation;result[key]=type==="function"?transformation(object[key]):type==="object"?evolve(transformations[key],object[key]):object[key]}return result});var find=_curry2(_dispatchable("find",_xfind,function find(fn,list){var idx=0;var len=list.length;while(idx<len){if(fn(list[idx])){return list[idx]}idx+=1}}));var findIndex=_curry2(_dispatchable("findIndex",_xfindIndex,function findIndex(fn,list){var idx=0;var len=list.length;while(idx<len){if(fn(list[idx])){return idx}idx+=1}return-1}));var findLast=_curry2(_dispatchable("findLast",_xfindLast,function findLast(fn,list){var idx=list.length-1;while(idx>=0){if(fn(list[idx])){return list[idx]}idx-=1}}));var findLastIndex=_curry2(_dispatchable("findLastIndex",_xfindLastIndex,function findLastIndex(fn,list){var idx=list.length-1;while(idx>=0){if(fn(list[idx])){return idx}idx-=1}return-1}));var forEach=_curry2(_checkForMethod("forEach",function forEach(fn,list){var len=list.length;var idx=0;while(idx<len){fn(list[idx]);idx+=1}return list}));var fromPairs=_curry1(function fromPairs(pairs){var result={};var idx=0;while(idx<pairs.length){result[pairs[idx][0]]=pairs[idx][1];idx+=1}return result});var groupWith=_curry2(function(fn,list){var res=[];var idx=0;var len=list.length;while(idx<len){var nextidx=idx+1;while(nextidx<len&&fn(list[idx],list[nextidx])){nextidx+=1}res.push(list.slice(idx,nextidx));idx=nextidx}return res});var gt=_curry2(function gt(a,b){return a>b});var gte=_curry2(function gte(a,b){return a>=b});var has=_curry2(_has);var hasIn=_curry2(function hasIn(prop,obj){return prop in obj});var identical=_curry2(function identical(a,b){if(a===b){return a!==0||1/a===1/b}else{return a!==a&&b!==b}});var identity=_curry1(_identity);var ifElse=_curry3(function ifElse(condition,onTrue,onFalse){return curryN(Math.max(condition.length,onTrue.length,onFalse.length),function _ifElse(){return condition.apply(this,arguments)?onTrue.apply(this,arguments):onFalse.apply(this,arguments)})});var inc=add(1);var insert=_curry3(function insert(idx,elt,list){idx=idx<list.length&&idx>=0?idx:list.length;var result=_slice(list);result.splice(idx,0,elt);return result});var insertAll=_curry3(function insertAll(idx,elts,list){idx=idx<list.length&&idx>=0?idx:list.length;return _concat(_concat(_slice(list,0,idx),elts),_slice(list,idx))});var intersperse=_curry2(_checkForMethod("intersperse",function intersperse(separator,list){var out=[];var idx=0;var length=list.length;while(idx<length){if(idx===length-1){out.push(list[idx])}else{out.push(list[idx],separator)}idx+=1}return out}));var is=_curry2(function is(Ctor,val){return val!=null&&val.constructor===Ctor||val instanceof Ctor});var isArrayLike=_curry1(function isArrayLike(x){if(_isArray(x)){return true}if(!x){return false}if(typeof x!=="object"){return false}if(_isString(x)){return false}if(x.nodeType===1){return!!x.length}if(x.length===0){return true}if(x.length>0){return x.hasOwnProperty(0)&&x.hasOwnProperty(x.length-1)}return false});var isNil=_curry1(function isNil(x){return x==null});var keys=function(){var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["constructor","valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];var hasArgsEnumBug=function(){"use strict";return arguments.propertyIsEnumerable("length")}();var contains=function contains(list,item){var idx=0;while(idx<list.length){if(list[idx]===item){return true}idx+=1}return false};return typeof Object.keys==="function"&&!hasArgsEnumBug?_curry1(function keys(obj){return Object(obj)!==obj?[]:Object.keys(obj)}):_curry1(function keys(obj){if(Object(obj)!==obj){return[]}var prop,nIdx;var ks=[];var checkArgsLength=hasArgsEnumBug&&_isArguments(obj);for(prop in obj){if(_has(prop,obj)&&(!checkArgsLength||prop!=="length")){ks[ks.length]=prop}}if(hasEnumBug){nIdx=nonEnumerableProps.length-1;while(nIdx>=0){prop=nonEnumerableProps[nIdx];if(_has(prop,obj)&&!contains(ks,prop)){ks[ks.length]=prop}nIdx-=1}}return ks})}();var keysIn=_curry1(function keysIn(obj){var prop;var ks=[];for(prop in obj){ks[ks.length]=prop}return ks});var length=_curry1(function length(list){return list!=null&&_isNumber(list.length)?list.length:NaN});var lt=_curry2(function lt(a,b){return a<b});var lte=_curry2(function lte(a,b){return a<=b});var mapAccum=_curry3(function mapAccum(fn,acc,list){var idx=0;var len=list.length;var result=[];var tuple=[acc];while(idx<len){tuple=fn(tuple[0],list[idx]);result[idx]=tuple[1];idx+=1}return[tuple[0],result]});var mapAccumRight=_curry3(function mapAccumRight(fn,acc,list){var idx=list.length-1;var result=[];var tuple=[acc];while(idx>=0){tuple=fn(tuple[0],list[idx]);result[idx]=tuple[1];idx-=1}return[tuple[0],result]});var match=_curry2(function match(rx,str){return str.match(rx)||[]});var mathMod=_curry2(function mathMod(m,p){if(!_isInteger(m)){return NaN}if(!_isInteger(p)||p<1){return NaN}return(m%p+p)%p});var max=_curry2(function max(a,b){return b>a?b:a});var maxBy=_curry3(function maxBy(f,a,b){return f(b)>f(a)?b:a});var merge=_curry2(function merge(l,r){return _assign({},l,r)});var mergeAll=_curry1(function mergeAll(list){return _assign.apply(null,[{}].concat(list))});var mergeWithKey=_curry3(function mergeWithKey(fn,l,r){var result={};var k;for(k in l){if(_has(k,l)){result[k]=_has(k,r)?fn(k,l[k],r[k]):l[k]}}for(k in r){if(_has(k,r)&&!_has(k,result)){result[k]=r[k]}}return result});var min=_curry2(function min(a,b){return b<a?b:a});var minBy=_curry3(function minBy(f,a,b){return f(b)<f(a)?b:a});var modulo=_curry2(function modulo(a,b){return a%b});var multiply=_curry2(function multiply(a,b){return a*b});var nAry=_curry2(function nAry(n,fn){switch(n){case 0:return function(){return fn.call(this)};case 1:return function(a0){return fn.call(this,a0)};case 2:return function(a0,a1){return fn.call(this,a0,a1)};case 3:return function(a0,a1,a2){return fn.call(this,a0,a1,a2)};case 4:return function(a0,a1,a2,a3){return fn.call(this,a0,a1,a2,a3)};case 5:return function(a0,a1,a2,a3,a4){return fn.call(this,a0,a1,a2,a3,a4)};case 6:return function(a0,a1,a2,a3,a4,a5){return fn.call(this,a0,a1,a2,a3,a4,a5)};case 7:return function(a0,a1,a2,a3,a4,a5,a6){return fn.call(this,a0,a1,a2,a3,a4,a5,a6)};case 8:return function(a0,a1,a2,a3,a4,a5,a6,a7){return fn.call(this,a0,a1,a2,a3,a4,a5,a6,a7)};case 9:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8){return fn.call(this,a0,a1,a2,a3,a4,a5,a6,a7,a8)};case 10:return function(a0,a1,a2,a3,a4,a5,a6,a7,a8,a9){return fn.call(this,a0,a1,a2,a3,a4,a5,a6,a7,a8,a9)};default:throw new Error("First argument to nAry must be a non-negative integer no greater than ten")}});var negate=_curry1(function negate(n){return-n});var none=_curry2(_complement(_dispatchable("any",_xany,any)));var not=_curry1(function not(a){return!a});var nth=_curry2(function nth(offset,list){var idx=offset<0?list.length+offset:offset;return _isString(list)?list.charAt(idx):list[idx]});var nthArg=_curry1(function nthArg(n){var arity=n<0?1:n+1;return curryN(arity,function(){return nth(n,arguments)})});var objOf=_curry2(function objOf(key,val){var obj={};obj[key]=val;return obj});var of=_curry1(_of);var once=_curry1(function once(fn){var called=false;var result;return _arity(fn.length,function(){if(called){return result}called=true;result=fn.apply(this,arguments);return result})});var or=_curry2(function or(a,b){return a||b});var over=function(){var Identity=function(x){return{value:x,map:function(f){return Identity(f(x))}}};return _curry3(function over(lens,f,x){return lens(function(y){return Identity(f(y))})(x).value})}();var pair=_curry2(function pair(fst,snd){return[fst,snd]});var path=_curry2(function path(paths,obj){var val=obj;var idx=0;while(idx<paths.length){if(val==null){return}val=val[paths[idx]];idx+=1}return val});var pathOr=_curry3(function pathOr(d,p,obj){return defaultTo(d,path(p,obj))});var pathSatisfies=_curry3(function pathSatisfies(pred,propPath,obj){return propPath.length>0&&pred(path(propPath,obj))});var pick=_curry2(function pick(names,obj){var result={};var idx=0;while(idx<names.length){if(names[idx]in obj){result[names[idx]]=obj[names[idx]]}idx+=1}return result});var pickAll=_curry2(function pickAll(names,obj){var result={};var idx=0;var len=names.length;while(idx<len){var name=names[idx];result[name]=obj[name];idx+=1}return result});var pickBy=_curry2(function pickBy(test,obj){var result={};for(var prop in obj){if(test(obj[prop],prop,obj)){result[prop]=obj[prop]}}return result});var prepend=_curry2(function prepend(el,list){return _concat([el],list)});var prop=_curry2(function prop(p,obj){return obj[p]});var propIs=_curry3(function propIs(type,name,obj){return is(type,obj[name])});var propOr=_curry3(function propOr(val,p,obj){return obj!=null&&_has(p,obj)?obj[p]:val});var propSatisfies=_curry3(function propSatisfies(pred,name,obj){return pred(obj[name])});var props=_curry2(function props(ps,obj){var len=ps.length;var out=[];var idx=0;while(idx<len){out[idx]=obj[ps[idx]];idx+=1}return out});var range=_curry2(function range(from,to){if(!(_isNumber(from)&&_isNumber(to))){throw new TypeError("Both arguments to range must be numbers")}var result=[];var n=from;while(n<to){result.push(n);n+=1}return result});var reduceRight=_curry3(function reduceRight(fn,acc,list){var idx=list.length-1;while(idx>=0){acc=fn(acc,list[idx]);idx-=1}return acc});var reduced=_curry1(_reduced);var remove=_curry3(function remove(start,count,list){return _concat(_slice(list,0,Math.min(start,list.length)),_slice(list,Math.min(list.length,start+count)))});var replace=_curry3(function replace(regex,replacement,str){return str.replace(regex,replacement)});var reverse=_curry1(function reverse(list){return _isString(list)?list.split("").reverse().join(""):_slice(list).reverse()});var scan=_curry3(function scan(fn,acc,list){var idx=0;var len=list.length;var result=[acc];while(idx<len){acc=fn(acc,list[idx]);result[idx+1]=acc;idx+=1}return result});var set=_curry3(function set(lens,v,x){return over(lens,always(v),x)});var slice=_curry3(_checkForMethod("slice",function slice(fromIndex,toIndex,list){return Array.prototype.slice.call(list,fromIndex,toIndex)}));var sort=_curry2(function sort(comparator,list){return _slice(list).sort(comparator)});var sortBy=_curry2(function sortBy(fn,list){return _slice(list).sort(function(a,b){var aa=fn(a);var bb=fn(b);return aa<bb?-1:aa>bb?1:0})});var splitAt=_curry2(function splitAt(index,array){return[slice(0,index,array),slice(index,length(array),array)]});var splitEvery=_curry2(function splitEvery(n,list){if(n<=0){throw new Error("First argument to splitEvery must be a positive integer")}var result=[];var idx=0;while(idx<list.length){result.push(slice(idx,idx+=n,list))}return result});var splitWhen=_curry2(function splitWhen(pred,list){var idx=0;var len=list.length;var prefix=[];while(idx<len&&!pred(list[idx])){prefix.push(list[idx]);idx+=1}return[prefix,_slice(list,idx)]});var subtract=_curry2(function subtract(a,b){return Number(a)-Number(b)});var tail=_checkForMethod("tail",slice(1,Infinity));var take=_curry2(_dispatchable("take",_xtake,function take(n,xs){return slice(0,n<0?Infinity:n,xs)}));var takeLastWhile=_curry2(function takeLastWhile(fn,list){var idx=list.length-1;while(idx>=0&&fn(list[idx])){idx-=1}return _slice(list,idx+1,Infinity)});var takeWhile=_curry2(_dispatchable("takeWhile",_xtakeWhile,function takeWhile(fn,list){var idx=0;var len=list.length;while(idx<len&&fn(list[idx])){idx+=1}return _slice(list,0,idx)}));var tap=_curry2(function tap(fn,x){fn(x);return x});var times=_curry2(function times(fn,n){var len=Number(n);var idx=0;var list;if(len<0||isNaN(len)){throw new RangeError("n must be a non-negative number")}list=new Array(len);while(idx<len){list[idx]=fn(idx);idx+=1}return list});var toPairs=_curry1(function toPairs(obj){var pairs=[];for(var prop in obj){if(_has(prop,obj)){pairs[pairs.length]=[prop,obj[prop]]}}return pairs});var toPairsIn=_curry1(function toPairsIn(obj){var pairs=[];for(var prop in obj){pairs[pairs.length]=[prop,obj[prop]]}return pairs});var transpose=_curry1(function transpose(outerlist){var i=0;var result=[];while(i<outerlist.length){var innerlist=outerlist[i];var j=0;while(j<innerlist.length){if(typeof result[j]==="undefined"){result[j]=[]}result[j].push(innerlist[j]);j+=1}i+=1}return result});var trim=function(){var ws="\t\n\v\f\r   ᠎    "+"         　\u2028"+"\u2029\ufeff";var zeroWidth="​";var hasProtoTrim=typeof String.prototype.trim==="function";if(!hasProtoTrim||(ws.trim()||!zeroWidth.trim())){return _curry1(function trim(str){var beginRx=new RegExp("^["+ws+"]["+ws+"]*");var endRx=new RegExp("["+ws+"]["+ws+"]*$");return str.replace(beginRx,"").replace(endRx,"")})}else{return _curry1(function trim(str){return str.trim()})}}();var tryCatch=_curry2(function _tryCatch(tryer,catcher){return _arity(tryer.length,function(){try{return tryer.apply(this,arguments)}catch(e){return catcher.apply(this,_concat([e],arguments))}})});var type=_curry1(function type(val){return val===null?"Null":val===undefined?"Undefined":Object.prototype.toString.call(val).slice(8,-1)});var unapply=_curry1(function unapply(fn){return function(){return fn(_slice(arguments))}});var unary=_curry1(function unary(fn){return nAry(1,fn)});var uncurryN=_curry2(function uncurryN(depth,fn){return curryN(depth,function(){var currentDepth=1;var value=fn;var idx=0;var endIdx;while(currentDepth<=depth&&typeof value==="function"){endIdx=currentDepth===depth?arguments.length:idx+value.length;value=value.apply(this,_slice(arguments,idx,endIdx));currentDepth+=1;idx=endIdx}return value})});var unfold=_curry2(function unfold(fn,seed){var pair=fn(seed);var result=[];while(pair&&pair.length){result[result.length]=pair[0];pair=fn(pair[1])}return result});var uniqWith=_curry2(function uniqWith(pred,list){var idx=0;var len=list.length;var result=[];var item;while(idx<len){item=list[idx];if(!_containsWith(pred,item,result)){result[result.length]=item}idx+=1}return result});var unless=_curry3(function unless(pred,whenFalseFn,x){return pred(x)?x:whenFalseFn(x)});var until=_curry3(function until(pred,fn,init){var val=init;while(!pred(val)){val=fn(val)}return val});var update=_curry3(function update(idx,x,list){return adjust(always(x),idx,list)});var useWith=_curry2(function useWith(fn,transformers){return curryN(transformers.length,function(){var args=[];var idx=0;while(idx<transformers.length){args.push(transformers[idx].call(this,arguments[idx]));idx+=1}return fn.apply(this,args.concat(_slice(arguments,transformers.length)))})});var values=_curry1(function values(obj){var props=keys(obj);var len=props.length;var vals=[];var idx=0;while(idx<len){vals[idx]=obj[props[idx]];idx+=1}return vals});var valuesIn=_curry1(function valuesIn(obj){var prop;var vs=[];for(prop in obj){vs[vs.length]=obj[prop]}return vs});var view=function(){var Const=function(x){return{value:x,map:function(){return this}}};return _curry2(function view(lens,x){return lens(Const)(x).value})}();var when=_curry3(function when(pred,whenTrueFn,x){return pred(x)?whenTrueFn(x):x});var where=_curry2(function where(spec,testObj){for(var prop in spec){if(_has(prop,spec)&&!spec[prop](testObj[prop])){return false}}return true});var wrap=_curry2(function wrap(fn,wrapper){return curryN(fn.length,function(){return wrapper.apply(this,_concat([fn],arguments))})});var xprod=_curry2(function xprod(a,b){var idx=0;var ilen=a.length;var j;var jlen=b.length;var result=[];while(idx<ilen){j=0;while(j<jlen){result[result.length]=[a[idx],b[j]];j+=1}idx+=1}return result});var zip=_curry2(function zip(a,b){var rv=[];var idx=0;var len=Math.min(a.length,b.length);while(idx<len){rv[idx]=[a[idx],b[idx]];idx+=1}return rv});var zipObj=_curry2(function zipObj(keys,values){var idx=0;var len=Math.min(keys.length,values.length);var out={};while(idx<len){out[keys[idx]]=values[idx];idx+=1}return out});var zipWith=_curry3(function zipWith(fn,a,b){var rv=[];var idx=0;var len=Math.min(a.length,b.length);while(idx<len){rv[idx]=fn(a[idx],b[idx]);idx+=1}return rv});var F=always(false);var T=always(true);var _clone=function _clone(value,refFrom,refTo,deep){var copy=function copy(copiedValue){var len=refFrom.length;var idx=0;while(idx<len){if(value===refFrom[idx]){return refTo[idx]}idx+=1}refFrom[idx+1]=value;refTo[idx+1]=copiedValue;for(var key in value){copiedValue[key]=deep?_clone(value[key],refFrom,refTo,true):value[key]}return copiedValue};switch(type(value)){case"Object":return copy({});case"Array":return copy([]);case"Date":return new Date(value.valueOf());case"RegExp":return _cloneRegExp(value);default:return value}};var _createPartialApplicator=function _createPartialApplicator(concat){return _curry2(function(fn,args){return _arity(Math.max(0,fn.length-args.length),function(){return fn.apply(this,concat(args,arguments))})})};var _dropLast=function dropLast(n,xs){return take(n<xs.length?xs.length-n:0,xs)};var _equals=function _equals(a,b,stackA,stackB){if(identical(a,b)){return true}if(type(a)!==type(b)){return false}if(a==null||b==null){return false}if(typeof a.equals==="function"||typeof b.equals==="function"){return typeof a.equals==="function"&&a.equals(b)&&typeof b.equals==="function"&&b.equals(a)}switch(type(a)){case"Arguments":case"Array":case"Object":if(typeof a.constructor==="function"&&_functionName(a.constructor)==="Promise"){return a===b}break;case"Boolean":case"Number":case"String":if(!(typeof a===typeof b&&identical(a.valueOf(),b.valueOf()))){return false}break;case"Date":if(!identical(a.valueOf(),b.valueOf())){return false}break;case"Error":return a.name===b.name&&a.message===b.message;case"RegExp":if(!(a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline&&a.sticky===b.sticky&&a.unicode===b.unicode)){return false}break;case"Map":case"Set":if(!_equals(_arrayFromIterator(a.entries()),_arrayFromIterator(b.entries()),stackA,stackB)){return false}break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":break;case"ArrayBuffer":break;default:return false}var keysA=keys(a);if(keysA.length!==keys(b).length){return false}var idx=stackA.length-1;while(idx>=0){if(stackA[idx]===a){return stackB[idx]===b}idx-=1}stackA.push(a);stackB.push(b);idx=keysA.length-1;while(idx>=0){var key=keysA[idx];if(!(_has(key,b)&&_equals(b[key],a[key],stackA,stackB))){return false}idx-=1}stackA.pop();stackB.pop();return true};var _makeFlat=function _makeFlat(recursive){return function flatt(list){var value,jlen,j;var result=[];var idx=0;var ilen=list.length;while(idx<ilen){if(isArrayLike(list[idx])){value=recursive?flatt(list[idx]):list[idx];j=0;jlen=value.length;while(j<jlen){result[result.length]=value[j];j+=1}}else{result[result.length]=list[idx]}idx+=1}return result}};var _reduce=function(){function _arrayReduce(xf,acc,list){var idx=0;var len=list.length;while(idx<len){acc=xf["@@transducer/step"](acc,list[idx]);if(acc&&acc["@@transducer/reduced"]){acc=acc["@@transducer/value"];break}idx+=1}return xf["@@transducer/result"](acc)}function _iterableReduce(xf,acc,iter){var step=iter.next();while(!step.done){acc=xf["@@transducer/step"](acc,step.value);if(acc&&acc["@@transducer/reduced"]){acc=acc["@@transducer/value"];break}step=iter.next()}return xf["@@transducer/result"](acc)}function _methodReduce(xf,acc,obj){return xf["@@transducer/result"](obj.reduce(bind(xf["@@transducer/step"],xf),acc))}var symIterator=typeof Symbol!=="undefined"?Symbol.iterator:"@@iterator";return function _reduce(fn,acc,list){if(typeof fn==="function"){fn=_xwrap(fn)}if(isArrayLike(list)){return _arrayReduce(fn,acc,list)}if(typeof list.reduce==="function"){return _methodReduce(fn,acc,list)}if(list[symIterator]!=null){return _iterableReduce(fn,acc,list[symIterator]())}if(typeof list.next==="function"){return _iterableReduce(fn,acc,list)}throw new TypeError("reduce: list must be array or iterable")}}();var _stepCat=function(){var _stepCatArray={"@@transducer/init":Array,"@@transducer/step":function(xs,x){xs.push(x);return xs},"@@transducer/result":_identity};var _stepCatString={"@@transducer/init":String,"@@transducer/step":function(a,b){return a+b},"@@transducer/result":_identity};var _stepCatObject={"@@transducer/init":Object,"@@transducer/step":function(result,input){return _assign(result,isArrayLike(input)?objOf(input[0],input[1]):input)},"@@transducer/result":_identity};return function _stepCat(obj){if(_isTransformer(obj)){return obj}if(isArrayLike(obj)){return _stepCatArray}if(typeof obj==="string"){return _stepCatString}if(typeof obj==="object"){return _stepCatObject}throw new Error("Cannot create transformer for "+obj)}}();var _xdropLastWhile=function(){function XDropLastWhile(fn,xf){this.f=fn;this.retained=[];this.xf=xf}XDropLastWhile.prototype["@@transducer/init"]=_xfBase.init;XDropLastWhile.prototype["@@transducer/result"]=function(result){this.retained=null;return this.xf["@@transducer/result"](result)};XDropLastWhile.prototype["@@transducer/step"]=function(result,input){return this.f(input)?this.retain(result,input):this.flush(result,input)};XDropLastWhile.prototype.flush=function(result,input){result=_reduce(this.xf["@@transducer/step"],result,this.retained);this.retained=[];return this.xf["@@transducer/step"](result,input)};XDropLastWhile.prototype.retain=function(result,input){this.retained.push(input);return result};return _curry2(function _xdropLastWhile(fn,xf){return new XDropLastWhile(fn,xf)})}();var addIndex=_curry1(function addIndex(fn){return curryN(fn.length,function(){var idx=0;var origFn=arguments[0];var list=arguments[arguments.length-1];var args=_slice(arguments);args[0]=function(){var result=origFn.apply(this,_concat(arguments,[idx,list]));idx+=1;return result};return fn.apply(this,args)})});var binary=_curry1(function binary(fn){return nAry(2,fn)});var clone=_curry1(function clone(value){return value!=null&&typeof value.clone==="function"?value.clone():_clone(value,[],[],true)});var curry=_curry1(function curry(fn){return curryN(fn.length,fn)});var drop=_curry2(_dispatchable("drop",_xdrop,function drop(n,xs){return slice(Math.max(0,n),Infinity,xs)}));var dropLast=_curry2(_dispatchable("dropLast",_xdropLast,_dropLast));var dropLastWhile=_curry2(_dispatchable("dropLastWhile",_xdropLastWhile,_dropLastWhile));var equals=_curry2(function equals(a,b){return _equals(a,b,[],[])});var filter=_curry2(_dispatchable("filter",_xfilter,function(pred,filterable){return _isObject(filterable)?_reduce(function(acc,key){if(pred(filterable[key])){acc[key]=filterable[key]}return acc},{},keys(filterable)):_filter(pred,filterable)}));var flatten=_curry1(_makeFlat(true));var flip=_curry1(function flip(fn){return curry(function(a,b){var args=_slice(arguments);args[0]=b;args[1]=a;return fn.apply(this,args)})});var head=nth(0);var init=slice(0,-1);var intersectionWith=_curry3(function intersectionWith(pred,list1,list2){var lookupList,filteredList;if(list1.length>list2.length){lookupList=list1;filteredList=list2}else{lookupList=list2;filteredList=list1}var results=[];var idx=0;while(idx<filteredList.length){if(_containsWith(pred,filteredList[idx],lookupList)){results[results.length]=filteredList[idx]}idx+=1}return uniqWith(pred,results)});var into=_curry3(function into(acc,xf,list){return _isTransformer(acc)?_reduce(xf(acc),acc["@@transducer/init"](),list):_reduce(xf(_stepCat(acc)),_clone(acc,[],[],false),list)});var invert=_curry1(function invert(obj){var props=keys(obj);var len=props.length;var idx=0;var out={};while(idx<len){var key=props[idx];var val=obj[key];var list=_has(val,out)?out[val]:out[val]=[];list[list.length]=key;idx+=1}return out});var invertObj=_curry1(function invertObj(obj){var props=keys(obj);var len=props.length;var idx=0;var out={};while(idx<len){var key=props[idx];out[obj[key]]=key;idx+=1}return out});var isEmpty=_curry1(function isEmpty(x){return x!=null&&equals(x,empty(x))});var last=nth(-1);var lastIndexOf=_curry2(function lastIndexOf(target,xs){if(typeof xs.lastIndexOf==="function"&&!_isArray(xs)){return xs.lastIndexOf(target)}else{var idx=xs.length-1;while(idx>=0){if(equals(xs[idx],target)){return idx}idx-=1}return-1}});var map=_curry2(_dispatchable("map",_xmap,function map(fn,functor){switch(Object.prototype.toString.call(functor)){case"[object Function]":return curryN(functor.length,function(){return fn.call(this,functor.apply(this,arguments))});case"[object Object]":return _reduce(function(acc,key){acc[key]=fn(functor[key]);return acc},{},keys(functor));default:return _map(fn,functor)}}));var mapObjIndexed=_curry2(function mapObjIndexed(fn,obj){return _reduce(function(acc,key){acc[key]=fn(obj[key],key,obj);return acc},{},keys(obj))});var mergeWith=_curry3(function mergeWith(fn,l,r){
return mergeWithKey(function(_,_l,_r){return fn(_l,_r)},l,r)});var partial=_createPartialApplicator(_concat);var partialRight=_createPartialApplicator(flip(_concat));var pathEq=_curry3(function pathEq(_path,val,obj){return equals(path(_path,obj),val)});var pluck=_curry2(function pluck(p,list){return map(prop(p),list)});var project=useWith(_map,[pickAll,identity]);var propEq=_curry3(function propEq(name,val,obj){return equals(val,obj[name])});var reduce=_curry3(_reduce);var reduceBy=_curryN(4,[],_dispatchable("reduceBy",_xreduceBy,function reduceBy(valueFn,valueAcc,keyFn,list){return _reduce(function(acc,elt){var key=keyFn(elt);acc[key]=valueFn(_has(key,acc)?acc[key]:valueAcc,elt);return acc},{},list)}));var reduceWhile=_curryN(4,[],function _reduceWhile(pred,fn,a,list){return _reduce(function(acc,x){return pred(acc,x)?fn(acc,x):_reduced(acc)},a,list)});var reject=_curry2(function reject(pred,filterable){return filter(_complement(pred),filterable)});var repeat=_curry2(function repeat(value,n){return times(always(value),n)});var sum=reduce(add,0);var takeLast=_curry2(function takeLast(n,xs){return drop(n>=0?xs.length-n:0,xs)});var transduce=curryN(4,function transduce(xf,fn,acc,list){return _reduce(xf(typeof fn==="function"?_xwrap(fn):fn),acc,list)});var unionWith=_curry3(function unionWith(pred,list1,list2){return uniqWith(pred,_concat(list1,list2))});var whereEq=_curry2(function whereEq(spec,testObj){return where(map(equals,spec),testObj)});var _flatCat=function(){var preservingReduced=function(xf){return{"@@transducer/init":_xfBase.init,"@@transducer/result":function(result){return xf["@@transducer/result"](result)},"@@transducer/step":function(result,input){var ret=xf["@@transducer/step"](result,input);return ret["@@transducer/reduced"]?_forceReduced(ret):ret}}};return function _xcat(xf){var rxf=preservingReduced(xf);return{"@@transducer/init":_xfBase.init,"@@transducer/result":function(result){return rxf["@@transducer/result"](result)},"@@transducer/step":function(result,input){return!isArrayLike(input)?_reduce(rxf,result,[input]):_reduce(rxf,result,input)}}}}();var _indexOf=function _indexOf(list,a,idx){var inf,item;if(typeof list.indexOf==="function"){switch(typeof a){case"number":if(a===0){inf=1/a;while(idx<list.length){item=list[idx];if(item===0&&1/item===inf){return idx}idx+=1}return-1}else if(a!==a){while(idx<list.length){item=list[idx];if(typeof item==="number"&&item!==item){return idx}idx+=1}return-1}return list.indexOf(a,idx);case"string":case"boolean":case"function":case"undefined":return list.indexOf(a,idx);case"object":if(a===null){return list.indexOf(a,idx)}}}while(idx<list.length){if(equals(list[idx],a)){return idx}idx+=1}return-1};var _xchain=_curry2(function _xchain(f,xf){return map(f,_flatCat(xf))});var allPass=_curry1(function allPass(preds){return curryN(reduce(max,0,pluck("length",preds)),function(){var idx=0;var len=preds.length;while(idx<len){if(!preds[idx].apply(this,arguments)){return false}idx+=1}return true})});var anyPass=_curry1(function anyPass(preds){return curryN(reduce(max,0,pluck("length",preds)),function(){var idx=0;var len=preds.length;while(idx<len){if(preds[idx].apply(this,arguments)){return true}idx+=1}return false})});var ap=_curry2(function ap(applicative,fn){return typeof applicative.ap==="function"?applicative.ap(fn):typeof applicative==="function"?function(x){return applicative(x)(fn(x))}:_reduce(function(acc,f){return _concat(acc,map(f,fn))},[],applicative)});var applySpec=_curry1(function applySpec(spec){spec=map(function(v){return typeof v=="function"?v:applySpec(v)},spec);return curryN(reduce(max,0,pluck("length",values(spec))),function(){var args=arguments;return map(function(f){return apply(f,args)},spec)})});var call=curry(function call(fn){return fn.apply(this,_slice(arguments,1))});var chain=_curry2(_dispatchable("chain",_xchain,function chain(fn,monad){if(typeof monad==="function"){return function(){return monad.call(this,fn.apply(this,arguments)).apply(this,arguments)}}return _makeFlat(false)(map(fn,monad))}));var cond=_curry1(function cond(pairs){var arity=reduce(max,0,map(function(pair){return pair[0].length},pairs));return _arity(arity,function(){var idx=0;while(idx<pairs.length){if(pairs[idx][0].apply(this,arguments)){return pairs[idx][1].apply(this,arguments)}idx+=1}})});var constructN=_curry2(function constructN(n,Fn){if(n>10){throw new Error("Constructor with greater than ten arguments")}if(n===0){return function(){return new Fn}}return curry(nAry(n,function($0,$1,$2,$3,$4,$5,$6,$7,$8,$9){switch(arguments.length){case 1:return new Fn($0);case 2:return new Fn($0,$1);case 3:return new Fn($0,$1,$2);case 4:return new Fn($0,$1,$2,$3);case 5:return new Fn($0,$1,$2,$3,$4);case 6:return new Fn($0,$1,$2,$3,$4,$5);case 7:return new Fn($0,$1,$2,$3,$4,$5,$6);case 8:return new Fn($0,$1,$2,$3,$4,$5,$6,$7);case 9:return new Fn($0,$1,$2,$3,$4,$5,$6,$7,$8);case 10:return new Fn($0,$1,$2,$3,$4,$5,$6,$7,$8,$9)}}))});var converge=_curry2(function converge(after,fns){return curryN(reduce(max,0,pluck("length",fns)),function(){var args=arguments;var context=this;return after.apply(context,_map(function(fn){return fn.apply(context,args)},fns))})});var countBy=reduceBy(function(acc,elem){return acc+1},0);var dropRepeatsWith=_curry2(_dispatchable("dropRepeatsWith",_xdropRepeatsWith,function dropRepeatsWith(pred,list){var result=[];var idx=1;var len=list.length;if(len!==0){result[0]=list[0];while(idx<len){if(!pred(last(result),list[idx])){result[result.length]=list[idx]}idx+=1}}return result}));var eqBy=_curry3(function eqBy(f,x,y){return equals(f(x),f(y))});var eqProps=_curry3(function eqProps(prop,obj1,obj2){return equals(obj1[prop],obj2[prop])});var groupBy=_curry2(_checkForMethod("groupBy",reduceBy(function(acc,item){if(acc==null){acc=[]}acc.push(item);return acc},null)));var indexBy=reduceBy(function(acc,elem){return elem},null);var indexOf=_curry2(function indexOf(target,xs){return typeof xs.indexOf==="function"&&!_isArray(xs)?xs.indexOf(target):_indexOf(xs,target,0)});var juxt=_curry1(function juxt(fns){return converge(_arrayOf,fns)});var lens=_curry2(function lens(getter,setter){return function(toFunctorFn){return function(target){return map(function(focus){return setter(focus,target)},toFunctorFn(getter(target)))}}});var lensIndex=_curry1(function lensIndex(n){return lens(nth(n),update(n))});var lensPath=_curry1(function lensPath(p){return lens(path(p),assocPath(p))});var lensProp=_curry1(function lensProp(k){return lens(prop(k),assoc(k))});var liftN=_curry2(function liftN(arity,fn){var lifted=curryN(arity,fn);return curryN(arity,function(){return _reduce(ap,map(lifted,arguments[0]),_slice(arguments,1))})});var mean=_curry1(function mean(list){return sum(list)/list.length});var median=_curry1(function median(list){var len=list.length;if(len===0){return NaN}var width=2-len%2;var idx=(len-width)/2;return mean(_slice(list).sort(function(a,b){return a<b?-1:a>b?1:0}).slice(idx,idx+width))});var partition=juxt([filter,reject]);var pipe=function pipe(){if(arguments.length===0){throw new Error("pipe requires at least one argument")}return _arity(arguments[0].length,reduce(_pipe,arguments[0],tail(arguments)))};var pipeP=function pipeP(){if(arguments.length===0){throw new Error("pipeP requires at least one argument")}return _arity(arguments[0].length,reduce(_pipeP,arguments[0],tail(arguments)))};var product=reduce(multiply,1);var sequence=_curry2(function sequence(of,traversable){return typeof traversable.sequence==="function"?traversable.sequence(of):reduceRight(function(acc,x){return ap(map(prepend,x),acc)},of([]),traversable)});var traverse=_curry3(function traverse(of,f,traversable){return sequence(of,map(f,traversable))});var unnest=chain(_identity);var _contains=function _contains(a,list){return _indexOf(list,a,0)>=0};var _toString=function _toString(x,seen){var recur=function recur(y){var xs=seen.concat([x]);return _contains(y,xs)?"<Circular>":_toString(y,xs)};var mapPairs=function(obj,keys){return _map(function(k){return _quote(k)+": "+recur(obj[k])},keys.slice().sort())};switch(Object.prototype.toString.call(x)){case"[object Arguments]":return"(function() { return arguments; }("+_map(recur,x).join(", ")+"))";case"[object Array]":return"["+_map(recur,x).concat(mapPairs(x,reject(function(k){return/^\d+$/.test(k)},keys(x)))).join(", ")+"]";case"[object Boolean]":return typeof x==="object"?"new Boolean("+recur(x.valueOf())+")":x.toString();case"[object Date]":return"new Date("+(isNaN(x.valueOf())?recur(NaN):_quote(_toISOString(x)))+")";case"[object Null]":return"null";case"[object Number]":return typeof x==="object"?"new Number("+recur(x.valueOf())+")":1/x===-Infinity?"-0":x.toString(10);case"[object String]":return typeof x==="object"?"new String("+recur(x.valueOf())+")":_quote(x);case"[object Undefined]":return"undefined";default:if(typeof x.toString==="function"){var repr=x.toString();if(repr!=="[object Object]"){return repr}}return"{"+mapPairs(x,keys(x)).join(", ")+"}"}};var compose=function compose(){if(arguments.length===0){throw new Error("compose requires at least one argument")}return pipe.apply(this,reverse(arguments))};var composeK=function composeK(){return compose.apply(this,prepend(identity,map(chain,arguments)))};var composeP=function composeP(){if(arguments.length===0){throw new Error("composeP requires at least one argument")}return pipeP.apply(this,reverse(arguments))};var construct=_curry1(function construct(Fn){return constructN(Fn.length,Fn)});var contains=_curry2(_contains);var difference=_curry2(function difference(first,second){var out=[];var idx=0;var firstLen=first.length;while(idx<firstLen){if(!_contains(first[idx],second)&&!_contains(first[idx],out)){out[out.length]=first[idx]}idx+=1}return out});var dropRepeats=_curry1(_dispatchable("dropRepeats",_xdropRepeatsWith(equals),dropRepeatsWith(equals)));var lift=_curry1(function lift(fn){return liftN(fn.length,fn)});var omit=_curry2(function omit(names,obj){var result={};for(var prop in obj){if(!_contains(prop,names)){result[prop]=obj[prop]}}return result});var pipeK=function pipeK(){return composeK.apply(this,reverse(arguments))};var toString=_curry1(function toString(val){return _toString(val,[])});var without=_curry2(function(xs,list){return reject(flip(_contains)(xs),list)});var _Set=function(){function _Set(){this._nativeSet=typeof Set==="function"?new Set:null;this._items={}}_Set.prototype.add=function(item){return!hasOrAdd(item,true,this)};_Set.prototype.has=function(item){return hasOrAdd(item,false,this)};function hasOrAdd(item,shouldAdd,set){var type=typeof item;var prevSize,newSize;switch(type){case"string":case"number":if(item===0&&1/item===-Infinity){if(set._items["-0"]){return true}else{if(shouldAdd){set._items["-0"]=true}return false}}if(set._nativeSet!==null){if(shouldAdd){prevSize=set._nativeSet.size;set._nativeSet.add(item);newSize=set._nativeSet.size;return newSize===prevSize}else{return set._nativeSet.has(item)}}else{if(!(type in set._items)){if(shouldAdd){set._items[type]={};set._items[type][item]=true}return false}else if(item in set._items[type]){return true}else{if(shouldAdd){set._items[type][item]=true}return false}}case"boolean":if(type in set._items){var bIdx=item?1:0;if(set._items[type][bIdx]){return true}else{if(shouldAdd){set._items[type][bIdx]=true}return false}}else{if(shouldAdd){set._items[type]=item?[false,true]:[true,false]}return false}case"function":if(set._nativeSet!==null){if(shouldAdd){prevSize=set._nativeSet.size;set._nativeSet.add(item);newSize=set._nativeSet.size;return newSize>prevSize}else{return set._nativeSet.has(item)}}else{if(!(type in set._items)){if(shouldAdd){set._items[type]=[item]}return false}if(!_contains(item,set._items[type])){if(shouldAdd){set._items[type].push(item)}return false}return true}case"undefined":if(set._items[type]){return true}else{if(shouldAdd){set._items[type]=true}return false}case"object":if(item===null){if(!set._items["null"]){if(shouldAdd){set._items["null"]=true}return false}return true}default:type=Object.prototype.toString.call(item);if(!(type in set._items)){if(shouldAdd){set._items[type]=[item]}return false}if(!_contains(item,set._items[type])){if(shouldAdd){set._items[type].push(item)}return false}return true}}return _Set}();var both=_curry2(function both(f,g){return _isFunction(f)?function _both(){return f.apply(this,arguments)&&g.apply(this,arguments)}:lift(and)(f,g)});var complement=lift(not);var concat=_curry2(function concat(a,b){if(a==null||!_isFunction(a.concat)){throw new TypeError(toString(a)+' does not have a method named "concat"')}if(_isArray(a)&&!_isArray(b)){throw new TypeError(toString(b)+" is not an array")}return a.concat(b)});var either=_curry2(function either(f,g){return _isFunction(f)?function _either(){return f.apply(this,arguments)||g.apply(this,arguments)}:lift(or)(f,g)});var invoker=_curry2(function invoker(arity,method){return curryN(arity+1,function(){var target=arguments[arity];if(target!=null&&_isFunction(target[method])){return target[method].apply(target,_slice(arguments,0,arity))}throw new TypeError(toString(target)+' does not have a method named "'+method+'"')})});var join=invoker(1,"join");var memoize=_curry1(function memoize(fn){var cache={};return _arity(fn.length,function(){var key=toString(arguments);if(!_has(key,cache)){cache[key]=fn.apply(this,arguments)}return cache[key]})});var split=invoker(1,"split");var symmetricDifference=_curry2(function symmetricDifference(list1,list2){return concat(difference(list1,list2),difference(list2,list1))});var symmetricDifferenceWith=_curry3(function symmetricDifferenceWith(pred,list1,list2){return concat(differenceWith(pred,list1,list2),differenceWith(pred,list2,list1))});var test=_curry2(function test(pattern,str){if(!_isRegExp(pattern)){throw new TypeError("‘test’ requires a value of type RegExp as its first argument; received "+toString(pattern))}return _cloneRegExp(pattern).test(str)});var toLower=invoker(0,"toLowerCase");var toUpper=invoker(0,"toUpperCase");var uniqBy=_curry2(function uniqBy(fn,list){var set=new _Set;var result=[];var idx=0;var appliedItem,item;while(idx<list.length){item=list[idx];appliedItem=fn(item);if(set.add(appliedItem)){result.push(item)}idx+=1}return result});var uniq=uniqBy(identity);var intersection=_curry2(function intersection(list1,list2){var lookupList,filteredList;if(list1.length>list2.length){lookupList=list1;filteredList=list2}else{lookupList=list2;filteredList=list1}return uniq(_filter(flip(_contains)(lookupList),filteredList))});var union=_curry2(compose(uniq,_concat));var R={F:F,T:T,__:__,add:add,addIndex:addIndex,adjust:adjust,all:all,allPass:allPass,always:always,and:and,any:any,anyPass:anyPass,ap:ap,aperture:aperture,append:append,apply:apply,applySpec:applySpec,assoc:assoc,assocPath:assocPath,binary:binary,bind:bind,both:both,call:call,chain:chain,clamp:clamp,clone:clone,comparator:comparator,complement:complement,compose:compose,composeK:composeK,composeP:composeP,concat:concat,cond:cond,construct:construct,constructN:constructN,contains:contains,converge:converge,countBy:countBy,curry:curry,curryN:curryN,dec:dec,defaultTo:defaultTo,difference:difference,differenceWith:differenceWith,dissoc:dissoc,dissocPath:dissocPath,divide:divide,drop:drop,dropLast:dropLast,dropLastWhile:dropLastWhile,dropRepeats:dropRepeats,dropRepeatsWith:dropRepeatsWith,dropWhile:dropWhile,either:either,empty:empty,eqBy:eqBy,eqProps:eqProps,equals:equals,evolve:evolve,filter:filter,find:find,findIndex:findIndex,findLast:findLast,findLastIndex:findLastIndex,flatten:flatten,flip:flip,forEach:forEach,fromPairs:fromPairs,groupBy:groupBy,groupWith:groupWith,gt:gt,gte:gte,has:has,hasIn:hasIn,head:head,identical:identical,identity:identity,ifElse:ifElse,inc:inc,indexBy:indexBy,indexOf:indexOf,init:init,insert:insert,insertAll:insertAll,intersection:intersection,intersectionWith:intersectionWith,intersperse:intersperse,into:into,invert:invert,invertObj:invertObj,invoker:invoker,is:is,isArrayLike:isArrayLike,isEmpty:isEmpty,isNil:isNil,join:join,juxt:juxt,keys:keys,keysIn:keysIn,last:last,lastIndexOf:lastIndexOf,length:length,lens:lens,lensIndex:lensIndex,lensPath:lensPath,lensProp:lensProp,lift:lift,liftN:liftN,lt:lt,lte:lte,map:map,mapAccum:mapAccum,mapAccumRight:mapAccumRight,mapObjIndexed:mapObjIndexed,match:match,mathMod:mathMod,max:max,maxBy:maxBy,mean:mean,median:median,memoize:memoize,merge:merge,mergeAll:mergeAll,mergeWith:mergeWith,mergeWithKey:mergeWithKey,min:min,minBy:minBy,modulo:modulo,multiply:multiply,nAry:nAry,negate:negate,none:none,not:not,nth:nth,nthArg:nthArg,objOf:objOf,of:of,omit:omit,once:once,or:or,over:over,pair:pair,partial:partial,partialRight:partialRight,partition:partition,path:path,pathEq:pathEq,pathOr:pathOr,pathSatisfies:pathSatisfies,pick:pick,pickAll:pickAll,pickBy:pickBy,pipe:pipe,pipeK:pipeK,pipeP:pipeP,pluck:pluck,prepend:prepend,product:product,project:project,prop:prop,propEq:propEq,propIs:propIs,propOr:propOr,propSatisfies:propSatisfies,props:props,range:range,reduce:reduce,reduceBy:reduceBy,reduceRight:reduceRight,reduceWhile:reduceWhile,reduced:reduced,reject:reject,remove:remove,repeat:repeat,replace:replace,reverse:reverse,scan:scan,sequence:sequence,set:set,slice:slice,sort:sort,sortBy:sortBy,split:split,splitAt:splitAt,splitEvery:splitEvery,splitWhen:splitWhen,subtract:subtract,sum:sum,symmetricDifference:symmetricDifference,symmetricDifferenceWith:symmetricDifferenceWith,tail:tail,take:take,takeLast:takeLast,takeLastWhile:takeLastWhile,takeWhile:takeWhile,tap:tap,test:test,times:times,toLower:toLower,toPairs:toPairs,toPairsIn:toPairsIn,toString:toString,toUpper:toUpper,transduce:transduce,transpose:transpose,traverse:traverse,trim:trim,tryCatch:tryCatch,type:type,unapply:unapply,unary:unary,uncurryN:uncurryN,unfold:unfold,union:union,unionWith:unionWith,uniq:uniq,uniqBy:uniqBy,uniqWith:uniqWith,unless:unless,unnest:unnest,until:until,update:update,useWith:useWith,values:values,valuesIn:valuesIn,view:view,when:when,where:where,whereEq:whereEq,without:without,wrap:wrap,xprod:xprod,zip:zip,zipObj:zipObj,zipWith:zipWith};if(typeof exports==="object"){module.exports=R}else if(typeof define==="function"&&define.amd){define(function(){return R})}else{this.R=R}}).call(this)},{}],24:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),unityGain={toAbsolute:function toAbsolute(){return 1}};function SamplePlayer(assetUrl,audioContext,onLoad){EventEmitter.call(this);var player=this,_loaded=false,_buffer=void 0,_voices=[],_playbackRate=1,_gainNode=audioContext.createGain();var stoppedAction=function stoppedAction(){_voices.shift();if(!player.isPlaying())player.emit("stopped")};this._assetUrl=assetUrl;this.connect=_gainNode.connect.bind(_gainNode);this.disconnect=_gainNode.disconnect.bind(_gainNode);this.toMaster=function(){player.disconnect();player.connect(audioContext.destination);return player};this.isPlaying=function(){return _voices.length>0};this.play=function(gain){if(!_loaded){console.log(assetUrl+" not loaded yet...");return}var now=timeNow(audioContext),startTime=now,_gain=gain&&typeof gain.toAbsolute==="function"?gain:unityGain;if(player.isPlaying()){_gainNode.gain.cancelScheduledValues(now);anchor(_gainNode.gain,now);startTime=now+.01;_gainNode.gain.linearRampToValueAtTime(0,startTime);player.emit("stopped")}else{_gainNode.gain.setValueAtTime(0,startTime)}var source=audioContext.createBufferSource();source.connect(_gainNode);_gainNode.gain.linearRampToValueAtTime(_gain.toAbsolute(),startTime);source.playbackRate.setValueAtTime(_playbackRate,startTime);source.buffer=_buffer;source.addEventListener("ended",stoppedAction);_voices.push(source);source.start(startTime);player.emit("started",_gain)};this.updatePlaybackRate=function(rate){_playbackRate=rate;var now=timeNow(audioContext);_voices.forEach(function(source){source.playbackRate.setValueAtTime(_playbackRate,now)})};loadSample(assetUrl,audioContext,function(buffer){_buffer=buffer;_loaded=true;if(typeof onLoad==="function"){onLoad(player)}})}util.inherits(SamplePlayer,EventEmitter);function loadSample(assetUrl,audioContext,done){var request=new XMLHttpRequest;request.open("GET",assetUrl,true);request.responseType="arraybuffer";request.onload=function(){audioContext.decodeAudioData(request.response,done)};request.send()}function anchor(audioParam,now){audioParam.setValueAtTime(audioParam.value,now)}function timeNow(audioContext){return audioContext.currentTime}module.exports=SamplePlayer},{events:37,util:41}],25:[function(require,module,exports){"use strict";var BPM=require("./src/BPM.js");var createInterval=require("./src/CreateInterval.js");var Metronome=require("./src/Metronome.js");var Repeater=require("./src/Repeater.js");var Sequence=require("./src/Sequence.js");var Tap=require("./src/TapTempo.js");function Scheduling(context){var scheduling=this;function inTheFutureTight(callback,when){var source=context.createBufferSource();var now=context.currentTime;var thousandth=context.sampleRate/1e3;var scheduledAt=now+createInterval(when).toMs()/1e3-.001;var buffer=context.createBuffer(1,thousandth,context.sampleRate);source.addEventListener("ended",callback);source.buffer=buffer;source.connect(context.destination);source.start(scheduledAt);return function cancel(){source.removeEventListener("ended",callback);source.stop()}}function atATimeTight(callback,when){var source=context.createBufferSource();var thousandth=context.sampleRate/1e3;var scheduledAt=createInterval(when).toMs()/1e3-.001;var buffer=context.createBuffer(1,thousandth,context.sampleRate);source.addEventListener("ended",callback);source.buffer=buffer;source.connect(context.destination);source.start(scheduledAt);return function cancel(){source.removeEventListener("ended",callback);source.stop()}}function nowMsFromContext(){return context.currentTime*1e3}this.inTheFuture=context?inTheFutureTight:inTheFutureLoose;this.atATime=context?atATimeTight:atATimeLoose;this.nowMs=context?nowMsFromContext:nowMsFromSystem;this.Repeater=function(initialInterval){return new Repeater(scheduling.atATime,scheduling.nowMs,initialInterval)};this.Sequence=function(){return new Sequence(scheduling.atATime,scheduling.nowMs)};this.Metronome=function(numberOfBeats,bpm){bpm=bpm instanceof BPM?bpm:new BPM(bpm);return new Metronome(scheduling.Repeater,numberOfBeats,bpm)};this.Tap=function(){return new Tap(scheduling.nowMs,scheduling.inTheFuture)};this.BPM=function(initial){return new BPM(initial)};this.BPMForBeatLength=function(beatLength){return BPM.forBeatLength(beatLength)}}function inTheFutureLoose(callback,when){var timer=setTimeout(callback,createInterval(when).toMs());return function cancel(){clearTimeout(timer)}}function atATimeLoose(callback,when){var timer=setTimeout(callback,createInterval(when).toMs()-nowMsFromSystem());return function cancel(){clearTimeout(timer)}}function nowMsFromSystem(){return(new Date).getTime()}module.exports=function(context){return new Scheduling(context)}},{"./src/BPM.js":26,"./src/CreateInterval.js":27,"./src/Metronome.js":28,"./src/Repeater.js":29,"./src/Sequence.js":30,"./src/TapTempo.js":31}],26:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var _require=require("ramda");var compose=_require.compose;var min=_require.min;var max=_require.max;var sum=_require.sum;var defaultTo120=function defaultTo120(amount){return amount||120};var rounded2dp=function rounded2dp(amount){return Math.round(amount*100)/100};var clippedBetween20And300=compose(min(300),max(20));var sanitize=compose(rounded2dp,clippedBetween20And300,defaultTo120);var bpmToBeatLengthMs=function bpmToBeatLengthMs(bpm){return 60/bpm*1e3};var beatLengthMsToBpm=bpmToBeatLengthMs;var toMs=function toMs(candidate){return candidate&&typeof candidate.toMs==="function"?candidate.toMs():candidate};function BPM(initial){EventEmitter.call(this);var bpm=this;var current=initial&&typeof initial.current==="function"?initial.current():sanitize(initial);function updateAndReport(newBpm){current=sanitize(newBpm);bpm.report()}this.current=function(){return current};this.report=function(){return bpm.emit("changed",bpm)};this.changeBy=function(amount){return updateAndReport(sum([current,amount]))};this.changeTo=function(amount){return updateAndReport(new BPM(amount).current())};this.beatLength=function(){return{toMs:function toMs(){return bpmToBeatLengthMs(current)}}}}util.inherits(BPM,EventEmitter);BPM.forBeatLength=function(beatLength){return new BPM(beatLengthMsToBpm(toMs(beatLength)))};module.exports=BPM},{events:37,ramda:23,util:41}],27:[function(require,module,exports){"use strict";module.exports=function(x){return x&&typeof x.toMs==="function"?x:{toMs:function toMs(){return x}}}},{}],28:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var _require=require("ramda");var clamp=_require.clamp;var between1And16=clamp(1,16);function Metronome(Repeater,initialNumberOfBeats,bpm){EventEmitter.call(this);var metronome=this;var numberOfBeats=between1And16(initialNumberOfBeats);var repeater=Repeater(bpm.beatLength());var count=-1;function tick(){count=++count%numberOfBeats;if(count===0){metronome.emit("accent")}else{metronome.emit("tick")}}this.start=function(){repeater.start(tick)};this.stop=function(){repeater.stop();count=-1};this.updateNumberOfBeats=function(beats){numberOfBeats=beats===between1And16(beats)?beats:numberOfBeats;reportBeats()};this.updateBPM=function(newBPM){bpm.changeTo(newBPM)};this.report=function(){reportBPM();reportBeats()};function updateRepeaterInterval(newBPM){repeater.updateInterval(newBPM.beatLength());reportBPM()}function reportBeats(){metronome.emit("numberOfBeats",numberOfBeats)}function reportBPM(){metronome.emit("bpmChanged",bpm)}repeater.on("started",function(info){metronome.emit("started",{previousTick:info.previousRepeatTime,nextTick:info.nextRepeatTime})});repeater.on("stopped",function(){metronome.emit("stopped")});bpm.on("changed",updateRepeaterInterval)}util.inherits(Metronome,EventEmitter);module.exports=Metronome},{events:37,ramda:23,util:41}],29:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var createInterval=require("./CreateInterval.js");function noAction(){}function Repeater(atATime,nowMs,initialInterval){EventEmitter.call(this);var _lastScheduledTimeMs=void 0;var _callback=noAction;var _isScheduling=false;var _interval=createInterval(initialInterval);var _cancel=noAction;var repeater=this;function nextRepeatTime(){return createInterval(_lastScheduledTimeMs+_interval.toMs())}function recursiveInTheFuture(){var nextScheduledTimeMs=nextRepeatTime().toMs();return atATime(function(){if(_isScheduling){_callback();_lastScheduledTimeMs=nextScheduledTimeMs;_cancel=recursiveInTheFuture()}},nextScheduledTimeMs)}this.updateInterval=function(newInterval){_interval=createInterval(newInterval);if(_isScheduling){_cancel();_cancel=recursiveInTheFuture()}repeater.reportInterval();return repeater};this.start=function(passedCallback){if(_isScheduling)return;_lastScheduledTimeMs=nowMs();_isScheduling=true;_callback=passedCallback;_callback();repeater.emit("started",{previousRepeatTime:{toMs:function toMs(){return _lastScheduledTimeMs}},nextRepeatTime:{toMs:function toMs(){return nextRepeatTime().toMs()}}});_cancel=recursiveInTheFuture()};this.stop=function(){_cancel();_cancel=noAction;_callback=noAction;_isScheduling=false;repeater.emit("stopped")};this.reportInterval=function(){repeater.emit("interval",{toMs:_interval.toMs})}}util.inherits(Repeater,EventEmitter);module.exports=Repeater},{"./CreateInterval.js":27,events:37,util:41}],30:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var createInterval=require("./CreateInterval.js");function noAction(){}function Sequence(atATime,nowMs){EventEmitter.call(this);var sequence=this;var running=false;var absoluteStartTime=void 0;var restartEvent={when:undefined,action:"restart",cancel:noAction};var stopEvent={when:0,action:"stop",cancel:noAction};var scheduleAllEvents=function scheduleAllEvents(startTimeMs){stopEvent.when=0;events.filter(occursBetween.bind(null,startTimeMs,restartEvent.when)).forEach(function(event){stopEvent.when=event.when>stopEvent.when?event.when:stopEvent.when;schedule(event)});stopEvent.when+=10;schedule(restartEvent.when?restartEvent:stopEvent)};function restart(){absoluteStartTime+=restartEvent.when;sequence.emit("loop");scheduleAllEvents(0)}var cancelAllEvents=function cancelAllEvents(){events.forEach(cancel);cancel(restartEvent);cancel(stopEvent)};var schedule=function schedule(event){event.cancel=atATime(function(){switch(event.action){case"restart":restart();break;case"stop":sequence.stop();break;default:sequence.emit(event.name,event.data);break}},absoluteStartTime+event.when)};var currentPositionData=function currentPositionData(){var rightNow=nowMs();return{nowMs:rightNow,currentMs:absoluteStartTime>0?rightNow-absoluteStartTime:0}};var events=[];this.startAt=function(timeMs,offsetMs){timeMs=createInterval(timeMs).toMs();offsetMs=offsetMs>0?offsetMs:0;timeMs=timeMs>0?timeMs:0;timeMs=timeMs<nowMs()?nowMs():timeMs;if(restartEvent.when)offsetMs=offsetMs%restartEvent.when;absoluteStartTime=timeMs-offsetMs;if(running){cancelAllEvents()}running=true;scheduleAllEvents(offsetMs);return sequence};this.start=function(offsetMs){sequence.startAt(nowMs(),offsetMs)};this.stop=function(){var wasRunning=running;running=false;if(wasRunning){cancelAllEvents();sequence.emit("stopped")}};this.loop=function(endTimeMs){var end=endTimeMs>0?endTimeMs:undefined;if(end){restartEvent.when=end;if(running){var offsetMs=sequence.currentPositionMs()%end;sequence.start(offsetMs)}}return sequence};this.addEventAt=function(when,name,data){events.push({when:when,name:name,data:data,cancel:noAction})};this.addEventNow=function(name,data){var positionInfo=currentPositionData();if(absoluteStartTime===undefined){absoluteStartTime=positionInfo.nowMs}events.push({when:positionInfo.currentMs,name:name,data:data,cancel:noAction})};this.currentPositionMs=function(){return currentPositionData().currentMs};this.loopLengthMs=function(){return restartEvent.when};this.reset=function(){sequence.stop();events=[];absoluteStartTime=undefined;restartEvent.when=undefined;stopEvent.when=0;sequence.emit("reset");return sequence};this.scale=function(){var scaleFactor=arguments.length<=0||arguments[0]===undefined?1:arguments[0];if(scaleFactor<0||scaleFactor===1)return sequence;if(running){cancelAllEvents()}events.forEach(function(event){event.when*=scaleFactor});if(restartEvent.when)restartEvent.when*=scaleFactor;if(running){var positionInfo=currentPositionData();var offsetMs=positionInfo.currentMs*scaleFactor;absoluteStartTime=positionInfo.nowMs-offsetMs;scheduleAllEvents(offsetMs)}return sequence};this.load=function(json){sequence.stop();events=json.events.map(function(event){var newEvent=mapEventForJSONification(event);newEvent.cancel=noAction;return newEvent});restartEvent.when=json.loop.lengthMs>0?json.loop.lengthMs:undefined;restartEvent.cancel=noAction;return sequence};this.toJSON=function(){return{loop:{lengthMs:restartEvent.when},events:events.map(mapEventForJSONification)}}}util.inherits(Sequence,EventEmitter);function mapEventForJSONification(event){return{when:event.when,name:event.name,data:event.data}}function isAfter(timeMs,event){return event.when>=timeMs}function isBefore(event,endMs){return typeof endMs==="undefined"?true:event.when<endMs}function occursBetween(startMs,endMs,event){return isAfter(startMs,event)&&isBefore(event,endMs)}function cancel(event){event.cancel();event.cancel=noAction}module.exports=Sequence},{"./CreateInterval.js":27,events:37,util:41}],31:[function(require,module,exports){"use strict";var BPM=require("./BPM.js");var EventEmitter=require("events");var util=require("util");function noAction(){}function Tap(nowMs,inTheFuture){EventEmitter.call(this);
var tap=this;var cancel=noAction;var queue=[];function reset(){queue=[]}this.again=function(){cancel();cancel=noAction;queue.push(nowMs());if(queue.length>4)queue.shift();if(queue.length>1){var averageTime=(queue[queue.length-1]-queue[0])/(queue.length-1);tap.emit("average",BPM.forBeatLength(averageTime));cancel=inTheFuture(reset,averageTime*1.25)}else{cancel=inTheFuture(reset,1500)}}}util.inherits(Tap,EventEmitter);module.exports=Tap},{"./BPM.js":26,events:37,util:41}],32:[function(require,module,exports){"use strict";var EventEmitter=require("events");var util=require("util");var states={armed:"armed",idle:"idle",recording:"recording",playback:"playback",stopped:"stopped",overdubbing:"overdubbing"};var ppq={1:96,"3/4":72,"1/2":48,"1/3":32,"1/4":24,"1/6":16,"1/8":12,"1/12":8,"1/16":6,"1/24":4,"1/32":3};function AppSequence(Scheduling,bpm,metronome){EventEmitter.call(this);var wrapped=Scheduling.Sequence();var state=states.idle;var numberOfBeats=undefined;var sequenceBPM=undefined;var sequence=this;var _now={toMs:Scheduling.nowMs};var nextTick=_now;var previousTick=_now;var metronomeRunning=false;var isQuantised=false;var quantisationFactor=1;if(metronome){metronome.on("started",function(metronomeInterval){nextTick=metronomeInterval.nextTick;previousTick=metronomeInterval.previousTick;metronomeRunning=true});metronome.on("stopped",function(){nextTick=_now;previousTick=_now;metronomeRunning=false})}function isActive(){return[states.playback,states.overdubbing,states.recording].indexOf(state)!=-1}function reportState(){sequence.emit("state",state);if(isActive())sequence.emit("active");if(state===states.stopped)sequence.emit("stopped")}function scaleSequenceLength(bpm){var changeFactor=sequenceBPM/bpm.current();wrapped.scale(changeFactor);sequenceBPM=bpm.current()}var setLoopLengthAndBroadcastBPM=function setLoopLengthAndBroadcastBPM(){var sequenceLengthMs=wrapped.currentPositionMs();if(!isQuantised){wrapped.loop(sequenceLengthMs);wrapped.start();return}sequenceBPM=bpm.current();var beatLengthMs=bpm.beatLength().toMs();numberOfBeats=Math.round(sequenceLengthMs/beatLengthMs);numberOfBeats=numberOfBeats>1?numberOfBeats:1;sequence.emit("numberOfBeats",numberOfBeats);var roundedSequenceLengthMs=numberOfBeats*beatLengthMs;wrapped.loop(roundedSequenceLengthMs);if(roundedSequenceLengthMs<sequenceLengthMs){var timeSinceLastTick=Scheduling.nowMs()-previousTick.toMs();wrapped.start(timeSinceLastTick)}else{wrapped.startAt(nextTick)}metronome.on("bpmChanged",scaleSequenceLength)};function calculateQuantisationFactor(bpm){quantisationFactor=bpm.beatLength().toMs()/96*ppq["1/4"]}function nearestQuantisedTimeInSequence(){return Math.round(wrapped.currentPositionMs()/quantisationFactor)*quantisationFactor}function nextQuantisedPointIntime(){var now=Scheduling.nowMs();if(!metronomeRunning)return now;var startTime=previousTick.toMs()+quantisationFactor;while(startTime<now){startTime+=quantisationFactor}return startTime}metronome.on("bpmChanged",calculateQuantisationFactor);metronome.report();this.addEvent=function(name,data){switch(state){case states.armed:isQuantised=metronomeRunning;case states.recording:case states.overdubbing:var quantisedTime=isQuantised?nearestQuantisedTimeInSequence():0;if(quantisedTime>0){wrapped.addEventAt(quantisedTime,"__app_sequence__",{name:name,data:data})}else{wrapped.addEventNow("__app_sequence__",{name:name,data:data})}}};this.reportState=reportState;this.arm=function(){if(state===states.idle){state=states.armed;reportState();return true}return false};this.disarm=function(){if(state===states.armed){state=states.idle;reportState();return true}return false};this.record=function(){if(state===states.armed){state=states.recording;reportState();return true}return false};this.play=function(){var offset=arguments.length<=0||arguments[0]===undefined?0:arguments[0];if(state===states.stopped||state===states.overdubbing||state===states.recording){if(state===states.recording){setLoopLengthAndBroadcastBPM()}else if(state===states.stopped){wrapped.startAt(nextQuantisedPointIntime(),offset)}state=states.playback;reportState();return true}return false};this.playAtNextTick=function(){var offset=arguments.length<=0||arguments[0]===undefined?0:arguments[0];if(state===states.stopped){wrapped.startAt(nextTick,offset);state=states.playback;reportState();return true}return false};this.restart=function(){if(state===states.playback){if(isQuantised&&metronomeRunning){wrapped.startAt(nextQuantisedPointIntime())}else{wrapped.start()}return true}return false};this.overdub=function(){if(state===states.stopped||state===states.playback||state===states.recording){if(state===states.recording){setLoopLengthAndBroadcastBPM()}else if(state===states.stopped){wrapped.startAt(nextTick)}state=states.overdubbing;reportState();return true}return false};this.stop=function(){if(state===states.playback||state===states.overdubbing){wrapped.stop();return true}return false};this.reset=function(){wrapped.reset();state=states.idle;isQuantised=false;metronome.removeListener("bpmChanged",scaleSequenceLength);reportState();return true};this.currentPositionMs=function(){return wrapped.currentPositionMs()};this.hasEvents=function(){return state!==states.idle&&state!==states.armed};wrapped.on("stopped",function(){if(state!==states.stopped){state=states.stopped;reportState()}});wrapped.on("__app_sequence__",function(wrappedEvent){sequence.emit(wrappedEvent.name,wrappedEvent.data)})}util.inherits(AppSequence,EventEmitter);module.exports=AppSequence},{events:37,util:41}],33:[function(require,module,exports){"use strict";var Sequence=require("./AppSequence.js");var EventEmitter=require("events");var util=require("util");function Sequencer(numberOfSequences,Scheduling,bpm,metronome){EventEmitter.call(this);var sequences=Array(numberOfSequences+1).fill("").map(function(){return new Sequence(Scheduling,bpm,metronome)});sequences.forEach(function(sequence,index){sequence.number=index+1});var selectedSequence=void 0;var activeSequence=void 0;var sequencer=this;function isSelected(sequence){return sequence===selectedSequence}function validSequenceNumber(number){return number>0&&number<=sequences.length}this.selectSequence=function(number){select(number)};this.selectSequenceLegato=function(number){select(number,true)};function select(){var sequenceNumber=arguments.length<=0||arguments[0]===undefined?1:arguments[0];var legato=arguments.length<=1||arguments[1]===undefined?false:arguments[1];if(!validSequenceNumber(sequenceNumber))return;var index=sequenceNumber-1;if(isSelected(sequences[index])&&sequences[index]===activeSequence){activeSequence.restart()||activeSequence.play();return}var prevSequence=selectedSequence;selectedSequence=sequences[index];if(prevSequence){prevSequence.removeListener("stopped",sequencerStopped);prevSequence.disarm();prevSequence.reportState()}selectedSequence.addListener("stopped",sequencerStopped);if(activeSequence){activeSequence.play()}if(selectedSequence.hasEvents()){var offset=0;if(activeSequence){if(legato)offset=activeSequence.currentPositionMs();activeSequence.stop();selectedSequence.play(offset)}else{selectedSequence.playAtNextTick()}}else{selectedSequence.arm()}}this.recordButtonPressed=function(){selectedSequence.arm()||selectedSequence.disarm()||selectedSequence.overdub()||selectedSequence.play()};this.playButtonPressed=function(){selectedSequence.stop()||!activeSequence&&selectedSequence.playAtNextTick()||selectedSequence.play()};this.deleteSequence=function(){var number=arguments.length<=0||arguments[0]===undefined?0:arguments[0];var toReset=selectedSequence;if(validSequenceNumber(number)){toReset=sequences[number-1]}toReset.reset();if(activeSequence===toReset)activeSequence=undefined};this.addEvent=function(name,data){selectedSequence.addEvent("__sequenced_event__",{name:name,data:data});selectedSequence.record()};this.reportSelectedSequenceState=function(){selectedSequence.reportState()};function reportSequenceState(state){sequencer.emit("sequenceState",this.number,state,isSelected(this))}function captureActiveSequence(){activeSequence=this}function sequencerStopped(){activeSequence=undefined;sequencer.emit("stopped")}function emitSequencedEvent(wrappedEvent){sequencer.emit(wrappedEvent.name,wrappedEvent.data)}sequences.forEach(function(sequence,index){sequence.addListener("state",reportSequenceState);sequence.addListener("active",captureActiveSequence);sequence.addListener("__sequenced_event__",emitSequencedEvent);sequence.addListener("state",function(state){switch(state){case"recording":sequences.forEach(function(other){if(sequence!==other)other.stop()})}});sequence.reportState()});select(1);sequences[0].disarm()}util.inherits(Sequencer,EventEmitter);module.exports=Sequencer},{"./AppSequence.js":32,events:37,util:41}],34:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util");function Interval(bpm,multiplier,value){EventEmitter.call(this);var interval=this;this.value=value;this.report=function(){interval.emit("changed",bpm.beatLength().toMs()*multiplier)};bpm.on("changed",interval.report)}util.inherits(Interval,EventEmitter);module.exports={"4n":function n(bpm,name){return new Interval(bpm,1,name?name:"4n")},"4nt":function nt(bpm,name){return new Interval(bpm,2/3,name?name:"4nt")},"8n":function n(bpm,name){return new Interval(bpm,.5,name?name:"8n")},"8nt":function nt(bpm,name){return new Interval(bpm,1/3,name?name:"8nt")},"16n":function n(bpm,name){return new Interval(bpm,.25,name?name:"16n")},"16nt":function nt(bpm,name){return new Interval(bpm,1/6,name?name:"16nt")},"32n":function n(bpm,name){return new Interval(bpm,.125,name?name:"32n")},"32nt":function nt(bpm,name){return new Interval(bpm,1/12,name?name:"32nt")}}},{events:37,util:41}],35:[function(require,module,exports){"use strict";var SamplePlayer=require("wac.sample-player");function Player(assetUrl,audioContext,onLoad){var samplePlayer=new SamplePlayer(assetUrl,audioContext,onLoad),filterNode=audioContext.createBiquadFilter(),pitch=0,pitchMod=0,player=this;filterNode.frequency.value=2e4;samplePlayer.connect(filterNode);var updatePitch=function updatePitch(){samplePlayer.updatePlaybackRate(intervalToPlaybackRate(pitch+pitchMod))};this._assetUrl=assetUrl;this.play=samplePlayer.play.bind(samplePlayer);this.connect=filterNode.connect.bind(filterNode);this.disconnect=filterNode.disconnect.bind(filterNode);this.toMaster=function(){filterNode.disconnect();filterNode.connect(audioContext.destination);return player};this.isPlaying=samplePlayer.isPlaying.bind(samplePlayer);this.changePitchByInterval=function(interval){pitch=clip(pitch+interval,-24,24);player.reportPitch();updatePitch()};this.modulatePitch=function(interval){pitchMod=clip(interval,-24,24);updatePitch()};this.cutOff=function(f){filterNode.frequency.setValueAtTime(clip(f,30,2e4),audioContext.currentTime);return player};this.reportPitch=function(){samplePlayer.emit("pitch",(pitch>=0?"+":"")+pitch+" st")};this.on=samplePlayer.on.bind(samplePlayer)}function clip(value,min,max){if(value<min)return min;return value>max?max:value}function intervalToPlaybackRate(midiNoteNumber){return Math.exp(.057762265*midiNoteNumber)}module.exports=Player},{"wac.sample-player":24}],36:[function(require,module,exports){"use strict";var EventEmitter=require("events"),util=require("util"),Scheduling=require("wac.scheduling");function Repetae(repeater,initial_interval){EventEmitter.call(this);var repetae=this;this._active=false;this._time_changed=false;this._being_pressed=false;this._current_interval=initial_interval;repeater.on("interval",function(interval){repetae.emit("intervalMs",interval)});repetae._current_interval.on("changed",repeater.updateInterval);repetae._current_interval.report();this.press=function(){repetae._being_pressed=true};this.release=function(){var started_active=repetae._active,time_changed=repetae._time_changed;repetae._time_changed=false;repetae._being_pressed=false;switch(true){case!started_active:repetae._active=true;repetae.emit("on");break;case started_active&&!time_changed:repetae._active=false;repetae.emit("off");break}};this.interval=function(new_interval){if(repetae._being_pressed){repetae._time_changed=true;repetae._current_interval.removeListener("changed",repeater.updateInterval);repetae._current_interval=new_interval;repetae._current_interval.on("changed",repeater.updateInterval);repetae.report_interval();repetae._current_interval.report()}};this.start=function(callback){if(!repetae._active){callback();return}repeater.start(callback)};this.stop=repeater.stop;this.report_interval=function(){repetae.emit("interval",repetae._current_interval.value)}}util.inherits(Repetae,EventEmitter);module.exports=function createRepetae(interval,context){var repeater=Scheduling(context).Repeater(1e3);return new Repetae(repeater,interval)}},{events:37,util:41,"wac.scheduling":25}],37:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],38:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],39:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],40:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],41:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":40,_process:39,inherits:38}]},{},[1]);
